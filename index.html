<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cobblemon Mastery Guide</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:        #1a1a1a;
      --stone:     #2f2f2f;
      --stone2:    #3a3a3a;
      --slot:      #8b8b8b;
      --slot-dark: #555;
      --slot-light:#c6c6c6;
      --green:     #55ff55;
      --gold:      #ffaa00;
      --red:       #ff5555;
      --blue:      #5555ff;
      --aqua:      #55ffff;
      --white:     #f0f0f0;
      --gray:      #aaaaaa;
      --border:    #000;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--white);
      font-family: 'VT323', monospace;
      font-size: 18px;
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--stone); }
    ::-webkit-scrollbar-thumb { background: var(--slot-dark); border: 1px solid #000; }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      background: linear-gradient(180deg, #3d2b1a 0%, #2a1d0e 100%);
      border-bottom: 4px solid #000;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header img.logo { width: 48px; height: 48px; image-rendering: pixelated; }
    .header-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 14px;
      color: var(--green);
      text-shadow: 2px 2px #000, 0 0 12px #00aa00;
      line-height: 1.6;
    }
    .header-subtitle {
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--gold);
    }
    .header-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }
    .mc-badge {
      background: var(--stone2);
      border: 2px solid var(--slot-dark);
      border-right-color: var(--slot-light);
      border-bottom-color: var(--slot-light);
      padding: 4px 10px;
      font-size: 14px;
      color: var(--aqua);
    }

    /* ‚îÄ‚îÄ MC BUTTON STYLE ‚îÄ‚îÄ */
    .mc-btn {
      font-family: 'VT323', monospace;
      font-size: 20px;
      background: var(--slot);
      color: #fff;
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 4px 14px;
      cursor: pointer;
      text-shadow: 1px 1px #000;
      transition: filter 0.1s;
      user-select: none;
    }
    .mc-btn:hover { filter: brightness(1.15); }
    .mc-btn:active {
      border-top-color: #333;
      border-left-color: #333;
      border-right-color: var(--slot-light);
      border-bottom-color: var(--slot-light);
    }
    .mc-btn.active {
      background: #666;
      border-top-color: #333;
      border-left-color: #333;
      color: var(--green);
    }

    /* ‚îÄ‚îÄ MC INPUT ‚îÄ‚îÄ */
    .mc-input {
      font-family: 'VT323', monospace;
      font-size: 22px;
      background: #131313;
      color: var(--white);
      border: 3px solid;
      border-top-color: #333;
      border-left-color: #333;
      border-right-color: var(--slot-light);
      border-bottom-color: var(--slot-light);
      padding: 6px 12px;
      outline: none;
      caret-color: var(--white);
      width: 100%;
    }
    .mc-input:focus { border-color: var(--green); }
    .mc-input::placeholder { color: #666; }

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    .app-layout {
      display: flex;
      height: calc(100vh - 80px);
    }
    aside {
      width: 260px;
      min-width: 260px;
      background: var(--stone);
      border-right: 4px solid #000;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .main-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar-search {
      padding: 12px;
      border-bottom: 3px solid #000;
      background: #222;
    }
    .sidebar-search label {
      display: block;
      color: var(--gray);
      font-size: 14px;
      margin-bottom: 4px;
    }
    .tabs {
      display: flex;
      gap: 0;
      border-bottom: 3px solid #000;
    }
    .tab-btn {
      flex: 1;
      background: var(--stone2);
      color: var(--gray);
      border: none;
      border-right: 2px solid #000;
      padding: 8px 4px;
      font-family: 'VT323', monospace;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
    }
    .tab-btn:last-child { border-right: none; }
    .tab-btn.active { background: #555; color: var(--green); }
    .tab-btn:hover:not(.active) { background: #444; color: var(--white); }
    .gen-filters {
      padding: 10px 12px;
      background: #252525;
      border-bottom: 3px solid #000;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .gen-filter-btn {
      font-family: 'VT323', monospace;
      font-size: 16px;
      background: var(--stone2);
      color: var(--gray);
      border: 2px solid #000;
      padding: 2px 8px;
      cursor: pointer;
    }
    .gen-filter-btn.active { background: #2a5a2a; color: var(--green); border-color: #44aa44; }
    .gen-filter-btn:hover:not(.active) { background: #444; color: var(--white); }

    .pokemon-list {
      overflow-y: auto;
      flex: 1;
    }
    .pokemon-entry {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 12px;
      border-bottom: 1px solid #2a2a2a;
      cursor: pointer;
      transition: background 0.1s;
      user-select: none;
    }
    .pokemon-entry:hover { background: #3a3a3a; }
    .pokemon-entry.selected { background: #2a4a2a; border-left: 3px solid var(--green); }
    .pokemon-entry img {
      width: 36px;
      height: 36px;
      image-rendering: pixelated;
    }
    .pokemon-entry .entry-name {
      font-size: 20px;
      color: var(--white);
      text-transform: capitalize;
    }
    .pokemon-entry .entry-id {
      margin-left: auto;
      font-size: 14px;
      color: var(--gray);
    }
    .entry-badges { display: flex; gap: 4px; }
    .badge-friendship { font-size: 12px; background: #664400; color: var(--gold); padding: 1px 5px; border: 1px solid #aa6600; }
    .badge-trade      { font-size: 12px; background: #004488; color: var(--aqua); padding: 1px 5px; border: 1px solid #0066cc; }

    /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
    .page-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 11px;
      color: var(--green);
      text-shadow: 1px 1px #000;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .page-title::after {
      content: '';
      flex: 1;
      height: 2px;
      background: linear-gradient(to right, #33aa33 0%, transparent 100%);
    }

    /* ‚îÄ‚îÄ POKEMON DETAIL ‚îÄ‚îÄ */
    .detail-grid {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 16px;
    }
    .mc-panel {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 14px;
    }
    .mc-panel h2 {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: var(--gold);
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid #000;
    }
    .pokemon-portrait {
      text-align: center;
      padding: 16px;
    }
    .pokemon-portrait img {
      width: 128px;
      height: 128px;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 8px rgba(85,255,85,0.3));
    }
    .pokemon-name-big {
      font-family: 'Press Start 2P', monospace;
      font-size: 13px;
      color: var(--white);
      text-transform: capitalize;
      margin-top: 8px;
    }
    .pokemon-number {
      color: var(--gray);
      font-size: 20px;
    }
    .types { display: flex; gap: 6px; justify-content: center; margin-top: 8px; flex-wrap: wrap; }
    .type-badge {
      font-family: 'VT323', monospace;
      font-size: 16px;
      padding: 2px 12px;
      border: 2px solid #000;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    /* type colours */
    .type-normal   { background:#a8a878; color:#fff; }
    .type-fire     { background:#f08030; color:#fff; }
    .type-water    { background:#6890f0; color:#fff; }
    .type-electric { background:#f8d030; color:#000; }
    .type-grass    { background:#78c850; color:#fff; }
    .type-ice      { background:#98d8d8; color:#000; }
    .type-fighting { background:#c03028; color:#fff; }
    .type-poison   { background:#a040a0; color:#fff; }
    .type-ground   { background:#e0c068; color:#000; }
    .type-flying   { background:#a890f0; color:#fff; }
    .type-psychic  { background:#f85888; color:#fff; }
    .type-bug      { background:#a8b820; color:#fff; }
    .type-rock     { background:#b8a038; color:#fff; }
    .type-ghost    { background:#705898; color:#fff; }
    .type-dragon   { background:#7038f8; color:#fff; }
    .type-dark     { background:#705848; color:#fff; }
    .type-steel    { background:#b8b8d0; color:#000; }
    .type-fairy    { background:#ee99ac; color:#000; }

    .stat-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .stat-name { width: 90px; font-size: 16px; color: var(--gray); }
    .stat-val  { width: 36px; text-align: right; font-size: 18px; color: var(--white); }
    .stat-bar-bg {
      flex: 1;
      height: 10px;
      background: #1a1a1a;
      border: 1px solid #000;
    }
    .stat-bar { height: 100%; }

    /* ‚îÄ‚îÄ IV SECTION ‚îÄ‚îÄ */
    .iv-section {
      background: #0d1a2a;
      border: 3px solid #1a4a6a;
      padding: 14px;
      margin-top: 12px;
    }
    .iv-section h2 {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: var(--aqua);
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid #1a4a6a;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .iv-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .iv-name {
      width: 72px;
      font-size: 16px;
      color: var(--gray);
    }
    .iv-input {
      width: 48px;
      font-family: 'VT323', monospace;
      font-size: 20px;
      background: #000;
      color: var(--white);
      border: 2px solid #1a4a6a;
      text-align: center;
      padding: 1px 4px;
      outline: none;
    }
    .iv-input:focus { border-color: var(--aqua); }
    .iv-bar-wrap {
      flex: 1;
      height: 12px;
      background: #0a0a0a;
      border: 1px solid #111;
      position: relative;
    }
    .iv-bar { height: 100%; transition: width 0.2s, background 0.2s; }
    .iv-label {
      width: 72px;
      font-size: 15px;
      text-align: right;
    }
    .iv-priority {
      width: 20px;
      text-align: center;
      font-size: 18px;
      cursor: help;
    }
    .iv-legend {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid #1a4a6a;
      font-size: 15px;
    }
    .iv-legend-item { display: flex; align-items: center; gap: 5px; }
    .iv-legend-dot { width: 12px; height: 12px; border: 1px solid #000; }
    .iv-role-badge {
      display: inline-block;
      background: #0a2a0a;
      color: var(--green);
      border: 1px solid #2a6a2a;
      padding: 2px 10px;
      font-size: 16px;
      margin-bottom: 6px;
    }
    .iv-summary {
      background: #000;
      border: 2px solid #1a4a6a;
      padding: 8px 12px;
      margin-bottom: 10px;
      font-size: 17px;
      line-height: 1.8;
    }
    .iv-target {
      width: 64px;
      font-size: 15px;
      text-align: center;
      font-weight: bold;
    }
    .iv-row-priority { background: #05151f; }

    /* ‚îÄ‚îÄ MOVES SECTION ‚îÄ‚îÄ */
    .moves-section {
      background: #1a1a2a;
      border: 3px solid #3a3a7a;
      padding: 14px;
      margin-top: 12px;
    }
    .moves-section h2 {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: var(--aqua);
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid #3a3a7a;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .moves-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 10px;
      border-bottom: 2px solid #2a2a4a;
    }
    .moves-tab {
      font-family: 'VT323', monospace;
      font-size: 18px;
      background: #111;
      color: #888;
      border: none;
      padding: 4px 16px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
    }
    .moves-tab.active { color: var(--aqua); border-bottom-color: var(--aqua); background: #0a0a1a; }
    .moves-tab:hover:not(.active) { color: #ccc; background: #1a1a2a; }
    .moves-panel { display: none; }
    .moves-panel.active { display: block; }
    .move-table { width: 100%; border-collapse: collapse; font-size: 17px; }
    .move-table th {
      text-align: left;
      color: #666;
      font-size: 14px;
      padding: 3px 8px;
      border-bottom: 1px solid #2a2a4a;
      font-family: 'VT323', monospace;
      font-weight: normal;
    }
    .move-table td { padding: 3px 8px; border-bottom: 1px solid #111; }
    .move-table tr:hover td { background: #0a0a2a; }
    .move-cat-physical { color: #f08030; }
    .move-cat-special  { color: #6890f0; }
    .move-cat-status   { color: #aaaaaa; }
    .move-name { color: var(--white); text-transform: capitalize; }
    .move-lv {
      background: #002a00;
      color: var(--green);
      border: 1px solid #004400;
      padding: 0 6px;
      font-size: 15px;
      display: inline-block;
      min-width: 36px;
      text-align: center;
    }
    .move-tm {
      background: #00002a;
      color: var(--aqua);
      border: 1px solid #000066;
      padding: 0 6px;
      font-size: 15px;
      display: inline-block;
      min-width: 36px;
      text-align: center;
    }

    /* ‚îÄ‚îÄ COMPETITIVE BUILD SECTION ‚îÄ‚îÄ */
    .comp-section {
      background: #12101e;
      border: 3px solid #5a3a9a;
      padding: 14px;
      margin-top: 12px;
    }
    .comp-section h2 {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: #c084fc;
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 2px solid #5a3a9a;
    }
    .comp-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 14px;
    }
    .comp-box {
      background: #0a0818;
      border: 2px solid #3a2a6a;
      padding: 10px;
    }
    .comp-box-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 8px;
      color: #c084fc;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .ev-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
    }
    .ev-amount {
      font-family: 'Press Start 2P', monospace;
      font-size: 9px;
      min-width: 36px;
      color: #f0f0f0;
    }
    .ev-bar-bg {
      flex: 1;
      height: 8px;
      background: #111;
      border: 1px solid #222;
    }
    .ev-bar { height: 100%; }
    .ev-stat-name {
      width: 56px;
      font-size: 15px;
      text-align: right;
    }
    .nature-badge {
      display: block;
      font-family: 'Press Start 2P', monospace;
      font-size: 11px;
      color: #f0f0f0;
      margin-bottom: 6px;
    }
    .nature-detail {
      font-size: 16px;
      line-height: 1.7;
    }
    .nature-up   { color: #55ff55; }
    .nature-down { color: #ff5555; }
    .item-big-name {
      font-family: 'Press Start 2P', monospace;
      font-size: 9px;
      color: var(--gold);
      margin-bottom: 6px;
    }
    .item-big-desc { font-size: 16px; color: #aaa; line-height: 1.5; }
    .best4-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .move-card {
      background: #0a0818;
      border: 2px solid #3a2a6a;
      padding: 8px 10px;
      position: relative;
    }
    .move-card-num {
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: 13px;
      color: #554488;
    }
    .move-card-name {
      font-family: 'Press Start 2P', monospace;
      font-size: 8px;
      color: #f0f0f0;
      margin-bottom: 5px;
      text-transform: capitalize;
    }
    .move-card-meta {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }
    .move-power {
      background: #1a1a0a;
      color: var(--gold);
      border: 1px solid #3a3a0a;
      padding: 1px 6px;
      font-size: 15px;
    }
    .move-cat-p { background:#2a1200; color:#f08030; border:1px solid #5a2a00; padding:1px 6px; font-size:14px; }
    .move-cat-s { background:#00001a; color:#6890f0; border:1px solid #00004a; padding:1px 6px; font-size:14px; }
    .move-cat-z { background:#1a1a1a; color:#aaa;    border:1px solid #333;    padding:1px 6px; font-size:14px; }
    .move-stab  { background:#0a2a0a; color:#55ff55; border:1px solid #2a5a2a; padding:1px 6px; font-size:14px; }
    .move-coverage { background:#1a0a2a; color:#c084fc; border:1px solid #5a2a8a; padding:1px 6px; font-size:14px; }
    .move-stars { font-size:15px; color: var(--gold); margin-top:3px; }
    .ev-total { font-size:15px; color:#666; margin-top:6px; }

    /* ‚îÄ‚îÄ COBBLEMON SECTION ‚îÄ‚îÄ */
    .cobblemon-section {
      background: #1a2a1a;
      border: 3px solid #2a5a2a;
      padding: 14px;
      margin-top: 16px;
    }
    .cobblemon-section h2 {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: var(--green);
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid #2a5a2a;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .cob-icon { font-size: 20px; }
    .info-row {
      display: flex;
      gap: 8px;
      align-items: flex-start;
      margin-bottom: 8px;
      padding: 8px;
      background: #0f1f0f;
      border: 1px solid #2a5a2a;
    }
    .info-row .info-icon { font-size: 22px; min-width: 28px; }
    .info-row .info-text { font-size: 18px; color: var(--white); line-height: 1.4; }
    .info-row .info-text em { color: var(--gold); font-style: normal; }
    .info-row .info-text code {
      background: #000;
      color: var(--aqua);
      padding: 1px 6px;
      font-family: 'VT323', monospace;
      font-size: 18px;
      border: 1px solid #333;
    }
    .cmd-block {
      background: #000;
      border: 2px solid #333;
      padding: 8px 12px;
      margin-top: 8px;
      color: var(--aqua);
      font-size: 20px;
    }
    .cmd-block::before { content: '> '; color: var(--green); }

    /* ‚îÄ‚îÄ EVOLUTIONS ‚îÄ‚îÄ */
    .evo-chain {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px 0;
    }
    .evo-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 6px;
      border: 2px solid #444;
      background: #222;
      transition: border-color 0.1s;
      min-width: 70px;
    }
    .evo-item:hover { border-color: var(--green); }
    .evo-item img { width: 56px; height: 56px; image-rendering: pixelated; }
    .evo-item span { font-size: 14px; color: var(--white); text-transform: capitalize; text-align: center; }
    .evo-arrow { font-size: 24px; color: var(--gold); }
    .evo-trigger { font-size: 13px; color: var(--gray); text-align: center; max-width: 70px; }

    /* ‚îÄ‚îÄ ITEMS PAGE ‚îÄ‚îÄ */
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
    }
    .item-card {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .item-icon { font-size: 32px; min-width: 40px; text-align: center; }
    .item-name {
      font-family: 'Press Start 2P', monospace;
      font-size: 8px;
      color: var(--gold);
      margin-bottom: 6px;
    }
    .item-desc { font-size: 16px; color: var(--gray); line-height: 1.4; }
    .item-tag {
      display: inline-block;
      background: #2a4a0a;
      color: var(--green);
      border: 1px solid #4a8a1a;
      font-size: 12px;
      padding: 1px 6px;
      margin-top: 4px;
    }

    /* ‚îÄ‚îÄ APRICORNS PAGE ‚îÄ‚îÄ */
    .apricorn-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .apricorn-card {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 12px;
      text-align: center;
    }
    .apricorn-icon { font-size: 40px; margin-bottom: 6px; }
    .apricorn-name {
      font-family: 'Press Start 2P', monospace;
      font-size: 8px;
      color: var(--white);
      margin-bottom: 8px;
    }
    .apricorn-arrow { color: var(--gold); font-size: 22px; margin: 4px 0; }
    .apricorn-ball {
      font-size: 22px;
      color: var(--aqua);
      border: 2px solid #2a4a6a;
      background: #0a1a2a;
      padding: 4px 10px;
      display: inline-block;
    }
    .apricorn-effect { font-size: 14px; color: var(--gray); margin-top: 6px; }

    /* ‚îÄ‚îÄ WELCOME PAGE ‚îÄ‚îÄ */
    .welcome-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .welcome-card {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 16px;
    }
    .welcome-card h3 {
      font-family: 'Press Start 2P', monospace;
      font-size: 9px;
      color: var(--green);
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid #000;
    }
    .welcome-card p, .welcome-card li {
      font-size: 18px;
      color: var(--gray);
      line-height: 1.6;
    }
    .welcome-card ul { padding-left: 20px; }
    .welcome-card li { color: var(--white); }
    .welcome-card li::marker { color: var(--green); }

    /* ‚îÄ‚îÄ STATUS / SPINNER ‚îÄ‚îÄ */
    #status-bar {
      padding: 8px 16px;
      background: #111;
      border-top: 2px solid #000;
      font-size: 16px;
      color: var(--gray);
      display: flex;
      align-items: center;
      gap: 8px;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 200;
      height: 36px;
    }
    .spinner {
      width: 14px; height: 14px;
      border: 3px solid #333;
      border-top-color: var(--green);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: none;
    }
    .spinner.active { display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--gray);
      font-size: 22px;
    }
    .empty-state .big-icon { font-size: 64px; display: block; margin-bottom: 12px; }

    /* ‚îÄ‚îÄ SECTION DIVIDER ‚îÄ‚îÄ */
    .section-sep {
      border: none;
      border-top: 3px solid #333;
      margin: 16px 0;
    }

    /* ‚îÄ‚îÄ INFO COLUMNS ‚îÄ‚îÄ */
    .info-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .info-entry { margin-bottom: 6px; display: flex; gap: 8px; }
    .info-label { color: var(--gray); font-size: 16px; min-width: 120px; }
    .info-value { color: var(--white); font-size: 18px; text-transform: capitalize; }

    /* count tag */
    #pokemon-count {
      font-size: 14px;
      color: var(--gray);
      padding: 4px 12px;
      border-bottom: 2px solid #1a1a1a;
      background: #222;
    }
  </style>
</head>
<body>

<header>
  <div>
    <div class="header-title">‚öî Cobblemon Mastery Guide</div>
    <div class="header-subtitle">Serwerowa Baza Cobblemon ¬∑ Minecraft Mod</div>
  </div>
  <div class="header-right">
    <span class="mc-badge">üåø Generacje 1‚Äì9</span>
    <span class="mc-badge">‚öí PokeAPI</span>
    <button class="mc-btn" onclick="showPage('items')">üì¶ Przedmioty</button>
    <button class="mc-btn" onclick="showPage('apricorns')">üçé Apricorny</button>
    <button class="mc-btn" onclick="showPage('welcome')">üè† Start</button>
  </div>
</header>

<div class="app-layout">
  <!-- SIDEBAR -->
  <aside>
    <div class="sidebar-search">
      <label>üîç SZUKAJ POK√âMONA</label>
      <input class="mc-input" id="search-input" type="text" placeholder="np. Pikachu..." autocomplete="off" />
    </div>
    <div class="gen-filters" id="gen-filters">
      <button class="gen-filter-btn active" data-gen="0">Wszystkie</button>
      <button class="gen-filter-btn" data-gen="1">Gen I</button>
      <button class="gen-filter-btn" data-gen="2">Gen II</button>
      <button class="gen-filter-btn" data-gen="3">Gen III</button>
      <button class="gen-filter-btn" data-gen="4">Gen IV</button>
      <button class="gen-filter-btn" data-gen="5">Gen V</button>
      <button class="gen-filter-btn" data-gen="6">Gen VI</button>
      <button class="gen-filter-btn" data-gen="7">Gen VII</button>
      <button class="gen-filter-btn" data-gen="8">Gen VIII</button>
      <button class="gen-filter-btn" data-gen="9">Gen IX</button>
    </div>
    <div id="pokemon-count">≈Åadowanie...</div>
    <div class="pokemon-list" id="pokemon-list"></div>
  </aside>

  <!-- MAIN -->
  <main class="main-area" id="main-area">
    <!-- content injected by JS -->
  </main>
</div>

<div id="status-bar">
  <div class="spinner" id="spinner"></div>
  <span id="status-text">≈Åadowanie listy Pok√©mon√≥w...</span>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   COBBLEMON-SPECIFIC DATA
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const FRIENDSHIP_EVOS = new Set([
  'pichu','cleffa','igglybuff','togepi','chansey','golbat',
  'eevee','azurill','budew','buneary','riolu','happiny',
  'munchlax','chingling','woobat','swadloon'
]);

const FRIENDSHIP_DETAIL = {
  'pichu':    'Pichu ‚Üí Pikachu (wysoka przyja≈∫≈Ñ)',
  'cleffa':   'Cleffa ‚Üí Clefairy (wysoka przyja≈∫≈Ñ)',
  'igglybuff':'Igglybuff ‚Üí Jigglypuff (wysoka przyja≈∫≈Ñ)',
  'togepi':   'Togepi ‚Üí Togetic (wysoka przyja≈∫≈Ñ)',
  'chansey':  'Chansey ‚Üí Blissey (wysoka przyja≈∫≈Ñ)',
  'golbat':   'Golbat ‚Üí Crobat (wysoka przyja≈∫≈Ñ)',
  'eevee':    'Eevee ‚Üí Espeon (dzie≈Ñ + przyja≈∫≈Ñ) / Umbreon (noc + przyja≈∫≈Ñ)',
  'azurill':  'Azurill ‚Üí Marill (wysoka przyja≈∫≈Ñ)',
  'budew':    'Budew ‚Üí Roselia (wysoka przyja≈∫≈Ñ, dzie≈Ñ)',
  'buneary':  'Buneary ‚Üí Lopunny (wysoka przyja≈∫≈Ñ)',
  'riolu':    'Riolu ‚Üí Lucario (wysoka przyja≈∫≈Ñ, dzie≈Ñ)',
  'happiny':  'Happiny ‚Üí Chansey (niesiony OkrƒÖg≈Çy Kamie≈Ñ + przyja≈∫≈Ñ)',
  'munchlax': 'Munchlax ‚Üí Snorlax (wysoka przyja≈∫≈Ñ)',
  'chingling':'Chingling ‚Üí Chimecho (wysoka przyja≈∫≈Ñ, noc)',
  'woobat':   'Woobat ‚Üí Swoobat (wysoka przyja≈∫≈Ñ)',
  'swadloon': 'Swadloon ‚Üí Leavanny (wysoka przyja≈∫≈Ñ)',
};

const LINK_CABLE_EVOS = {
  'kadabra':   { result:'Alakazam', item:null },
  'machoke':   { result:'Machamp', item:null },
  'graveler':  { result:'Golem', item:null },
  'haunter':   { result:'Gengar', item:null },
  'onix':      { result:'Steelix', item:'Metal Coat' },
  'scyther':   { result:'Scizor', item:'Metal Coat' },
  'seadra':    { result:'Kingdra', item:'Dragon Scale' },
  'slowpoke':  { result:'Slowking', item:"King's Rock" },
  'poliwhirl': { result:'Politoed', item:"King's Rock" },
  'porygon':   { result:'Porygon2', item:'Up-Grade' },
  'porygon2':  { result:'Porygon-Z', item:'Dubious Disc' },
  'clamperl':  { result:'Huntail / Gorebyss', item:'Deep Sea Tooth / Deep Sea Scale' },
  'boldore':   { result:'Gigalith', item:null },
  'gurdurr':   { result:'Conkeldurr', item:null },
  'karrablast':{ result:'Escavalier', item:'wymiana z Shelmet' },
  'shelmet':   { result:'Accelgor', item:'wymiana z Karrablast' },
  'phantump':  { result:'Trevenant', item:null },
  'pumpkaboo': { result:'Gourgeist', item:null },
  'spritzee':  { result:'Aromatisse', item:'Sachet' },
  'swirlix':   { result:'Slurpuff', item:'Whipped Dream' },
  'feebas':    { result:'Milotic', item:'Prism Scale' },
};

// Generation ID ranges
const GEN_RANGES = [
  null,            // 0 = all
  [1,   151],
  [152, 251],
  [252, 386],
  [387, 493],
  [494, 649],
  [650, 721],
  [722, 809],
  [810, 905],
  [906, 1025],
];

const STAT_COLORS = {
  hp:              '#ff5555',
  attack:          '#f08030',
  defense:         '#f8d030',
  'special-attack':'#6890f0',
  'special-defense':'#78c850',
  speed:           '#f85888',
};
const STAT_NAMES = {
  hp:'HP', attack:'ATK', defense:'DEF',
  'special-attack':'SpATK','special-defense':'SpDEF', speed:'SPE'
};

// MOVE_DATA: [power, type, category]  category: P=physical S=special Z=status
const MOVE_DATA = {
  'hyper-voice':[90,'normal','S'],'boomburst':[140,'normal','S'],'body-slam':[85,'normal','P'],
  'double-edge':[120,'normal','P'],'facade':[70,'normal','P'],'return':[102,'normal','P'],
  'quick-attack':[40,'normal','P'],'extreme-speed':[80,'normal','P'],'last-resort':[140,'normal','P'],
  'swift':[60,'normal','S'],'swords-dance':[0,'normal','Z'],'rest':[0,'normal','Z'],
  'protect':[0,'normal','Z'],'substitute':[0,'normal','Z'],'recover':[0,'normal','Z'],
  'wish':[0,'normal','Z'],'belly-drum':[0,'normal','Z'],'work-up':[0,'normal','Z'],
  'slack-off':[0,'normal','Z'],'soft-boiled':[0,'normal','Z'],'milk-drink':[0,'normal','Z'],
  'shell-smash':[0,'normal','Z'],'egg-bomb':[100,'normal','P'],
  'thunderbolt':[90,'electric','S'],'thunder':[110,'electric','S'],'wild-charge':[90,'electric','P'],
  'volt-switch':[70,'electric','S'],'discharge':[80,'electric','S'],'thunder-punch':[75,'electric','P'],
  'spark':[65,'electric','P'],'rising-voltage':[70,'electric','S'],'nuzzle':[20,'electric','P'],
  'flamethrower':[90,'fire','S'],'fire-blast':[110,'fire','S'],'flare-blitz':[120,'fire','P'],
  'fire-punch':[75,'fire','P'],'mystical-fire':[75,'fire','S'],'overheat':[130,'fire','S'],
  'heat-wave':[95,'fire','S'],'will-o-wisp':[0,'fire','Z'],'burning-jealousy':[70,'fire','S'],
  'surf':[90,'water','S'],'hydro-pump':[110,'water','S'],'waterfall':[80,'water','P'],
  'scald':[80,'water','S'],'aqua-jet':[40,'water','P'],'aqua-tail':[90,'water','P'],
  'liquidation':[85,'water','P'],'flip-turn':[60,'water','P'],'rain-dance':[0,'water','Z'],
  'sparkling-aria':[90,'water','S'],'surging-strikes':[25,'water','P'],
  'moonblast':[95,'fairy','S'],'dazzling-gleam':[80,'fairy','S'],'play-rough':[90,'fairy','P'],
  'draining-kiss':[50,'fairy','S'],'disarming-voice':[40,'fairy','S'],'geomancy':[0,'fairy','Z'],
  'fleur-cannon':[130,'fairy','S'],'spirit-break':[75,'fairy','P'],'strange-steam':[90,'fairy','S'],
  'psychic':[90,'psychic','S'],'psyshock':[80,'psychic','S'],'future-sight':[120,'psychic','S'],
  'extrasensory':[80,'psychic','S'],'zen-headbutt':[80,'psychic','P'],'psybeam':[65,'psychic','S'],
  'calm-mind':[0,'psychic','Z'],'trick-room':[0,'psychic','Z'],'agility':[0,'psychic','Z'],
  'reflect':[0,'psychic','Z'],'stored-power':[20,'psychic','S'],'expanding-force':[80,'psychic','S'],
  'prismatic-laser':[160,'psychic','S'],'amnesia':[0,'psychic','Z'],'cosmic-power':[0,'psychic','Z'],
  'close-combat':[120,'fighting','P'],'aura-sphere':[80,'fighting','S'],'drain-punch':[75,'fighting','P'],
  'high-jump-kick':[130,'fighting','P'],'mach-punch':[40,'fighting','P'],'superpower':[120,'fighting','P'],
  'focus-blast':[120,'fighting','S'],'sacred-sword':[90,'fighting','P'],'bulk-up':[0,'fighting','Z'],
  'hammer-arm':[100,'fighting','P'],'thunderous-kick':[90,'fighting','P'],'vacuum-wave':[40,'fighting','S'],
  'earthquake':[100,'ground','P'],'earth-power':[90,'ground','S'],'stomping-tantrum':[75,'ground','P'],
  'dig':[80,'ground','P'],'stealth-rock':[0,'ground','Z'],'spikes':[0,'ground','Z'],
  'scorching-sands':[70,'ground','S'],'shore-up':[0,'ground','Z'],
  'energy-ball':[90,'grass','S'],'leaf-blade':[90,'grass','P'],'giga-drain':[75,'grass','S'],
  'power-whip':[120,'grass','P'],'wood-hammer':[120,'grass','P'],'leaf-storm':[130,'grass','S'],
  'solar-beam':[120,'grass','S'],'seed-bomb':[80,'grass','P'],'leech-seed':[0,'grass','Z'],
  'synthesis':[0,'grass','Z'],'grassy-glide':[70,'grass','P'],'spore':[0,'grass','Z'],
  'petal-dance':[120,'grass','S'],'giga-drain':[75,'grass','S'],
  'ice-beam':[90,'ice','S'],'blizzard':[110,'ice','S'],'ice-punch':[75,'ice','P'],
  'ice-shard':[40,'ice','P'],'icicle-crash':[85,'ice','P'],'freeze-dry':[70,'ice','S'],
  'glacial-lance':[120,'ice','P'],'aurora-veil':[0,'ice','Z'],'triple-axel':[20,'ice','P'],
  'shadow-ball':[80,'ghost','S'],'phantom-force':[90,'ghost','P'],'poltergeist':[110,'ghost','P'],
  'shadow-claw':[70,'ghost','P'],'shadow-sneak':[40,'ghost','P'],'moongeist-beam':[100,'ghost','S'],
  'hex':[65,'ghost','S'],'astral-barrage':[120,'ghost','S'],'destiny-bond':[0,'ghost','Z'],
  'dark-pulse':[80,'dark','S'],'crunch':[80,'dark','P'],'knock-off':[65,'dark','P'],
  'night-slash':[70,'dark','P'],'sucker-punch':[70,'dark','P'],'throat-chop':[80,'dark','P'],
  'wicked-blow':[80,'dark','P'],'nasty-plot':[0,'dark','Z'],'taunt':[0,'dark','Z'],
  'parting-shot':[0,'dark','Z'],'night-daze':[85,'dark','S'],'darkest-lariat':[85,'dark','P'],
  'fiery-wrath':[90,'dark','S'],'lash-out':[75,'dark','P'],
  'dragon-pulse':[85,'dragon','S'],'outrage':[120,'dragon','P'],'dragon-claw':[80,'dragon','P'],
  'draco-meteor':[130,'dragon','S'],'dragon-dance':[0,'dragon','Z'],'dual-chop':[40,'dragon','P'],
  'dragon-rush':[100,'dragon','P'],'clanging-scales':[110,'dragon','S'],'eternabeam':[160,'dragon','S'],
  'iron-head':[80,'steel','P'],'flash-cannon':[80,'steel','S'],'heavy-slam':[100,'steel','P'],
  'gyro-ball':[100,'steel','P'],'meteor-mash':[90,'steel','P'],'iron-defense':[0,'steel','Z'],
  'bullet-punch':[40,'steel','P'],'sunsteel-strike':[100,'steel','P'],'steel-beam':[140,'steel','S'],
  'stone-edge':[100,'rock','P'],'rock-slide':[75,'rock','P'],'power-gem':[80,'rock','S'],
  'stealth-rock':[0,'rock','Z'],'meteor-beam':[120,'rock','S'],'head-smash':[150,'rock','P'],
  'sludge-bomb':[90,'poison','S'],'gunk-shot':[120,'poison','P'],'poison-jab':[80,'poison','P'],
  'sludge-wave':[95,'poison','S'],'toxic':[0,'poison','Z'],'shell-side-arm':[90,'poison','S'],
  'bug-buzz':[90,'bug','S'],'leech-life':[80,'bug','P'],'x-scissor':[80,'bug','P'],
  'u-turn':[70,'bug','P'],'lunge':[80,'bug','P'],'first-impression':[90,'bug','P'],'quiver-dance':[0,'bug','Z'],
  'brave-bird':[120,'flying','P'],'hurricane':[110,'flying','S'],'air-slash':[75,'flying','S'],
  'acrobatics':[55,'flying','P'],'fly':[90,'flying','P'],'aerial-ace':[60,'flying','P'],
  'roost':[0,'flying','Z'],'tailwind':[0,'flying','Z'],'defog':[0,'flying','Z'],'dual-wingbeat':[40,'flying','P'],
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let allPokemon = [];       // [{id, name}]
let filteredList = [];
let selectedGen = 0;
let searchQuery = '';
let currentPage = 'welcome';
let selectedId = null;
let detailCache = {};
let listOffset = 0;
const PAGE_SIZE = 80;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function init() {
  setStatus('Pobieranie listy Pok√©mon√≥w z PokeAPI...', true);

  // Try cache
  const cached = localStorage.getItem('cob_pokemon_list');
  if (cached) {
    allPokemon = JSON.parse(cached);
    setStatus(`Za≈Çadowano ${allPokemon.length} Pok√©mon√≥w z cache.`, false);
  } else {
    try {
      const res = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
      const data = await res.json();
      allPokemon = data.results.map((p, i) => {
        const parts = p.url.split('/').filter(Boolean);
        const id = parseInt(parts[parts.length - 1]);
        return { id, name: p.name };
      }).filter(p => p.id <= 1025);
      localStorage.setItem('cob_pokemon_list', JSON.stringify(allPokemon));
      setStatus(`Za≈Çadowano ${allPokemon.length} Pok√©mon√≥w.`, false);
    } catch (e) {
      setStatus('B≈ÇƒÖd po≈ÇƒÖczenia z PokeAPI!', false);
    }
  }

  applyFilters();
  showPage('welcome');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FILTERS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function applyFilters() {
  const q = searchQuery.trim().toLowerCase();
  filteredList = allPokemon.filter(p => {
    if (selectedGen > 0) {
      const [lo, hi] = GEN_RANGES[selectedGen];
      if (p.id < lo || p.id > hi) return false;
    }
    if (q) {
      return p.name.includes(q) || String(p.id).includes(q);
    }
    return true;
  });
  listOffset = 0;
  renderList();
}

function renderList() {
  const container = document.getElementById('pokemon-list');
  document.getElementById('pokemon-count').textContent =
    `${filteredList.length} Pok√©mon√≥w`;

  if (filteredList.length === 0) {
    container.innerHTML = '<div class="empty-state"><span class="big-icon">üîç</span>Brak wynik√≥w</div>';
    return;
  }

  const chunk = filteredList.slice(0, listOffset + PAGE_SIZE);
  container.innerHTML = '';
  chunk.forEach(p => {
    const div = document.createElement('div');
    div.className = 'pokemon-entry' + (p.id === selectedId ? ' selected' : '');
    div.dataset.id = p.id;

    const hasFriendship = FRIENDSHIP_EVOS.has(p.name);
    const hasTrade = p.name in LINK_CABLE_EVOS;

    div.innerHTML = `
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${p.id}.png"
           onerror="this.src='data:image/svg+xml,<svg xmlns=\\'http://www.w3.org/2000/svg\\'/>'"/>
      <span class="entry-name">${p.name}</span>
      <span class="entry-id">#${String(p.id).padStart(3,'0')}</span>
      <div class="entry-badges">
        ${hasFriendship ? '<span class="badge-friendship" title="Ewolucja przez przyja≈∫≈Ñ">‚ô•</span>' : ''}
        ${hasTrade ? '<span class="badge-trade" title="Ewolucja przez wymianƒô (Link Cable)">‚áÑ</span>' : ''}
      </div>`;
    div.addEventListener('click', () => loadDetail(p.id, p.name));
    container.appendChild(div);
  });

  // infinite scroll sentinel
  if (chunk.length < filteredList.length) {
    const sentinel = document.createElement('div');
    sentinel.style.cssText = 'height:4px';
    sentinel.id = 'list-sentinel';
    container.appendChild(sentinel);

    const obs = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting) {
        obs.disconnect();
        listOffset += PAGE_SIZE;
        renderList();
      }
    });
    obs.observe(sentinel);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DETAIL
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function loadDetail(id, name) {
  selectedId = id;
  // highlight in list
  document.querySelectorAll('.pokemon-entry').forEach(el => {
    el.classList.toggle('selected', parseInt(el.dataset.id) === id);
  });

  showPage('detail-loading');
  setStatus(`Pobieranie danych: ${name}...`, true);

  try {
    let data = detailCache[id];
    if (!data) {
      const [pRes, sRes] = await Promise.all([
        fetch(`https://pokeapi.co/api/v2/pokemon/${id}`),
        fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`)
      ]);
      const p = await pRes.json();
      const s = await sRes.json();
      data = { p, s };
      detailCache[id] = data;
    }

    const evoChainUrl = data.s.evolution_chain?.url;
    let evoChain = null;
    if (evoChainUrl) {
      const evoRes = await fetch(evoChainUrl);
      evoChain = await evoRes.json();
    }

    renderDetail(data.p, data.s, evoChain, name);
    setStatus(`#${String(id).padStart(3,'0')} ${name}`, false);
  } catch(e) {
    setStatus('B≈ÇƒÖd podczas pobierania danych.', false);
    document.getElementById('main-area').innerHTML =
      `<div class="empty-state"><span class="big-icon">‚ö†</span>B≈ÇƒÖd po≈ÇƒÖczenia z PokeAPI.<br>Sprawd≈∫ internet.</div>`;
  }
}

function renderDetail(p, s, evoChain, name) {
  const isFriendship = FRIENDSHIP_EVOS.has(p.name);
  const isTradeEvo   = p.name in LINK_CABLE_EVOS;

  // flavor text (Polish not available, take English)
  const flavor = s.flavor_text_entries?.find(f => f.language.name === 'en')?.flavor_text
    ?.replace(/\f/g,' ') || '';

  // ‚îÄ‚îÄ IV SECTION BUILDER ‚îÄ‚îÄ
  function getIVColor(iv) {
    if (iv >= 28) return '#55ff55';
    if (iv >= 20) return '#f8d030';
    if (iv >= 10) return '#f08030';
    return '#ff5555';
  }
  function getIVLabel(iv) {
    if (iv >= 28) return '<span style="color:#55ff55">Doskona≈Çe</span>';
    if (iv >= 20) return '<span style="color:#f8d030">Dobre</span>';
    if (iv >= 10) return '<span style="color:#f08030">S≈Çabe</span>';
    return '<span style="color:#ff5555">Z≈Çe</span>';
  }

  function buildIVSection(stats) {
    const statMap = {};
    stats.forEach(s => { statMap[s.stat.name] = s.base_stat; });
    const atk   = statMap['attack']         || 0;
    const spatk = statMap['special-attack'] || 0;
    const def   = statMap['defense']        || 0;
    const spdef = statMap['special-defense']|| 0;
    const spe   = statMap['speed']          || 0;
    const hp    = statMap['hp']             || 0;

    const isPhysical = atk >= spatk + 15;
    const isSpecial  = spatk >= atk + 15;
    const isMixed    = !isPhysical && !isSpecial;
    const isTank     = (def + spdef) / 2 >= 90 && spe < 80;
    const isSpeedy   = spe >= 80;
    const isTrickRoom= spe <= 50;

    let role = '‚öñ Zbalansowany';
    if (isPhysical && isSpeedy) role = '‚öî Fizyczny AtakujƒÖcy';
    else if (isPhysical && isTank) role = 'üõ° Fizyczny Tank';
    else if (isPhysical) role = '‚öî Fizyczny';
    else if (isSpecial && isSpeedy) role = '‚ú® Specjalny AtakujƒÖcy';
    else if (isSpecial && isTank) role = 'üîÆ Specjalny Tank';
    else if (isSpecial) role = '‚ú® Specjalny';
    else if (isTank) role = 'üõ° Tank';
    else if (isSpeedy) role = 'üí® Szybko≈õciowy';
    else if (isMixed) role = '‚öî‚ú® Mieszany AtakujƒÖcy';

    // TARGET IV per stat: '31' | '0' | 'dowolne'
    const targets = {};
    // HP ‚Äî always 31
    targets['hp'] = { val: '31', color: '#55ff55', prio: true, note: 'Zawsze przydatne' };
    // Speed
    if (isTrickRoom) {
      targets['speed'] = { val: '0', color: '#aaa', prio: false, note: 'Trick Room ‚Äî chcesz byƒá wolniejszy!' };
    } else if (isSpeedy) {
      targets['speed'] = { val: '31', color: '#55ff55', prio: true, note: 'Kluczowe ‚Äî wyprzedzaj przeciwnik√≥w' };
    } else {
      targets['speed'] = { val: '‚â•20', color: '#f8d030', prio: false, note: 'Pomocne, nie krytyczne' };
    }
    // ATK
    if (isPhysical || isMixed) {
      targets['attack'] = { val: '31', color: '#55ff55', prio: true, note: 'G≈Ç√≥wne ≈∫r√≥d≈Ço obra≈ºe≈Ñ' };
    } else {
      targets['attack'] = { val: '0', color: '#888', prio: false, note: 'Nie u≈ºywasz atak√≥w fizycznych' };
    }
    // SpATK
    if (isSpecial || isMixed) {
      targets['special-attack'] = { val: '31', color: '#55ff55', prio: true, note: 'G≈Ç√≥wne ≈∫r√≥d≈Ço obra≈ºe≈Ñ' };
    } else {
      targets['special-attack'] = { val: '0', color: '#888', prio: false, note: 'Nie u≈ºywasz atak√≥w specjalnych' };
    }
    // DEF
    if (isTank || def >= 100) {
      targets['defense'] = { val: '31', color: '#55ff55', prio: true, note: 'Wysoka obrona ‚Äî warto maksowaƒá' };
    } else {
      targets['defense'] = { val: '‚â•20', color: '#f8d030', prio: false, note: 'Przydatne, nie priorytet' };
    }
    // SpDEF
    if (isTank || spdef >= 100) {
      targets['special-defense'] = { val: '31', color: '#55ff55', prio: true, note: 'Wysoka spec.obrona ‚Äî warto maksowaƒá' };
    } else {
      targets['special-defense'] = { val: '‚â•20', color: '#f8d030', prio: false, note: 'Przydatne, nie priorytet' };
    }

    // Build summary text
    const mustBe31 = ['hp','attack','defense','special-attack','special-defense','speed']
      .filter(sn => targets[sn].val === '31')
      .map(sn => `<span style="color:${STAT_COLORS[sn] || '#fff'}">${STAT_NAMES[sn]}</span>`);
    const mustBe0  = ['attack','special-attack','speed']
      .filter(sn => targets[sn].val === '0')
      .map(sn => `<span style="color:#888">${STAT_NAMES[sn]}</span>`);
    let summaryLine = `Celuj w <b style="color:#55ff55">31</b>: ${mustBe31.join(', ')}`;
    if (mustBe0.length) summaryLine += `<br>Zostaw na <b style="color:#888">0</b> (nieu≈ºywane): ${mustBe0.join(', ')}`;

    const ORDER = ['hp','attack','defense','special-attack','special-defense','speed'];
    const rows = ORDER.map(sn => {
      const label = STAT_NAMES[sn] || sn;
      const color = STAT_COLORS[sn] || '#888';
      const t = targets[sn];
      const rowClass = t.prio ? 'iv-row iv-row-priority' : 'iv-row';
      const prioIcon = t.prio ? '‚≠ê' : '‚ñ™';
      const defaultVal = t.val === '0' ? 0 : 31;
      return `<div class="${rowClass}" id="iv-row-${sn}">
        <span class="iv-priority" title="${t.note}">${prioIcon}</span>
        <span class="iv-name" style="color:${color}">${label}</span>
        <input class="iv-input" type="number" min="0" max="31" value="${defaultVal}"
               data-stat="${sn}" oninput="updateIVBar(this)" />
        <div class="iv-bar-wrap">
          <div class="iv-bar" id="ivbar-${sn}" style="width:${Math.round(defaultVal/31*100)}%;background:${getIVColor(defaultVal)}"></div>
        </div>
        <div class="iv-target" style="color:${t.color}" title="${t.note}">CEL: ${t.val}</div>
        <div class="iv-label" id="ivlabel-${sn}">${getIVLabel(defaultVal)}</div>
      </div>`;
    }).join('');

    return `<div class="iv-section">
      <h2>üé≤ Individual Values (IV) &nbsp;<span style="font-size:11px;color:#aaa;font-family:VT323,monospace">skala 0‚Äì31</span></h2>
      <div class="iv-role-badge">Rola: ${role}</div>
      <div class="iv-summary">${summaryLine}</div>
      <div style="font-size:14px;color:#666;margin-bottom:6px">‚≠ê priorytet (CEL: warto≈õƒá docelowa) &nbsp;|&nbsp; ‚ñ™ mniej wa≈ºne &nbsp;|&nbsp; Zmie≈Ñ liczby ≈ºeby sprawdziƒá jako≈õƒá swoich IV</div>
      ${rows}
      <div class="iv-legend">
        <div class="iv-legend-item"><div class="iv-legend-dot" style="background:#55ff55"></div>28‚Äì31 Doskona≈Çe</div>
        <div class="iv-legend-item"><div class="iv-legend-dot" style="background:#f8d030"></div>20‚Äì27 Dobre</div>
        <div class="iv-legend-item"><div class="iv-legend-dot" style="background:#f08030"></div>10‚Äì19 S≈Çabe</div>
        <div class="iv-legend-item"><div class="iv-legend-dot" style="background:#ff5555"></div>0‚Äì9 Z≈Çe</div>
      </div>
    </div>`;
  }

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // ROLE HELPERS (shared by IV, EV, Item, Moveset)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function detectRole(statMap) {
    const atk   = statMap['attack']         || 0;
    const spatk = statMap['special-attack'] || 0;
    const def   = statMap['defense']        || 0;
    const spdef = statMap['special-defense']|| 0;
    const spe   = statMap['speed']          || 0;
    const hp    = statMap['hp']             || 0;
    const isPhys  = atk   >= spatk + 15;
    const isSpec  = spatk >= atk   + 15;
    const isMixed = !isPhys && !isSpec;
    const isTank  = (def + spdef) / 2 >= 90 && spe < 80;
    const isFast  = spe >= 80;
    const isTR    = spe <= 50;  // trick-room candidate
    let label = '‚öñ Zbalansowany';
    if (isPhys  && isFast)  label = '‚öî Fizyczny AtakujƒÖcy';
    else if (isPhys  && isTank)  label = 'üõ° Fizyczny Tank';
    else if (isPhys)              label = '‚öî Fizyczny (wolny)';
    else if (isSpec  && isFast)  label = '‚ú® Specjalny AtakujƒÖcy';
    else if (isSpec  && isTank)  label = 'üîÆ Specjalny Tank';
    else if (isSpec)              label = '‚ú® Specjalny (wolny)';
    else if (isTank)              label = 'üõ° Tank';
    else if (isFast)              label = 'üí® Szybki Mieszany';
    else                          label = '‚öî‚ú® Mieszany';
    return { atk, spatk, def, spdef, spe, hp, isPhys, isSpec, isMixed, isTank, isFast, isTR, label };
  }

  // ‚îÄ‚îÄ‚îÄ EV SPREAD ‚îÄ‚îÄ‚îÄ
  function buildEVSection(statMap) {
    const r = detectRole(statMap);
    let spread = [];
    let note = '';

    if (r.isPhys && r.isFast && !r.isTank) {
      spread = [['attack',252],['speed',252],['hp',4]];
      note = 'Maksuj obra≈ºenia i wyprzed≈∫ przeciwnik√≥w.';
    } else if (r.isPhys && r.isTank) {
      const defStat = r.def >= r.spdef ? 'defense' : 'special-defense';
      spread = [['hp',252],['attack',128],[defStat,128]];
      note = 'Bulky Attacker ‚Äî prze≈ºyj i bij.';
    } else if (r.isPhys && r.isTR) {
      spread = [['attack',252],['hp',252],['speed',4]];
      note = 'Trick Room ‚Äî bƒÖd≈∫ wolny, bij mocno.';
    } else if (r.isPhys) {
      spread = [['attack',252],['hp',128],['speed',128]];
      note = 'Fizyczny bez pe≈Çnej szybko≈õci ‚Äî balans.';
    } else if (r.isSpec && r.isFast && !r.isTank) {
      spread = [['special-attack',252],['speed',252],['hp',4]];
      note = 'Maksuj obra≈ºenia specjalne i szybko≈õƒá.';
    } else if (r.isSpec && r.isTank) {
      spread = [['hp',252],['special-defense',252],['special-attack',4]];
      note = 'Specjalny Tank ‚Äî wytrzyma≈Ço≈õƒá na pierwszym miejscu.';
    } else if (r.isSpec && r.isTR) {
      spread = [['special-attack',252],['hp',252],['speed',4]];
      note = 'Trick Room ‚Äî powolny niszczycie spe.';
    } else if (r.isSpec) {
      spread = [['special-attack',252],['hp',128],['speed',128]];
      note = 'Specjalny bez pe≈Çnej szybko≈õci ‚Äî balans.';
    } else if (r.isTank) {
      spread = [['hp',252],['defense',128],['special-defense',128]];
      note = 'Pe≈Çny Tank ‚Äî wytrzyma≈Ço≈õƒá jest priorytetem.';
    } else {
      spread = [['attack',128],['special-attack',128],['speed',252]];
      note = 'Mieszany AtakujƒÖcy ‚Äî szybko≈õƒá + obie ofensywy.';
    }
    const total = spread.reduce((s,[, v]) => s + v, 0);
    const evRows = spread.map(([sn, val]) => {
      const color = STAT_COLORS[sn] || '#888';
      const pct   = Math.round(val / 252 * 100);
      return `<div class="ev-row">
        <span class="ev-amount">${val}</span>
        <span class="ev-stat-name" style="color:${color}">${STAT_NAMES[sn]||sn}</span>
        <div class="ev-bar-bg"><div class="ev-bar" style="width:${pct}%;background:${color}"></div></div>
      </div>`;
    }).join('');
    return `<div class="comp-box">
      <div class="comp-box-title">üìä EVs <span style="font-size:10px;color:#888;font-family:VT323,monospace">(max 510)</span></div>
      ${evRows}
      <div class="ev-total">Suma: ${total}/510</div>
      <div style="font-size:14px;color:#666;margin-top:5px">${note}</div>
    </div>`;
  }

  // ‚îÄ‚îÄ‚îÄ NATURE ‚îÄ‚îÄ‚îÄ
  function buildNatureBox(statMap) {
    const r = detectRole(statMap);
    let name, up, down, why;
    if (r.isPhys && r.isFast)        { name='Jolly';   up='+SPE'; down='-SpATK'; why='Szybszy bez straty ATK'; }
    else if (r.isPhys && r.isTR)     { name='Brave';   up='+ATK'; down='-SPE';   why='Trick Room ‚Äî wolniejszy+mocniejszy'; }
    else if (r.isPhys)               { name='Adamant'; up='+ATK'; down='-SpATK'; why='Maks ATK bez potrzeby SPE'; }
    else if (r.isSpec && r.isFast)   { name='Timid';   up='+SPE'; down='-ATK';   why='Szybszy bez straty SpATK'; }
    else if (r.isSpec && r.isTR)     { name='Quiet';   up='+SpATK'; down='-SPE'; why='Trick Room ‚Äî wolniejszy+mocniejszy'; }
    else if (r.isSpec && r.isTank)   { name='Calm';    up='+SpDEF'; down='-ATK'; why='Tanking specjalnych atak√≥w'; }
    else if (r.isSpec)               { name='Modest';  up='+SpATK'; down='-ATK'; why='Maks SpATK bez potrzeby SPE'; }
    else if (r.isTank && r.def >= r.spdef) { name='Impish'; up='+DEF'; down='-SpATK'; why='Fizyczna wytrzyma≈Ço≈õƒá'; }
    else if (r.isTank)               { name='Calm';    up='+SpDEF'; down='-ATK';  why='Specjalna wytrzyma≈Ço≈õƒá'; }
    else                             { name='Jolly';   up='+SPE'; down='-SpATK'; why='Szybko≈õƒá u mieszanych'; }
    return `<div class="comp-box">
      <div class="comp-box-title">üíé Natura</div>
      <div class="nature-badge">${name}</div>
      <div class="nature-detail">
        <span class="nature-up">‚ñ≤ ${up}</span>
        &nbsp;|&nbsp;
        <span class="nature-down">‚ñº ${down}</span>
      </div>
      <div style="font-size:14px;color:#666;margin-top:6px">${why}</div>
    </div>`;
  }

  // ‚îÄ‚îÄ‚îÄ HELD ITEM ‚îÄ‚îÄ‚îÄ
  const HELD_ITEMS = {
    'Choice Band':   { cat:'P', fast:true,  desc:'ATK √ó1.5 ‚Äî tylko jeden atak' },
    'Choice Specs':  { cat:'S', fast:true,  desc:'SpATK √ó1.5 ‚Äî tylko jeden atak' },
    'Choice Scarf':  { cat:'X', fast:false, desc:'SPE √ó1.5 ‚Äî tylko jeden atak' },
    'Life Orb':      { cat:'O', fast:true,  desc:'+30% obra≈ºe≈Ñ, -10% HP za atak' },
    'Leftovers':     { cat:'T', fast:false, desc:'Regeneruje 1/16 HP co turƒô' },
    'Assault Vest':  { cat:'A', fast:false, desc:'+50% SpDEF, nie mo≈ºna u≈ºywaƒá statu≈ü√≥w' },
    'Rocky Helmet':  { cat:'R', fast:false, desc:'Kontaktowe ataki zadajƒÖ 1/6 HP atakujƒÖcemu' },
  };
  function buildItemBox(statMap) {
    const r = detectRole(statMap);
    let item, icon;
    if (r.isTank && r.isSpec)             { item = 'Leftovers'; icon = 'üçù'; }
    else if (r.isTank && r.isPhys)        { item = 'Rocky Helmet'; icon = '‚ö™'; }
    else if (r.isTank)                    { item = 'Leftovers'; icon = 'üçù'; }
    else if (r.isPhys && r.isFast && r.spe >= 100) { item = 'Choice Band'; icon = 'üß§'; }
    else if (r.isSpec && r.isFast && r.spe >= 100) { item = 'Choice Specs'; icon = 'üëì'; }
    else if (r.isPhys && r.isFast)        { item = 'Life Orb'; icon = 'üîÆ'; }
    else if (r.isSpec && r.isFast)        { item = 'Life Orb'; icon = 'üîÆ'; }
    else if (r.isMixed)                   { item = 'Life Orb'; icon = 'üîÆ'; }
    else                                  { item = 'Leftovers'; icon = 'üçù'; }
    const d = HELD_ITEMS[item];
    return `<div class="comp-box">
      <div class="comp-box-title">üì¶ Held Item</div>
      <div style="font-size:28px;text-align:center;margin:4px 0">${icon}</div>
      <div class="item-big-name">${item}</div>
      <div class="item-big-desc">${d.desc}</div>
    </div>`;
  }

  // ‚îÄ‚îÄ‚îÄ BEST 4 MOVESET ‚îÄ‚îÄ‚îÄ
  function buildBest4(moves, pokemonTypes, statMap) {
    const r = detectRole(statMap);
    const typeSet = new Set(pokemonTypes);

    // Collect all learnable moves with their data
    const pool = [];
    moves.forEach(m => {
      const vgd = m.version_group_details
        .slice()
        .sort((a, b) => b.version_group.url.localeCompare(a.version_group.url, undefined,{numeric:true}))[0];
      if (!vgd) return;
      const method = vgd.move_learn_method.name;
      if (!['level-up','machine','egg'].includes(method)) return;
      const nm = m.move.name;
      const md = MOVE_DATA[nm];
      const lv = vgd.level_learned_at;
      const power = md ? md[0] : 0;
      const mtype = md ? md[1] : 'normal';
      const cat   = md ? md[2] : (power > 0 ? (r.isPhys ? 'P' : 'S') : 'Z');

      let score = 0;
      if (cat === 'Z') {
        // Setup moves score: 60 for offensive setup, 40 for defensive, 20 for utility
        const offSetup = ['swords-dance','dragon-dance','nasty-plot','quiver-dance','tail-glow',
          'shell-smash','belly-drum','work-up','geomancy','calm-mind','bulk-up','coil'];
        const defSetup = ['recover','roost','soft-boiled','slack-off','milk-drink','synthesis',
          'moonlight','morning-sun','wish','rest','shore-up'];
        if (offSetup.includes(nm)) score = 80;
        else if (defSetup.includes(nm)) score = r.isTank ? 70 : 30;
        else score = 15; // utility: stealth-rock, toxic, etc.
      } else {
        score = power;
        const catMatch = (r.isPhys && !r.isSpec && cat === 'P') ||
                         (r.isSpec && !r.isPhys && cat === 'S') ||
                         r.isMixed;
        if (catMatch) score *= 1.4;
        if (typeSet.has(mtype)) score *= 1.5; // STAB
        // priority moves bonus
        const prioMoves = ['extreme-speed','quick-attack','aqua-jet','ice-shard','mach-punch',
          'bullet-punch','sucker-punch','shadow-sneak','vacuum-wave','first-impression'];
        if (prioMoves.includes(nm)) score += 25;
      }
      pool.push({ nm, power, mtype, cat, score, lv, method });
    });

    // Deduplicate by name
    const seen = new Set();
    const unique = pool.filter(m => { if (seen.has(m.nm)) return false; seen.add(m.nm); return true; });
    unique.sort((a, b) => b.score - a.score);

    // Pick top 4 with diversity: max 2 of same type, mix cats
    const chosen = [];
    const typeCounts = {};
    let offensiveCount = 0;
    const maxPerType = 2;
    for (const m of unique) {
      if (chosen.length >= 4) break;
      const tc = typeCounts[m.mtype] || 0;
      if (tc >= maxPerType) continue;
      // Make sure at least 1 setup/utility if role is tank, at least 2 offensive if attacker
      typeCounts[m.mtype] = tc + 1;
      chosen.push(m);
      if (m.cat !== 'Z') offensiveCount++;
    }
    // If we have fewer than 4, fill from sorted list regardless
    for (const m of unique) {
      if (chosen.length >= 4) break;
      if (!chosen.includes(m)) chosen.push(m);
    }

    if (!chosen.length) return '<div style="color:#666">Brak danych o atakach.</div>';

    const stars = score => {
      if (score >= 180) return '‚≠ê‚≠ê‚≠ê‚≠ê';
      if (score >= 120) return '‚≠ê‚≠ê‚≠ê';
      if (score >= 60)  return '‚≠ê‚≠ê';
      return '‚≠ê';
    };

    const catLabel = cat => cat === 'P' ? `<span class="move-cat-p">Fiz.</span>` :
                            cat === 'S' ? `<span class="move-cat-s">Spec.</span>` :
                            `<span class="move-cat-z">Status</span>`;
    const stabLabel = (mtype, isStab) => isStab
      ? `<span class="move-stab">STAB</span>`
      : `<span class="move-coverage">${mtype}</span>`;

    return chosen.map((m, i) => {
      const isStab = typeSet.has(m.mtype);
      const pwrStr = m.power > 0 ? `<span class="move-power">PWR: ${m.power}</span>` : `<span class="move-power" style="color:#666">Status</span>`;
      return `<div class="move-card">
        <span class="move-card-num">${i + 1}</span>
        <div class="move-card-name">${m.nm.replace(/-/g,' ')}</div>
        <div class="move-card-meta">
          ${catLabel(m.cat)}
          ${stabLabel(m.mtype, isStab)}
          ${pwrStr}
        </div>
        <div class="move-stars">${stars(m.score)}</div>
      </div>`;
    }).join('');
  }

  // ‚îÄ‚îÄ‚îÄ FULL COMPETITIVE SECTION (wraps all above) ‚îÄ‚îÄ‚îÄ
  function buildCompetitiveSection(stats, pokemonTypes, moves) {
    const statMap = {};
    stats.forEach(s => { statMap[s.stat.name] = s.base_stat; });
    const r = detectRole(statMap);
    const best4HTML = buildBest4(moves, pokemonTypes, statMap);
    return `<div class="comp-section">
      <h2>üèÜ Competitive Build &mdash; ${r.label}</h2>
      <div class="comp-grid">
        ${buildEVSection(statMap)}
        ${buildNatureBox(statMap)}
        ${buildItemBox(statMap)}
      </div>
      <div class="comp-box-title" style="margin-bottom:8px">‚öî Best 4 Moveset</div>
      <div style="font-size:14px;color:#666;margin-bottom:8px">Automatycznie dobrane 4 ataki na podstawie typ√≥w i statystyk. Weryfikuj z Cobblemon wiki.</div>
      <div class="best4-grid">${best4HTML}</div>
    </div>`;
  }

  // ‚îÄ‚îÄ‚îÄ FULL MOVELIST (tabs) ‚îÄ‚îÄ‚îÄ
  function buildMovesSection(moves) {
    const lvlMoves = [], tmMoves = [], eggMoves = [];
    moves.forEach(m => {
      const vgd = m.version_group_details
        .slice()
        .sort((a, b) => b.version_group.url.localeCompare(a.version_group.url, undefined, {numeric:true}))[0];
      if (!vgd) return;
      const method = vgd.move_learn_method.name;
      const lv = vgd.level_learned_at;
      const nm = m.move.name;
      if (method === 'level-up')    lvlMoves.push({ name: nm, lv });
      else if (method === 'machine') tmMoves.push({ name: nm });
      else if (method === 'egg')    eggMoves.push({ name: nm });
    });
    lvlMoves.sort((a, b) => a.lv - b.lv);
    tmMoves.sort((a, b) => a.name.localeCompare(b.name));
    eggMoves.sort((a, b) => a.name.localeCompare(b.name));

    const lvlHTML = lvlMoves.length
      ? `<table class="move-table"><tr><th>Lv</th><th>Atak</th><th>Typ</th><th>PWR</th></tr>
          ${lvlMoves.map(m => {
            const md = MOVE_DATA[m.name];
            return `<tr><td><span class="move-lv">${m.lv||'‚Äî'}</span></td>
              <td class="move-name">${m.name.replace(/-/g,' ')}</td>
              <td><span class="type-badge type-${md?md[1]:'normal'}" style="font-size:12px;padding:1px 6px">${md?md[1]:'?'}</span></td>
              <td style="color:#f8d030;font-size:17px">${md?md[0]||'‚Äî':'‚Äî'}</td>
            </tr>`;
          }).join('')}
        </table>`
      : '<div style="color:#666">Brak.</div>';

    const tmHTML = tmMoves.length
      ? `<div style="display:flex;flex-wrap:wrap;gap:6px;padding-top:4px">${tmMoves.map(m => `<span class="move-tm">${m.name.replace(/-/g,' ')}</span>`).join('')}</div>`
      : '<div style="color:#666">Brak.</div>';

    const eggHTML = eggMoves.length
      ? `<div style="display:flex;flex-wrap:wrap;gap:6px;padding-top:4px">${eggMoves.map(m => `<span style="background:#1a0a1a;color:#c084fc;border:1px solid #7c3aed;padding:1px 8px;font-size:15px">${m.name.replace(/-/g,' ')}</span>`).join('')}</div>`
      : '<div style="color:#666">Brak.</div>';

    return `<div class="moves-section">
      <h2>üìú Pe≈Çna lista atak√≥w</h2>
      <div class="moves-tabs">
        <button class="moves-tab active" onclick="switchMovesTab(this,'mv-lvl')">üìà Przez poziom (${lvlMoves.length})</button>
        <button class="moves-tab" onclick="switchMovesTab(this,'mv-tm')">üíø TM/TR (${tmMoves.length})</button>
        ${eggMoves.length ? `<button class="moves-tab" onclick="switchMovesTab(this,'mv-egg')">ü•ö Egg Moves (${eggMoves.length})</button>` : ''}
      </div>
      <div class="moves-panel active" id="mv-lvl">${lvlHTML}</div>
      <div class="moves-panel" id="mv-tm">${tmHTML}</div>
      ${eggMoves.length ? `<div class="moves-panel" id="mv-egg">${eggHTML}</div>` : ''}
    </div>`;
  }

  // Build stats HTML
  const statsHTML = p.stats.map(st => {
    const sname = STAT_NAMES[st.stat.name] || st.stat.name;
    const val = st.base_stat;
    const pct = Math.min(100, Math.round(val / 255 * 100));
    const color = STAT_COLORS[st.stat.name] || '#888';
    return `<div class="stat-row">
      <span class="stat-name">${sname}</span>
      <span class="stat-val">${val}</span>
      <div class="stat-bar-bg"><div class="stat-bar" style="width:${pct}%;background:${color}"></div></div>
    </div>`;
  }).join('');

  // Types
  const typesHTML = p.types.map(t =>
    `<span class="type-badge type-${t.type.name}">${t.type.name}</span>`
  ).join('');

  // Evo chain
  const evoHTML = evoChain ? renderEvoChain(evoChain.chain) : '<span style="color:#666">Brak danych ewolucji</span>';

  // Cobblemon section
  let cobHTML = '';

  if (isFriendship) {
    const detail = FRIENDSHIP_DETAIL[p.name] || 'Wymaga wysokiej przyja≈∫ni.';
    cobHTML += `<div class="info-row">
      <span class="info-icon">üíõ</span>
      <div class="info-text">
        <em>Ewolucja przez Przyja≈∫≈Ñ</em><br>
        ${detail}<br>
        Sprawd≈∫ poziom przyja≈∫ni komendƒÖ:
        <div class="cmd-block">/checkfriendship @s</div>
        <div style="font-size:15px;color:#888;margin-top:4px;">Potrzebujesz ‚â• 160 friendship do ewolucji (max 255).</div>
      </div>
    </div>`;
  }

  if (isTradeEvo) {
    const t = LINK_CABLE_EVOS[p.name];
    cobHTML += `<div class="info-row">
      <span class="info-icon">üîó</span>
      <div class="info-text">
        <em>Ewolucja przez Link Cable</em> ‚Üí <em>${t.result}</em><br>
        ${t.item ? `Trzymany przedmiot: <code>${t.item}</code><br>` : 'Brak wymaganego przedmiotu.<br>'}
        U≈ºyj <code>Link Cable</code> i aktywuj go w rƒôce, gdy jeste≈õ w pobli≈ºu innego gracza.
      </div>
    </div>`;
  }

  // Abilities
  const abilitiesHTML = p.abilities.map(a =>
    `<span style="color:${a.is_hidden ? '#a855f7' : '#55ffff'}">${a.ability.name}${a.is_hidden ? ' <span style="font-size:13px;color:#a855f7">[ukryta]</span>' : ''}</span>`
  ).join(', ');

  // Height/weight
  const height = (p.height / 10).toFixed(1);
  const weight = (p.weight / 10).toFixed(1);

  // gen calc
  function getGen(id) {
    for (let g = 1; g <= 9; g++) {
      const [lo, hi] = GEN_RANGES[g];
      if (id >= lo && id <= hi) return `Generacja ${['I','II','III','IV','V','VI','VII','VIII','IX'][g-1]}`;
    }
    return '?';
  }

  if (!cobHTML) {
    cobHTML = `<div class="info-row">
      <span class="info-icon">‚úÖ</span>
      <div class="info-text">Ten Pok√©mon nie wymaga specjalnych warunk√≥w Cobblemon.<br>
        <span style="color:#666;font-size:16px;">Standardowa ewolucja przez poziom lub kamie≈Ñ.</span>
      </div>
    </div>`;
  }

  // Official artwork
  const artworkUrl = p.sprites?.other?.['official-artwork']?.front_default ||
    `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${p.id}.png`;

  document.getElementById('main-area').innerHTML = `
    <div class="page-title">
      <span>#${String(p.id).padStart(3,'0')} ${p.name.toUpperCase()}</span>
    </div>

    <div class="detail-grid">
      <!-- LEFT COLUMN -->
      <div>
        <div class="mc-panel pokemon-portrait">
          <img src="${artworkUrl}"
               onerror="this.src='https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${p.id}.png'"
               alt="${p.name}" style="width:160px;height:160px"/>
          <div class="pokemon-name-big">${p.name}</div>
          <div class="pokemon-number">#${String(p.id).padStart(3,'0')} ¬∑ ${getGen(p.id)}</div>
          <div class="types" style="margin-top:10px">${typesHTML}</div>
          <hr class="section-sep" style="margin:10px 0">
          <div style="font-size:16px;color:#888;font-style:italic;max-width:200px;margin:0 auto;text-align:center">${flavor}</div>
        </div>

        <div class="mc-panel" style="margin-top:12px">
          <h2>üìã Dane podstawowe</h2>
          <div class="info-entry"><span class="info-label">Wzrost:</span><span class="info-value">${height} m</span></div>
          <div class="info-entry"><span class="info-label">Waga:</span><span class="info-value">${weight} kg</span></div>
          <div class="info-entry"><span class="info-label">Typy:</span><span class="info-value">${p.types.map(t=>t.type.name).join(', ')}</span></div>
          <div class="info-entry"><span class="info-label">Zdolno≈õci:</span><span class="info-value" style="font-size:16px">${abilitiesHTML}</span></div>
          <div class="info-entry"><span class="info-label">Habitat:</span><span class="info-value">${s.habitat?.name || '‚Äî'}</span></div>
          <div class="info-entry"><span class="info-label">Capture Rate:</span><span class="info-value">${s.capture_rate}/255</span></div>
          <div class="info-entry"><span class="info-label">Base Exp:</span><span class="info-value">${p.base_experience || '?'}</span></div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div>
        <div class="mc-panel">
          <h2>üìä Statystyki bazowe</h2>
          ${statsHTML}
          <div style="font-size:15px;color:#666;margin-top:6px;">
            Suma: <span style="color:#fff">${p.stats.reduce((a,s)=>a+s.base_stat,0)}</span>
          </div>
        </div>

        ${buildIVSection(p.stats)}

        <div class="mc-panel" style="margin-top:12px">
          <h2>üß¨ ≈Åa≈Ñcuch ewolucji</h2>
          <div class="evo-chain" id="evo-chain-container">${evoHTML}</div>
        </div>
      </div>
    </div>

    <!-- COBBLEMON SECTION -->
    <div class="cobblemon-section" style="margin-top:16px">
      <h2><span class="cob-icon">‚öî</span> Polecane dla Cobblemon</h2>
      ${cobHTML}
    </div>

    <!-- COMPETITIVE BUILD -->
    ${buildCompetitiveSection(p.stats, p.types.map(t=>t.type.name), p.moves)}

    <!-- FULL MOVELIST -->
    ${buildMovesSection(p.moves)}

    <div style="height:40px"></div>
  `;

  // IV bar live update
  document.querySelectorAll('.iv-input').forEach(inp => updateIVBar(inp));

  // Make evo items clickable
  document.querySelectorAll('.evo-item[data-evo-name]').forEach(el => {
    el.addEventListener('click', () => {
      const n = el.dataset.evoName;
      const found = allPokemon.find(p => p.name === n);
      if (found) loadDetail(found.id, found.name);
    });
  });
}

function renderEvoChain(chain) {
  let html = '';
  function walk(node, first = true) {
    const name = node.species.name;
    const id = node.species.url.split('/').filter(Boolean).pop();
    html += `<div class="evo-item" data-evo-name="${name}">
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png" alt="${name}"/>
      <span>${name}</span>
    </div>`;
    if (node.evolves_to && node.evolves_to.length > 0) {
      node.evolves_to.forEach(next => {
        const det = next.evolution_details?.[0];
        let trigger = '';
        if (det) {
          if (det.min_level)        trigger = `Lv.${det.min_level}`;
          else if (det.item)        trigger = det.item.name;
          else if (det.trigger?.name === 'trade') trigger = 'trade';
          else if (det.trigger?.name === 'use-item') trigger = det.item?.name || 'item';
          else if (det.min_happiness) trigger = `‚ô• przyja≈∫≈Ñ`;
        }
        html += `<div style="display:flex;flex-direction:column;align-items:center">
          <span class="evo-arrow">‚Üí</span>
          <span class="evo-trigger">${trigger}</span>
        </div>`;
        walk(next, false);
      });
    }
  }
  walk(chain);
  return html;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PAGES
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showPage(page) {
  currentPage = page;
  const main = document.getElementById('main-area');

  if (page === 'welcome') {
    main.innerHTML = `
      <div class="page-title"><span>üè† Cobblemon Mastery Guide</span></div>
      <div class="welcome-grid">
        <div class="welcome-card">
          <h3>‚öî Czym jest Cobblemon?</h3>
          <p>Cobblemon to mod do Minecrafta integrujƒÖcy creatury inspirowane Pok√©monami. ≈Åap, trenuj i ewoluuj swoje stworzenia w ≈õwiecie Minecrafta!</p>
        </div>
        <div class="welcome-card">
          <h3>üîç Jak u≈ºywaƒá bazy?</h3>
          <ul>
            <li>Wyszukaj Pok√©mona w pasku po lewej</li>
            <li>Filtruj wed≈Çug generacji (I‚ÄìIX)</li>
            <li>Ikona ‚ô• = ewolucja przez przyja≈∫≈Ñ</li>
            <li>Ikona ‚áÑ = ewolucja przez wymianƒô</li>
          </ul>
        </div>
        <div class="welcome-card">
          <h3>üíõ Przyja≈∫≈Ñ (/checkfriendship)</h3>
          <p>W Cobblemonie ewolucje przez przyja≈∫≈Ñ sprawdzasz komendƒÖ:</p>
          <div class="cmd-block">/checkfriendship @s</div>
          <p style="margin-top:8px;font-size:16px;color:#888">Potrzebujesz min. 160/255.</p>
        </div>
        <div class="welcome-card">
          <h3>üîó Link Cable (Wymiana)</h3>
          <p>Zastƒôpuje wymianƒô Pok√©mon√≥w z oryginalnych gier. Aktywuj w rƒôce, bƒôdƒÖc blisko innego gracza.</p>
          <p style="margin-top:6px;font-size:16px;color:#888">Crafting: 4√ó Iron Ingot + 1√ó Copper Ingot + 4√ó String</p>
        </div>
        <div class="welcome-card">
          <h3>üçé Apricorny</h3>
          <p>Zbieraj Apricorny z drzew i craftuj unikalne Pokeballsy z r√≥≈ºnymi efektami!</p>
          <p style="margin-top:6px"><button class="mc-btn" onclick="showPage('apricorns')">‚Üí PrzeglƒÖdaj Apricorny</button></p>
        </div>
        <div class="welcome-card">
          <h3>üì¶ Kluczowe Przedmioty</h3>
          <p>Link Cable, kamienie ewolucji, held items ‚Äî wszystkie wa≈ºne przedmioty zebrali≈õmy w jednym miejscu.</p>
          <p style="margin-top:6px"><button class="mc-btn" onclick="showPage('items')">‚Üí PrzeglƒÖdaj przedmioty</button></p>
        </div>
      </div>`;
  }

  if (page === 'detail-loading') {
    main.innerHTML = `<div class="empty-state"><span class="big-icon">‚öô</span>≈Åadowanie danych Pok√©mona...</div>`;
  }

  if (page === 'items') {
    main.innerHTML = `
      <div class="page-title"><span>üì¶ Kluczowe Przedmioty Cobblemon</span></div>
      <div class="items-grid">
        ${renderItems()}
      </div>`;
  }

  if (page === 'apricorns') {
    main.innerHTML = `
      <div class="page-title"><span>üçé Apricorny i Pok√©balle</span></div>
      <div class="mc-panel" style="margin-bottom:16px">
        <h2>‚ÑπÔ∏è JAK ZBIERAƒÜ APRICORNY?</h2>
        <p style="font-size:18px;color:#aaa;line-height:1.6">
          Drzewa Apricorn√≥w rosnƒÖ naturalnie w r√≥≈ºnych biomach. Zbieraj owoce i craftuj Pok√©balle w stole krawieckimi lub specjalnym Cobblemon Crafting Bench.
          Ka≈ºdy kolor Apricornu daje inny typ Pok√©balla z unikalnym efektem po≈Çowu.
        </p>
      </div>
      <div class="apricorn-grid">
        ${renderApricorns()}
      </div>`;
  }
}

const ITEMS_DATA = [
  { icon:'üîó', name:'Link Cable',        desc:'Zastƒôpuje wymianƒô Pok√©mon√≥w. Aktywuj w rƒôce blisko gracza. Crafting: 4√ó Iron Ingot + Copper Ingot + 4√ó String', tag:'Ewolucja' },
  { icon:'üîÜ', name:'Thunder Stone',     desc:'Ewoluuje: Pikachu‚ÜíRaichu, Eevee‚ÜíJolteon, Magneton‚ÜíMagnezone, Nosepass‚ÜíProbopass', tag:'Kamie≈Ñ' },
  { icon:'üî•', name:'Fire Stone',        desc:'Ewoluuje: Vulpix‚ÜíNinetales, Growlithe‚ÜíArcanine, Eevee‚ÜíFlareon, Pansear‚ÜíSimisear', tag:'Kamie≈Ñ' },
  { icon:'üåä', name:'Water Stone',       desc:'Ewoluuje: Poliwhirl‚ÜíPoliwrath, Shellder‚ÜíCloyster, Staryu‚ÜíStarmie, Eevee‚ÜíVaporeon', tag:'Kamie≈Ñ' },
  { icon:'üçÉ', name:'Leaf Stone',        desc:'Ewoluuje: Exeggcute‚ÜíExeggutor, Weepinbell‚ÜíVictreebel, Gloom‚ÜíVileplume, Pansage‚ÜíSimisage', tag:'Kamie≈Ñ' },
  { icon:'üåô', name:'Moon Stone',        desc:'Ewoluuje: Nidorina‚ÜíNidoqueen, Nidorino‚ÜíNidoking, Clefairy‚ÜíClefable, Jigglypuff‚ÜíWigglytuff', tag:'Kamie≈Ñ' },
  { icon:'‚òÄÔ∏è', name:'Sun Stone',         desc:'Ewoluuje: Gloom‚ÜíBellossom, Sunkern‚ÜíSunflora, Cottonee‚ÜíWhimsicott, Petilil‚ÜíLilligant', tag:'Kamie≈Ñ' },
  { icon:'üåë', name:'Dusk Stone',        desc:'Ewoluuje: Murkrow‚ÜíHonchkrow, Misdreavus‚ÜíMismagius, Lampent‚ÜíChandelure, Doublade‚ÜíAegislash', tag:'Kamie≈Ñ' },
  { icon:'‚ú®', name:'Shiny Stone',       desc:'Ewoluuje: Togetic‚ÜíTogekiss, Roselia‚ÜíRoserade, Minccino‚ÜíCinccino, Floette‚ÜíFlorges', tag:'Kamie≈Ñ' },
  { icon:'üßä', name:'Ice Stone',         desc:'Ewoluuje: Alolan Sandshrew‚ÜíSandslash, Alolan Vulpix‚ÜíNinetales, Eevee‚ÜíGlaceon', tag:'Kamie≈Ñ' },
  { icon:'ü™®', name:'Metal Coat',        desc:'Trzymany przez Onix‚ÜíSteelix lub Scyther‚ÜíScizor podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'üêâ', name:'Dragon Scale',      desc:'Trzymany przez Seadra‚ÜíKingdra podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'üëë', name:"King's Rock",       desc:'Trzymany przez Slowpoke‚ÜíSlowking lub Poliwhirl‚ÜíPolitoed podczas wymiany', tag:'Held Item' },
  { icon:'üíæ', name:'Up-Grade',          desc:'Trzymany przez Porygon‚ÜíPorygon2 podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'üíø', name:'Dubious Disc',      desc:'Trzymany przez Porygon2‚ÜíPorygon-Z podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'ü¶∑', name:'Deep Sea Tooth',    desc:'Trzymany przez Clamperl‚ÜíHuntail podczas wymiany. Te≈º zwiƒôksza Sp.Atk Clamperla.', tag:'Held Item' },
  { icon:'ü™©', name:'Deep Sea Scale',    desc:'Trzymany przez Clamperl‚ÜíGorebyss podczas wymiany. Te≈º zwiƒôksza Sp.Def Clamperla.', tag:'Held Item' },
  { icon:'üå∏', name:'Sachet',            desc:'Trzymany przez Spritzee‚ÜíAromatisse podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'üç¨', name:'Whipped Dream',     desc:'Trzymany przez Swirlix‚ÜíSlurpuff podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'‚öñÔ∏è', name:'Prism Scale',       desc:'Trzymany przez Feebas‚ÜíMilotic podczas wymiany przez Link Cable', tag:'Held Item' },
  { icon:'üè•', name:'Potion / Max Potion',desc:'Leczy HP pok√©mona. Crafting z Melon + Sugar lub Glowstone Dust (variuje wg wersji)', tag:'Leczenie' },
  { icon:'üíä', name:'Revive',            desc:'Przywraca omdla≈Çego pok√©mona do 50% HP. Bazowy crafting - do sprawdzenia w wiki', tag:'Leczenie' },
  { icon:'üéÄ', name:'Soothe Bell',       desc:'Przyspieszacze zdobywanie Friendship. Trzymany przez pok√©mona.', tag:'Friendship' },
  { icon:'üçè', name:'Friendship Ribbon', desc:'Pokazuje poziom przyja≈∫ni. U≈ºyj /checkfriendship @s w Cobblemonie.', tag:'Friendship' },
];

function renderItems() {
  return ITEMS_DATA.map(item => `
    <div class="item-card">
      <span class="item-icon">${item.icon}</span>
      <div>
        <div class="item-name">${item.name}</div>
        <div class="item-desc">${item.desc}</div>
        <span class="item-tag">${item.tag}</span>
      </div>
    </div>
  `).join('');
}

const APRICORNS_DATA = [
  { icon:'‚¨õ', color:'Czarny', ball:'Heavy Ball',  effect:'≈Åatwiej ≈Çapaƒá ciƒô≈ºkie Pok√©mony (‚â• 451.5 kg)' },
  { icon:'üîµ', color:'Niebieski', ball:'Lure Ball', effect:'3√ó skuteczno≈õƒá przy ≈Çapaniu w wodzie lub wƒôdkarsko' },
  { icon:'üü¢', color:'Zielony', ball:'Friend Ball', effect:'Z≈Çowiony Pok√©mon startuje z 200 Friendship' },
  { icon:'ü©∑', color:'R√≥≈ºowy', ball:'Love Ball',   effect:'8√ó skuteczno≈õƒá na Pok√©mony tej samej sp., odmiennej p≈Çci' },
  { icon:'üî¥', color:'Czerwony', ball:'Level Ball', effect:'Wy≈ºszy mno≈ºnik gdy Tw√≥j Pok√©mon ma wy≈ºszy level' },
  { icon:'‚¨ú', color:'Bia≈Çy', ball:'Fast Ball',    effect:'4√ó skuteczno≈õƒá na Pok√©mony, kt√≥re uciekajƒÖ' },
  { icon:'üü°', color:'≈ª√≥≈Çty', ball:'Moon Ball',   effect:'4√ó skuteczno≈õƒá na Pok√©mony ewoluujƒÖce Moon Stonem' },
];

function renderApricorns() {
  return APRICORNS_DATA.map(a => `
    <div class="apricorn-card">
      <div class="apricorn-icon">${a.icon}</div>
      <div class="apricorn-name">${a.color} Apricorn</div>
      <div class="apricorn-arrow">‚ñº</div>
      <div class="apricorn-ball">${a.ball}</div>
      <div class="apricorn-effect">${a.effect}</div>
    </div>
  `).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATUS BAR
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setStatus(text, loading) {
  document.getElementById('status-text').textContent = text;
  document.getElementById('spinner').classList.toggle('active', loading);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EVENT LISTENERS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.getElementById('search-input').addEventListener('input', e => {
  searchQuery = e.target.value;
  applyFilters();
});

document.getElementById('gen-filters').addEventListener('click', e => {
  const btn = e.target.closest('.gen-filter-btn');
  if (!btn) return;
  document.querySelectorAll('.gen-filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedGen = parseInt(btn.dataset.gen);
  applyFilters();
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MOVES TABS (global)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchMovesTab(btn, panelId) {
  const section = btn.closest('.moves-section');
  section.querySelectorAll('.moves-tab').forEach(b => b.classList.remove('active'));
  section.querySelectorAll('.moves-panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  const panel = document.getElementById(panelId);
  if (panel) panel.classList.add('active');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   IV BAR UPDATE (global)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function updateIVBar(input) {
  let val = parseInt(input.value);
  if (isNaN(val)) val = 0;
  if (val < 0)  val = 0;
  if (val > 31) val = 31;
  input.value = val;
  const sn = input.dataset.stat;
  const pct = Math.round(val / 31 * 100);
  const bar = document.getElementById('ivbar-' + sn);
  const lbl = document.getElementById('ivlabel-' + sn);
  if (!bar || !lbl) return;
  let color;
  if (val >= 28) color = '#55ff55';
  else if (val >= 20) color = '#f8d030';
  else if (val >= 10) color = '#f08030';
  else color = '#ff5555';
  bar.style.width = pct + '%';
  bar.style.background = color;
  if (val >= 28) lbl.innerHTML = '<span style="color:#55ff55">Doskona≈Çe</span>';
  else if (val >= 20) lbl.innerHTML = '<span style="color:#f8d030">Dobre</span>';
  else if (val >= 10) lbl.innerHTML = '<span style="color:#f08030">S≈Çabe</span>';
  else lbl.innerHTML = '<span style="color:#ff5555">Z≈Çe</span>';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   START
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
init();
</script>
</body>
</html>
