<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cobblemon Mastery Guide</title>
  <meta name="description" content="Najlepsza polska baza buildów competitive Cobblemon. Poradnik IV, EV, Nature, Moveset dla wszystkich Pokémonów w Minecraft." />
  <meta name="keywords" content="Cobblemon, Pokemon, Minecraft, buildy, poradnik, competitive, IV, EV, Nature, moveset, Pokémon" />
  <meta property="og:title" content="Cobblemon Mastery Guide" />
  <meta property="og:description" content="Najlepsza polska baza buildów competitive Cobblemon." />
  <meta property="og:type" content="website" />
  <meta name="robots" content="index, follow" />
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9885277201663964"
     crossorigin="anonymous"></script>
  <style>
    :root {
      --bg:        #1a1a1a;
      --stone:     #2f2f2f;
      --stone2:    #3a3a3a;
      --slot:      #8b8b8b;
      --slot-dark: #555;
      --slot-light:#c6c6c6;
      --green:     #55ff55;
      --gold:      #ffaa00;
      --red:       #ff5555;
      --blue:      #5555ff;
      --aqua:      #55ffff;
      --white:     #f0f0f0;
      --gray:      #aaaaaa;
      --border:    #000;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--white);
      font-family: 'VT323', monospace;
      font-size: 18px;
      min-height: 100vh;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--stone); }
    ::-webkit-scrollbar-thumb { background: var(--slot-dark); border: 1px solid #000; }

    /* ── HEADER ── */
    header {
      background: linear-gradient(180deg, #3d2b1a 0%, #2a1d0e 100%);
      border-bottom: 4px solid #000;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header img.logo { width: 48px; height: 48px; image-rendering: pixelated; }
    .header-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 14px;
      color: var(--green);
      text-shadow: 2px 2px #000, 0 0 12px #00aa00;
      line-height: 1.6;
    }
    .header-subtitle {
      font-family: 'VT323', monospace;
      font-size: 18px;
      color: var(--gold);
    }
    .header-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }
    .mc-badge {
      background: var(--stone2);
      border: 2px solid var(--slot-dark);
      border-right-color: var(--slot-light);
      border-bottom-color: var(--slot-light);
      padding: 4px 10px;
      font-size: 14px;
      color: var(--aqua);
    }

    /* ── MC BUTTON ── */
    .mc-btn {
      font-family: 'VT323', monospace;
      font-size: 20px;
      background: var(--slot);
      color: #fff;
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 4px 14px;
      cursor: pointer;
      text-shadow: 1px 1px #000;
      transition: filter 0.1s;
      user-select: none;
    }
    .mc-btn:hover { filter: brightness(1.15); }
    .mc-btn:active {
      border-top-color: #333;
      border-left-color: #333;
      border-right-color: var(--slot-light);
      border-bottom-color: var(--slot-light);
    }
    .mc-btn.active {
      background: #666;
      border-top-color: #333;
      border-left-color: #333;
      color: var(--green);
    }

    /* ── MC INPUT ── */
    .mc-input {
      font-family: 'VT323', monospace;
      font-size: 22px;
      background: #131313;
      color: var(--white);
      border: 3px solid;
      border-top-color: #333;
      border-left-color: #333;
      border-right-color: var(--slot-light);
      border-bottom-color: var(--slot-light);
      padding: 6px 12px;
      outline: none;
      caret-color: var(--white);
      width: 100%;
    }
    .mc-input:focus { border-color: var(--green); }
    .mc-input::placeholder { color: #666; }

    /* ── LAYOUT ── */
    .app-layout {
      display: flex;
      height: calc(100vh - 80px);
    }
    aside {
      width: 260px;
      min-width: 260px;
      background: var(--stone);
      border-right: 4px solid #000;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .main-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    /* ── SIDEBAR ── */
    .sidebar-search {
      padding: 12px;
      border-bottom: 3px solid #000;
      background: #222;
      position: relative;
      z-index: 10;
    }
    .sidebar-search label {
      display: block;
      color: var(--gray);
      font-size: 14px;
      margin-bottom: 4px;
    }
    .sidebar-close {
      display: none; position: absolute; top: 8px; right: 8px;
      background: none; border: 2px solid #555; color: var(--red);
      font-size: 22px; width: 32px; height: 32px; cursor: pointer;
      font-family: 'VT323', monospace; line-height: 1;
      z-index: 11; text-align: center;
    }
    .sidebar-close:hover { background: #3a1a1a; border-color: var(--red); }
    .tabs { display: flex; gap: 0; border-bottom: 3px solid #000; }
    .tab-btn {
      flex: 1; background: var(--stone2); color: var(--gray); border: none;
      border-right: 2px solid #000; padding: 8px 4px;
      font-family: 'VT323', monospace; font-size: 16px; cursor: pointer; text-align: center;
    }
    .tab-btn:last-child { border-right: none; }
    .tab-btn.active { background: #555; color: var(--green); }
    .tab-btn:hover:not(.active) { background: #444; color: var(--white); }
    .gen-filters {
      padding: 10px 12px; background: #252525; border-bottom: 3px solid #000;
      display: flex; flex-wrap: wrap; gap: 5px;
    }
    .gen-filter-btn {
      font-family: 'VT323', monospace; font-size: 16px;
      background: var(--stone2); color: var(--gray); border: 2px solid #000;
      padding: 2px 8px; cursor: pointer;
    }
    .gen-filter-btn.active { background: #2a5a2a; color: var(--green); border-color: #44aa44; }
    .gen-filter-btn:hover:not(.active) { background: #444; color: var(--white); }

    .pokemon-list { overflow-y: auto; flex: 1; }
    .pokemon-entry {
      display: flex; align-items: center; gap: 10px; padding: 6px 12px;
      border-bottom: 1px solid #2a2a2a; cursor: pointer;
      transition: background 0.1s; user-select: none;
    }
    .pokemon-entry:hover { background: #3a3a3a; }
    .pokemon-entry.selected { background: #2a4a2a; border-left: 3px solid var(--green); }
    .pokemon-entry img { width: 36px; height: 36px; image-rendering: pixelated; }
    .pokemon-entry .entry-name { font-size: 20px; color: var(--white); text-transform: capitalize; }
    .pokemon-entry .entry-id { margin-left: auto; font-size: 14px; color: var(--gray); }
    .entry-badges { display: flex; gap: 4px; }
    .badge-friendship { font-size: 12px; background: #664400; color: var(--gold); padding: 1px 5px; border: 1px solid #aa6600; }
    .badge-trade      { font-size: 12px; background: #004488; color: var(--aqua); padding: 1px 5px; border: 1px solid #0066cc; }

    /* ── MAIN CONTENT ── */
    .page-title {
      font-family: 'Press Start 2P', monospace; font-size: 11px;
      color: var(--green); text-shadow: 1px 1px #000; margin-bottom: 16px;
      display: flex; align-items: center; gap: 10px;
    }
    .page-title::after {
      content: ''; flex: 1; height: 2px;
      background: linear-gradient(to right, #33aa33 0%, transparent 100%);
    }

    /* ── POKEMON DETAIL ── */
    .detail-grid { display: grid; grid-template-columns: 280px 1fr; gap: 16px; }
    .mc-panel {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light);
      border-left-color: var(--slot-light);
      border-right-color: #333;
      border-bottom-color: #333;
      padding: 14px;
    }
    .mc-panel h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--gold); margin-bottom: 10px; padding-bottom: 6px;
      border-bottom: 2px solid #000;
    }
    .pokemon-portrait { text-align: center; padding: 16px; }
    .pokemon-portrait img {
      width: 128px; height: 128px; image-rendering: pixelated;
      filter: drop-shadow(0 0 8px rgba(85,255,85,0.3));
    }
    .pokemon-name-big {
      font-family: 'Press Start 2P', monospace; font-size: 13px;
      color: var(--white); text-transform: capitalize; margin-top: 8px;
    }
    .pokemon-number { color: var(--gray); font-size: 20px; }
    .types { display: flex; gap: 6px; justify-content: center; margin-top: 8px; flex-wrap: wrap; }
    .type-badge {
      font-family: 'VT323', monospace; font-size: 16px;
      padding: 2px 12px; border: 2px solid #000;
      text-transform: uppercase; letter-spacing: 1px;
    }
    .type-normal   { background:#a8a878; color:#fff; }
    .type-fire     { background:#f08030; color:#fff; }
    .type-water    { background:#6890f0; color:#fff; }
    .type-electric { background:#f8d030; color:#000; }
    .type-grass    { background:#78c850; color:#fff; }
    .type-ice      { background:#98d8d8; color:#000; }
    .type-fighting { background:#c03028; color:#fff; }
    .type-poison   { background:#a040a0; color:#fff; }
    .type-ground   { background:#e0c068; color:#000; }
    .type-flying   { background:#a890f0; color:#fff; }
    .type-psychic  { background:#f85888; color:#fff; }
    .type-bug      { background:#a8b820; color:#fff; }
    .type-rock     { background:#b8a038; color:#fff; }
    .type-ghost    { background:#705898; color:#fff; }
    .type-dragon   { background:#7038f8; color:#fff; }
    .type-dark     { background:#705848; color:#fff; }
    .type-steel    { background:#b8b8d0; color:#000; }
    .type-fairy    { background:#ee99ac; color:#000; }

    .stat-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .stat-name { width: 90px; font-size: 16px; color: var(--gray); }
    .stat-val  { width: 36px; text-align: right; font-size: 18px; color: var(--white); }
    .stat-bar-bg { flex: 1; height: 10px; background: #1a1a1a; border: 1px solid #000; }
    .stat-bar { height: 100%; }

    /* ── IV SECTION ── */
    .iv-section {
      background: #0d1a2a; border: 3px solid #1a4a6a; padding: 14px; margin-top: 12px;
    }
    .iv-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--aqua); margin-bottom: 10px; padding-bottom: 6px;
      border-bottom: 2px solid #1a4a6a; display: flex; align-items: center; gap: 8px;
    }
    .iv-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .iv-name { width: 72px; font-size: 16px; color: var(--gray); }
    .iv-input {
      width: 48px; font-family: 'VT323', monospace; font-size: 20px;
      background: #000; color: var(--white); border: 2px solid #1a4a6a;
      text-align: center; padding: 1px 4px; outline: none;
    }
    .iv-input:focus { border-color: var(--aqua); }
    .iv-bar-wrap { flex: 1; height: 12px; background: #0a0a0a; border: 1px solid #111; position: relative; }
    .iv-bar { height: 100%; transition: width 0.2s, background 0.2s; }
    .iv-label { width: 72px; font-size: 15px; text-align: right; }
    .iv-priority { width: 20px; text-align: center; font-size: 18px; cursor: help; }
    .iv-legend {
      display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px;
      padding-top: 8px; border-top: 1px solid #1a4a6a; font-size: 15px;
    }
    .iv-legend-item { display: flex; align-items: center; gap: 5px; }
    .iv-legend-dot { width: 12px; height: 12px; border: 1px solid #000; }
    .iv-role-badge {
      display: inline-block; background: #0a2a0a; color: var(--green);
      border: 1px solid #2a6a2a; padding: 2px 10px; font-size: 16px; margin-bottom: 6px;
    }
    .iv-summary {
      background: #000; border: 2px solid #1a4a6a; padding: 8px 12px;
      margin-bottom: 10px; font-size: 17px; line-height: 1.8;
    }
    .iv-target { width: 64px; font-size: 15px; text-align: center; font-weight: bold; }
    .iv-row-priority { background: #05151f; }

    /* ── MOVES SECTION ── */
    .moves-section {
      background: #1a1a2a; border: 3px solid #3a3a7a; padding: 14px; margin-top: 12px;
    }
    .moves-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--aqua); margin-bottom: 10px; padding-bottom: 6px;
      border-bottom: 2px solid #3a3a7a; display: flex; align-items: center; gap: 8px;
    }
    .moves-tabs { display: flex; gap: 0; margin-bottom: 10px; border-bottom: 2px solid #2a2a4a; }
    .moves-tab {
      font-family: 'VT323', monospace; font-size: 18px;
      background: #111; color: #888; border: none; padding: 4px 16px;
      cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px;
    }
    .moves-tab.active { color: var(--aqua); border-bottom-color: var(--aqua); background: #0a0a1a; }
    .moves-tab:hover:not(.active) { color: #ccc; background: #1a1a2a; }
    .moves-panel { display: none; }
    .moves-panel.active { display: block; }
    .move-table { width: 100%; border-collapse: collapse; font-size: 17px; max-width: 100%; }
    .move-table th {
      text-align: left; color: #666; font-size: 14px; padding: 3px 8px;
      border-bottom: 1px solid #2a2a4a; font-family: 'VT323', monospace; font-weight: normal;
    }
    .move-table td { padding: 3px 8px; border-bottom: 1px solid #111; }
    .move-table tr:hover td { background: #0a0a2a; }
    .move-cat-physical { color: #f08030; }
    .move-cat-special  { color: #6890f0; }
    .move-cat-status   { color: #aaaaaa; }
    .move-name { color: var(--white); text-transform: capitalize; }
    .move-lv {
      background: #002a00; color: var(--green); border: 1px solid #004400;
      padding: 0 6px; font-size: 15px; display: inline-block; min-width: 36px; text-align: center;
    }
    .move-tm {
      background: #00002a; color: var(--aqua); border: 1px solid #000066;
      padding: 0 6px; font-size: 15px; display: inline-block; min-width: 36px; text-align: center;
    }

    /* ── COMPETITIVE BUILD SECTION ── */
    .comp-section {
      background: #12101e; border: 3px solid #5a3a9a; padding: 14px; margin-top: 12px;
    }
    .comp-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: #c084fc; margin-bottom: 12px; padding-bottom: 6px;
      border-bottom: 2px solid #5a3a9a;
    }
    .comp-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .comp-box { background: #0a0818; border: 2px solid #3a2a6a; padding: 10px; }
    .comp-box-title {
      font-family: 'Press Start 2P', monospace; font-size: 8px;
      color: #c084fc; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;
    }
    .ev-row { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
    .ev-amount { font-family: 'Press Start 2P', monospace; font-size: 9px; min-width: 36px; color: #f0f0f0; }
    .ev-bar-bg { flex: 1; height: 8px; background: #111; border: 1px solid #222; }
    .ev-bar { height: 100%; }
    .ev-stat-name { width: 56px; font-size: 15px; text-align: right; }
    .nature-badge {
      display: block; font-family: 'Press Start 2P', monospace;
      font-size: 11px; color: #f0f0f0; margin-bottom: 6px;
    }
    .nature-detail { font-size: 16px; line-height: 1.7; }
    .nature-up   { color: #55ff55; }
    .nature-down { color: #ff5555; }
    .item-big-name {
      font-family: 'Press Start 2P', monospace; font-size: 9px;
      color: var(--gold); margin-bottom: 6px;
    }
    .item-big-desc { font-size: 16px; color: #aaa; line-height: 1.5; }
    .best4-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .move-card {
      background: #0a0818; border: 2px solid #3a2a6a; padding: 8px 10px; position: relative;
    }
    .move-card-num { position: absolute; top: 6px; right: 8px; font-size: 13px; color: #554488; }
    .move-card-name {
      font-family: 'Press Start 2P', monospace; font-size: 8px;
      color: #f0f0f0; margin-bottom: 5px; text-transform: capitalize;
    }
    .move-card-meta { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
    .move-power { background: #1a1a0a; color: var(--gold); border: 1px solid #3a3a0a; padding: 1px 6px; font-size: 15px; }
    .move-cat-p { background:#2a1200; color:#f08030; border:1px solid #5a2a00; padding:1px 6px; font-size:14px; }
    .move-cat-s { background:#00001a; color:#6890f0; border:1px solid #00004a; padding:1px 6px; font-size:14px; }
    .move-cat-z { background:#1a1a1a; color:#aaa; border:1px solid #333; padding:1px 6px; font-size:14px; }
    .move-stab  { background:#0a2a0a; color:#55ff55; border:1px solid #2a5a2a; padding:1px 6px; font-size:14px; }
    .move-coverage { background:#1a0a2a; color:#c084fc; border:1px solid #5a2a8a; padding:1px 6px; font-size:14px; }
    .move-stars { font-size:15px; color: var(--gold); margin-top:3px; }
    .ev-total { font-size:15px; color:#666; margin-top:6px; }

    /* ── COBBLEMON SECTION ── */
    .cobblemon-section {
      background: #1a2a1a; border: 3px solid #2a5a2a; padding: 14px; margin-top: 16px;
    }
    .cobblemon-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--green); margin-bottom: 10px; padding-bottom: 6px;
      border-bottom: 2px solid #2a5a2a; display: flex; align-items: center; gap: 8px;
    }
    .cob-icon { font-size: 20px; }
    .info-row {
      display: flex; gap: 8px; align-items: flex-start; margin-bottom: 8px;
      padding: 8px; background: #0f1f0f; border: 1px solid #2a5a2a;
    }
    .info-row .info-icon { font-size: 22px; min-width: 28px; }
    .info-row .info-text { font-size: 18px; color: var(--white); line-height: 1.4; }
    .info-row .info-text em { color: var(--gold); font-style: normal; }
    .info-row .info-text code {
      background: #000; color: var(--aqua); padding: 1px 6px;
      font-family: 'VT323', monospace; font-size: 18px; border: 1px solid #333;
    }
    .cmd-block {
      background: #000; border: 2px solid #333; padding: 8px 12px; margin-top: 8px;
      color: var(--aqua); font-size: 20px;
    }
    .cmd-block::before { content: '> '; color: var(--green); }

    /* ── EVOLUTIONS ── */
    .evo-chain { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; padding: 8px 0; }
    .evo-item {
      display: flex; flex-direction: column; align-items: center; cursor: pointer;
      padding: 6px; border: 2px solid #444; background: #222;
      transition: border-color 0.1s; min-width: 70px;
    }
    .evo-item:hover { border-color: var(--green); }
    .evo-item img { width: 56px; height: 56px; image-rendering: pixelated; }
    .evo-item span { font-size: 14px; color: var(--white); text-transform: capitalize; text-align: center; }
    .evo-arrow { font-size: 24px; color: var(--gold); }
    .evo-trigger { font-size: 13px; color: var(--gray); text-align: center; max-width: 70px; }

    /* ── ITEMS PAGE ── */
    .items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
    .item-card {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light); border-left-color: var(--slot-light);
      border-right-color: #333; border-bottom-color: #333;
      padding: 12px; display: flex; gap: 12px; align-items: flex-start;
    }
    .item-icon { font-size: 32px; min-width: 40px; text-align: center; }
    .item-name {
      font-family: 'Press Start 2P', monospace; font-size: 8px;
      color: var(--gold); margin-bottom: 6px; display: flex; align-items: center; gap: 6px;
    }
    .item-desc { font-size: 16px; color: var(--gray); line-height: 1.4; }
    .item-tag {
      display: inline-block; background: #2a4a0a; color: var(--green);
      border: 1px solid #4a8a1a; font-size: 12px; padding: 1px 6px; margin-top: 4px;
    }
    .item-icon-img {
      width: 32px; height: 32px; image-rendering: pixelated; vertical-align: middle;
    }

    /* ── APRICORNS PAGE ── */
    .apricorn-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-top: 16px; }
    .apricorn-card {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light); border-left-color: var(--slot-light);
      border-right-color: #333; border-bottom-color: #333;
      padding: 12px; text-align: center;
    }
    .apricorn-icon { font-size: 40px; margin-bottom: 6px; }
    .apricorn-name {
      font-family: 'Press Start 2P', monospace; font-size: 8px;
      color: var(--white); margin-bottom: 8px;
    }
    .apricorn-arrow { color: var(--gold); font-size: 22px; margin: 4px 0; }
    .apricorn-ball {
      font-size: 22px; color: var(--aqua);
      border: 2px solid #2a4a6a; background: #0a1a2a;
      padding: 4px 10px; display: inline-flex; align-items: center; gap: 6px;
    }
    .apricorn-effect { font-size: 14px; color: var(--gray); margin-top: 6px; }

    /* ── WELCOME PAGE ── */
    .welcome-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-top: 16px; }
    .welcome-card {
      background: var(--stone2);
      border: 3px solid;
      border-top-color: var(--slot-light); border-left-color: var(--slot-light);
      border-right-color: #333; border-bottom-color: #333;
      padding: 16px;
    }
    .welcome-card h3 {
      font-family: 'Press Start 2P', monospace; font-size: 9px;
      color: var(--green); margin-bottom: 10px; padding-bottom: 6px;
      border-bottom: 2px solid #000;
    }
    .welcome-card p, .welcome-card li { font-size: 18px; color: var(--gray); line-height: 1.6; }
    .welcome-card ul { padding-left: 20px; }
    .welcome-card li { color: var(--white); }
    .welcome-card li::marker { color: var(--green); }

    /* ── STATUS / SPINNER ── */
    #status-bar {
      padding: 8px 16px; background: #111; border-top: 2px solid #000;
      font-size: 16px; color: var(--gray); display: flex; align-items: center; gap: 8px;
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 200; height: 36px;
    }
    .spinner { width: 14px; height: 14px; border: 3px solid #333; border-top-color: var(--green);
      border-radius: 50%; animation: spin 0.7s linear infinite; display: none; }
    .spinner.active { display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state { text-align: center; padding: 60px 20px; color: var(--gray); font-size: 22px; }
    .empty-state .big-icon { font-size: 64px; display: block; margin-bottom: 12px; }
    .section-sep { border: none; border-top: 3px solid #333; margin: 16px 0; }
    .info-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .info-entry { margin-bottom: 6px; display: flex; gap: 8px; }
    .info-label { color: var(--gray); font-size: 16px; min-width: 120px; }
    .info-value { color: var(--white); font-size: 18px; text-transform: capitalize; }
    #pokemon-count {
      font-size: 14px; color: var(--gray); padding: 4px 12px;
      border-bottom: 2px solid #1a1a1a; background: #222;
    }

    /* ── HAMBURGER ── */
    .hamburger-btn {
      display: none; background: none; border: none;
      color: var(--white); font-size: 28px; cursor: pointer;
      padding: 4px 8px; font-family: 'VT323', monospace;
    }
    .sidebar-overlay {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,0.6); z-index: 999;
    }
    .sidebar-overlay.active { display: block; }

    /* ── AD CONTAINER ── */
    .ad-container {
      background: var(--stone2); border: 2px dashed #555;
      padding: 12px; text-align: center; color: var(--gray); font-size: 14px;
      min-height: 60px; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .ad-label {
      background: #444; color: #888; padding: 2px 8px; font-size: 11px;
      border: 1px solid #555; font-family: 'Press Start 2P', monospace;
    }

    /* ── DONATE SECTION (top bar) ── */
    .donate-section {
      background: #1a1a1a; padding: 14px 24px; text-align: center;
      display: flex; align-items: center; justify-content: center; gap: 16px;
      flex-wrap: wrap; min-height: 60px;
    }
    .donate-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--green); margin: 0;
    }
    .donate-section p { color: var(--gray); font-size: 16px; margin: 0; line-height: 1.4; }
    .donate-btn {
      font-family: 'Press Start 2P', monospace; font-size: 11px;
      background: linear-gradient(180deg, #4a2, #283); color: #fff;
      border: 3px solid; border-top-color: #6c4; border-left-color: #6c4;
      border-right-color: #142; border-bottom-color: #142;
      padding: 8px 20px; cursor: pointer; text-shadow: 1px 1px #000; transition: filter 0.15s;
    }
    .donate-btn:hover { filter: brightness(1.2); }

    /* ── BUILD TABS ── */
    .build-tabs { display: flex; gap: 0; margin-bottom: 12px; border-bottom: 2px solid #3a2a6a; }
    .build-tab {
      font-family: 'VT323', monospace; font-size: 18px;
      background: #0a0818; color: #888; border: none; padding: 6px 16px;
      cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.15s;
    }
    .build-tab.active { color: #c084fc; border-bottom-color: #c084fc; background: #12101e; }
    .build-tab:hover:not(.active) { color: #ccc; background: #15132a; }
    .build-panel { display: none; }
    .build-panel.active { display: block; }

    /* ── FAVORITE STAR ── */
    .fav-star {
      background: none; border: none; font-size: 24px; cursor: pointer;
      padding: 2px 6px; filter: grayscale(1) opacity(0.5); transition: all 0.15s;
    }
    .fav-star:hover { filter: grayscale(0) opacity(0.8); }
    .fav-star.active { filter: grayscale(0) opacity(1); }
    .fav-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 10px; }
    .fav-card {
      background: var(--stone2);
      border: 3px solid; border-top-color: var(--slot-light); border-left-color: var(--slot-light);
      border-right-color: #333; border-bottom-color: #333;
      padding: 10px; text-align: center; cursor: pointer; transition: border-color 0.15s;
    }
    .fav-card:hover { border-color: var(--green); }
    .fav-card img { width: 56px; height: 56px; image-rendering: pixelated; }
    .fav-card span { display: block; font-size: 16px; color: var(--white); text-transform: capitalize; margin-top: 4px; }

    /* ── CALCULATOR ── */
    .calc-section {
      background: #1a1a0a; border: 3px solid #5a5a1a; padding: 14px; margin-top: 16px;
    }
    .calc-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--gold); margin-bottom: 12px; padding-bottom: 6px; border-bottom: 2px solid #5a5a1a;
    }
    .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .calc-box { background: #111; border: 2px solid #333; padding: 10px; }
    .calc-box label {
      display: block; font-size: 14px; color: var(--gray); margin-bottom: 4px;
      font-family: 'VT323', monospace;
    }
    .calc-select, .calc-field {
      font-family: 'VT323', monospace; font-size: 18px;
      background: #000; color: var(--white); border: 2px solid #333;
      padding: 4px 8px; width: 100%; outline: none;
    }
    .calc-select:focus, .calc-field:focus { border-color: var(--gold); }
    .calc-verdict {
      background: #000; border: 3px solid #333; padding: 16px; text-align: center;
      font-size: 22px; line-height: 1.8; margin-top: 10px;
    }
    .calc-verdict .verdict-emoji { font-size: 36px; display: block; margin-bottom: 8px; }

    /* ── COPY LINK BTN ── */
    .copy-link-btn {
      font-family: 'VT323', monospace; font-size: 16px;
      background: #1a1a2a; color: var(--aqua); border: 2px solid #3a3a7a;
      padding: 4px 12px; cursor: pointer; transition: all 0.15s;
    }
    .copy-link-btn:hover { background: #2a2a4a; }

    /* ── MOVE TYPE ICON ── */
    .move-type-icon {
      width: 20px; height: 20px; vertical-align: middle; margin-right: 2px;
      image-rendering: pixelated; border-radius: 50%;
    }

    /* ── LANGUAGE TOGGLE ── */
    .lang-toggle {
      display: flex; gap: 0; border: 2px solid var(--slot-dark); margin-left: 8px;
    }
    .lang-btn {
      font-family: 'VT323', monospace; font-size: 16px;
      background: var(--stone2); color: var(--gray); border: none;
      padding: 4px 10px; cursor: pointer; transition: all 0.15s;
    }
    .lang-btn.active { background: #2a5a2a; color: var(--green); }
    .lang-btn:hover:not(.active) { background: #444; color: var(--white); }

    /* ── TEAM ANALYZER ── */
    .team-section {
      background: #1a0a2a; border: 3px solid #5a2a8a; padding: 14px; margin-top: 16px;
    }
    .team-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: #c084fc; margin-bottom: 12px; padding-bottom: 6px;
      border-bottom: 2px solid #5a2a8a;
    }
    .team-slots {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 16px;
    }
    .team-slot {
      background: #0a0818; border: 2px dashed #3a2a6a; padding: 12px;
      text-align: center; min-height: 130px; position: relative;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: border-color 0.2s;
    }
    .team-slot.filled { border-style: solid; border-color: #5a3a9a; }
    .team-slot:hover { border-color: #c084fc; }
    .team-slot img { width: 64px; height: 64px; image-rendering: pixelated; }
    .team-slot .slot-name {
      font-size: 16px; color: var(--white); text-transform: capitalize; margin-top: 4px;
    }
    .team-slot .slot-types { display: flex; gap: 4px; justify-content: center; margin-top: 4px; flex-wrap: wrap; }
    .team-slot .slot-remove {
      position: absolute; top: 4px; right: 6px; background: none; border: none;
      color: var(--red); font-size: 18px; cursor: pointer; font-family: 'VT323', monospace;
      opacity: 0.6; transition: opacity 0.15s;
    }
    .team-slot .slot-remove:hover { opacity: 1; }
    .team-slot .slot-num {
      position: absolute; top: 4px; left: 6px; font-size: 14px; color: #554488;
    }
    .team-search-wrap { position: relative; margin-bottom: 16px; max-width: 400px; }
    .team-search-results {
      position: absolute; top: 100%; left: 0; right: 0; background: #1a1a2a;
      border: 2px solid #3a3a7a; max-height: 220px; overflow-y: auto; z-index: 50;
      display: none;
    }
    .team-search-results.open { display: block; }
    .team-search-item {
      display: flex; align-items: center; gap: 8px; padding: 6px 10px;
      cursor: pointer; border-bottom: 1px solid #2a2a4a; font-size: 18px;
      color: var(--white); text-transform: capitalize;
    }
    .team-search-item:hover { background: #2a2a4a; }
    .team-search-item img { width: 32px; height: 32px; image-rendering: pixelated; }
    .defense-summary {
      background: #0a0818; border: 2px solid #3a2a6a; padding: 14px; margin-top: 12px;
    }
    .defense-summary h3 {
      font-family: 'Press Start 2P', monospace; font-size: 9px;
      color: #c084fc; margin-bottom: 10px;
    }
    .defense-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 6px;
    }
    .defense-entry {
      display: flex; align-items: center; gap: 4px; padding: 3px 6px;
      font-size: 15px; border: 1px solid #222;
    }
    .defense-weak { background: #2a0a0a; border-color: #5a2020; color: var(--red); }
    .defense-resist { background: #0a2a0a; border-color: #205a20; color: var(--green); }
    .defense-immune { background: #1a1a2a; border-color: #3a3a5a; color: var(--aqua); }
    .defense-neutral { background: #1a1a1a; border-color: #333; color: var(--gray); }

    /* ── BIOME SECTION ── */
    .biome-section {
      background: #0a1a0a; border: 3px solid #1a5a1a; padding: 14px; margin-top: 12px;
    }
    .biome-section h2 {
      font-family: 'Press Start 2P', monospace; font-size: 10px;
      color: var(--green); margin-bottom: 10px; padding-bottom: 6px;
      border-bottom: 2px solid #1a5a1a;
    }
    .biome-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .biome-tag {
      background: #0f2f0f; color: var(--green); border: 1px solid #2a5a2a;
      padding: 3px 10px; font-size: 15px; display: inline-flex; align-items: center; gap: 4px;
    }
    .time-tag {
      background: #1a1a0a; color: var(--gold); border: 1px solid #3a3a0a;
      padding: 3px 10px; font-size: 15px; display: inline-flex; align-items: center; gap: 4px;
    }

    /* ── APRICORN FRUIT ICON ── */
    .apricorn-fruit {
      width: 40px; height: 40px; border-radius: 50%; margin: 0 auto 6px;
      border: 3px solid rgba(0,0,0,0.4); image-rendering: pixelated;
      box-shadow: inset 0 -4px 6px rgba(0,0,0,0.3), 0 2px 4px rgba(0,0,0,0.5);
    }

    /* ── ITEM CARD IMG-ONLY ── */
    .item-icon-only {
      width: 32px; height: 32px; image-rendering: pixelated;
      display: flex; align-items: center; justify-content: center;
      min-width: 40px;
    }
    .item-icon-only img {
      width: 32px; height: 32px; image-rendering: pixelated;
    }

    /* ── TYPE CHART TABLE ── */
    .type-chart-wrap {
      overflow-x: auto; margin-top: 12px;
    }
    .type-chart-info {
      background: #1a1a2a; border: 2px solid #3a3a5a; padding: 12px 16px;
      margin-bottom: 16px; font-size: 16px; color: var(--gray); line-height: 1.6;
    }
    .type-chart-info strong { color: var(--white); }
    .type-chart-info .tc-x4 { color: #ff4444; font-weight: bold; }
    .type-chart-info .tc-x2 { color: #ff8855; }
    .type-chart-info .tc-half { color: #66bb66; }
    .type-chart-info .tc-zero { color: #5588cc; }
    .type-chart {
      border-collapse: collapse; font-size: 13px;
      font-family: 'VT323', monospace;
    }
    .type-chart th, .type-chart td {
      width: 38px; height: 32px; text-align: center; vertical-align: middle;
      border: 1px solid #2a2a2a; padding: 0;
    }
    .type-chart th {
      background: #222; color: var(--gray); font-size: 11px;
      font-weight: normal; position: sticky; top: 0; z-index: 2;
    }
    .type-chart th.tc-corner { background: #111; }
    .type-chart th.tc-row-header {
      background: #222; text-align: right; padding-right: 6px;
      position: sticky; left: 0; z-index: 3; min-width: 70px;
    }
    .type-chart td.tc-x2   { background: #3a1a0a; color: #ff8855; font-weight: bold; }
    .type-chart td.tc-half  { background: #0a2a0a; color: #55aa55; }
    .type-chart td.tc-zero  { background: #0a0a1a; color: #4466aa; font-weight: bold; }
    .type-chart td.tc-norm  { background: #1a1a1a; color: #555; }
    .type-chart tr:hover td { filter: brightness(1.3); }
    .type-chart td.tc-highlight { outline: 2px solid var(--gold); outline-offset: -2px; }
    .type-chart .tc-col-header {
      writing-mode: vertical-lr; text-orientation: mixed;
      background: #222; color: var(--gray); font-size: 11px;
      min-height: 60px; padding: 4px 2px;
    }
    .type-chart .tc-type-icon {
      width: 16px; height: 16px; border-radius: 50%; vertical-align: middle;
      image-rendering: pixelated; margin-right: 2px;
    }

    /* ── RESPONSIVE ── */
    @media (max-width: 768px) {
      .type-chart th, .type-chart td { width: 30px; height: 28px; font-size: 11px; }
      .type-chart th.tc-row-header { min-width: 55px; font-size: 10px; }
      .hamburger-btn { display: block; }
      .sidebar-close { display: block; }
      header { flex-wrap: wrap; padding: 10px 12px; gap: 8px; }
      .header-title { font-size: 11px; }
      .header-subtitle { font-size: 14px; }
      .header-right { display: none; width: 100%; flex-direction: column; gap: 6px; }
      .header-right.mobile-open { display: flex; }
      .app-layout { flex-direction: column; height: auto; min-height: calc(100vh - 80px); }
      aside {
        position: fixed; left: -280px; top: 0; bottom: 0;
        width: 280px; min-width: 280px; z-index: 1000; transition: left 0.25s ease;
      }
      aside.mobile-open { left: 0; }
      .main-area { padding: 12px; padding-bottom: 50px; }
      .detail-grid { grid-template-columns: 1fr; }
      .comp-grid { grid-template-columns: 1fr; }
      .best4-grid { grid-template-columns: 1fr; }
      .info-cols { grid-template-columns: 1fr; }
      .calc-grid { grid-template-columns: 1fr; }
      .welcome-grid { grid-template-columns: 1fr; }
      .move-table { display: block; max-width: 100%; overflow-x: auto; }
      .items-grid { grid-template-columns: 1fr; }
      .apricorn-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
      .mc-badge { font-size: 12px; padding: 2px 6px; }
      .build-tabs { flex-wrap: wrap; }
      .build-tab { font-size: 15px; padding: 4px 10px; }
      .ad-container { min-height: 50px; font-size: 12px; }
      .team-slots { grid-template-columns: repeat(2, 1fr); }
      .defense-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }
    }
  </style>
</head>
<body>

<header>
  <button class="hamburger-btn" onclick="toggleHamburger()" title="Menu">&#9776;</button>
  <div>
    <a href="index.html" onclick="showPage('welcome');return false;" class="header-title" style="text-decoration:none;color:inherit;cursor:pointer">&#9876; Cobblemon Mastery Guide</a>
    <div class="header-subtitle">Serwerowa Baza Cobblemon &middot; Minecraft Mod</div>
  </div>
  <div class="header-right" id="header-right">
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="pl" onclick="setLang('pl')">PL</button>
      <button class="lang-btn" data-lang="en" onclick="setLang('en')">EN</button>
    </div>
    <span class="mc-badge" id="badge-gen">&#127807; Generacje 1&ndash;9</span>
    <span class="mc-badge">&#9874; PokeAPI</span>
    <button class="mc-btn" onclick="showPage('team-analyzer')" id="btn-team">&#9876; Zespół PvP</button>
    <button class="mc-btn" onclick="showPage('type-chart')" id="btn-typechart">&#9878; Tabela Typów</button>
    <button class="mc-btn" onclick="showPage('items')" id="btn-items">&#128230; Przedmioty</button>
    <button class="mc-btn" onclick="showPage('apricorns')" id="btn-apricorns">&#127822; Apricorny</button>
    <button class="mc-btn" onclick="showPage('welcome')" id="btn-start">&#127968; Start</button>
  </div>
</header>

<!-- SUPPORT BANNER (top bar) -->
<div id="ad-top" class="donate-section">
  <h2>💚 <span id="donate-title">Wesprzyj rozwój projektu</span></h2>
  <p id="donate-desc">Cobblemon Mastery Guide to darmowy projekt. Jeśli pomaga Ci w grze, rozważ wsparcie!</p>
  <button class="donate-btn" id="donate-btn" onclick="window.open('https://buycoffee.to/','_blank')">☕ <span id="donate-btn-text">Postaw kawkę</span></button>
</div>

<!-- SIDEBAR OVERLAY (mobile) -->
<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleHamburger()"></div>

<div class="app-layout">
  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="sidebar-search">
      <button class="sidebar-close" onclick="toggleHamburger()" title="Zamknij">&times;</button>
      <label>&#128269; SZUKAJ POK&Eacute;MONA</label>
      <input class="mc-input" id="search-input" type="text" placeholder="np. Pikachu..." autocomplete="off" />
    </div>
    <div class="gen-filters" id="gen-filters">
      <button class="gen-filter-btn active" data-gen="0">Wszystkie</button>
      <button class="gen-filter-btn" data-gen="1">Gen I</button>
      <button class="gen-filter-btn" data-gen="2">Gen II</button>
      <button class="gen-filter-btn" data-gen="3">Gen III</button>
      <button class="gen-filter-btn" data-gen="4">Gen IV</button>
      <button class="gen-filter-btn" data-gen="5">Gen V</button>
      <button class="gen-filter-btn" data-gen="6">Gen VI</button>
      <button class="gen-filter-btn" data-gen="7">Gen VII</button>
      <button class="gen-filter-btn" data-gen="8">Gen VIII</button>
      <button class="gen-filter-btn" data-gen="9">Gen IX</button>
    </div>
    <div id="pokemon-count">Ladowanie...</div>
    <div class="pokemon-list" id="pokemon-list"></div>
  </aside>

  <!-- MAIN -->
  <main class="main-area" id="main-area"></main>
</div>

<div id="status-bar">
  <div class="spinner" id="spinner"></div>
  <span id="status-text">Ladowanie listy Pok&eacute;mon&oacute;w...</span>
</div>

<script>
/* ================================================================
   DATA
   ================================================================ */
const FRIENDSHIP_EVOS = new Set([
  'pichu','cleffa','igglybuff','togepi','chansey','golbat',
  'eevee','azurill','budew','buneary','riolu','happiny',
  'munchlax','chingling','woobat','swadloon'
]);
const FRIENDSHIP_DETAIL = {
  'pichu':'Pichu \u2192 Pikachu (wysoka przyja\u017a\u0144)',
  'cleffa':'Cleffa \u2192 Clefairy (wysoka przyja\u017a\u0144)',
  'igglybuff':'Igglybuff \u2192 Jigglypuff (wysoka przyja\u017a\u0144)',
  'togepi':'Togepi \u2192 Togetic (wysoka przyja\u017a\u0144)',
  'chansey':'Chansey \u2192 Blissey (wysoka przyja\u017a\u0144)',
  'golbat':'Golbat \u2192 Crobat (wysoka przyja\u017a\u0144)',
  'eevee':'Eevee \u2192 Espeon (dzie\u0144 + przyja\u017a\u0144) / Umbreon (noc + przyja\u017a\u0144)',
  'azurill':'Azurill \u2192 Marill (wysoka przyja\u017a\u0144)',
  'budew':'Budew \u2192 Roselia (wysoka przyja\u017a\u0144, dzie\u0144)',
  'buneary':'Buneary \u2192 Lopunny (wysoka przyja\u017a\u0144)',
  'riolu':'Riolu \u2192 Lucario (wysoka przyja\u017a\u0144, dzie\u0144)',
  'happiny':'Happiny \u2192 Chansey (niesiony Okr\u0105g\u0142y Kamie\u0144 + przyja\u017a\u0144)',
  'munchlax':'Munchlax \u2192 Snorlax (wysoka przyja\u017a\u0144)',
  'chingling':'Chingling \u2192 Chimecho (wysoka przyja\u017a\u0144, noc)',
  'woobat':'Woobat \u2192 Swoobat (wysoka przyja\u017a\u0144)',
  'swadloon':'Swadloon \u2192 Leavanny (wysoka przyja\u017a\u0144)',
};
const LINK_CABLE_EVOS = {
  'kadabra':   { result:'Alakazam', item:null },
  'machoke':   { result:'Machamp', item:null },
  'graveler':  { result:'Golem', item:null },
  'haunter':   { result:'Gengar', item:null },
  'onix':      { result:'Steelix', item:'Metal Coat' },
  'scyther':   { result:'Scizor', item:'Metal Coat' },
  'seadra':    { result:'Kingdra', item:'Dragon Scale' },
  'slowpoke':  { result:'Slowking', item:"King's Rock" },
  'poliwhirl': { result:'Politoed', item:"King's Rock" },
  'porygon':   { result:'Porygon2', item:'Up-Grade' },
  'porygon2':  { result:'Porygon-Z', item:'Dubious Disc' },
  'clamperl':  { result:'Huntail / Gorebyss', item:'Deep Sea Tooth / Deep Sea Scale' },
  'boldore':   { result:'Gigalith', item:null },
  'gurdurr':   { result:'Conkeldurr', item:null },
  'karrablast':{ result:'Escavalier', item:'wymiana z Shelmet' },
  'shelmet':   { result:'Accelgor', item:'wymiana z Karrablast' },
  'phantump':  { result:'Trevenant', item:null },
  'pumpkaboo': { result:'Gourgeist', item:null },
  'spritzee':  { result:'Aromatisse', item:'Sachet' },
  'swirlix':   { result:'Slurpuff', item:'Whipped Dream' },
  'feebas':    { result:'Milotic', item:'Prism Scale' },
};
const GEN_RANGES = [
  null,[1,151],[152,251],[252,386],[387,493],[494,649],[650,721],[722,809],[810,905],[906,1025],
];
const STAT_COLORS = {
  hp:'#ff5555', attack:'#f08030', defense:'#f8d030',
  'special-attack':'#6890f0','special-defense':'#78c850', speed:'#f85888',
};
const STAT_NAMES = {
  hp:'HP', attack:'ATK', defense:'DEF',
  'special-attack':'SpATK','special-defense':'SpDEF', speed:'SPE'
};
const TYPE_NAMES_PL = {
  normal:'Normalny',fire:'Ogie\u0144',water:'Woda',electric:'Elektryczny',grass:'Trawa',
  ice:'L\u00f3d',fighting:'Walka',poison:'Truc.',ground:'Ziemia',flying:'Lataj\u0105cy',
  psychic:'Psycho',bug:'Robak',rock:'Ska\u0142a',ghost:'Duch',dragon:'Smok',
  dark:'Mrok',steel:'Stal',fairy:'Bajkowy'
};

/* ================================================================
   LANGUAGE / TRANSLATIONS
   ================================================================ */
let currentLang = localStorage.getItem('cob_lang') || 'pl';
const TR = {
  'nav.items':       {pl:'Przedmioty',en:'Items'},
  'nav.apricorns':   {pl:'Apricorny',en:'Apricorns'},
  'nav.start':       {pl:'Start',en:'Home'},
  'nav.team':        {pl:'Zesp\u00f3\u0142 PvP',en:'PvP Team'},
  'nav.search':      {pl:'SZUKAJ POK\u00c9MONA',en:'SEARCH POK\u00c9MON'},
  'nav.subtitle':    {pl:'Serwerowa Baza Cobblemon \u00b7 Minecraft Mod',en:'Cobblemon Server Database \u00b7 Minecraft Mod'},
  'nav.genBadge':    {pl:'Generacje 1\u20139',en:'Generations 1\u20139'},
  'stat.hp':{pl:'P\u017b',en:'HP'},'stat.atk':{pl:'ATAK',en:'ATK'},'stat.def':{pl:'OBR',en:'DEF'},
  'stat.spatk':{pl:'Sp.ATAK',en:'SpATK'},'stat.spdef':{pl:'Sp.OBR',en:'SpDEF'},'stat.spe':{pl:'SZYB',en:'SPE'},
  'sec.baseStats':   {pl:'Statystyki bazowe',en:'Base Stats'},
  'sec.iv':          {pl:'Individual Values (IV)',en:'Individual Values (IV)'},
  'sec.evo':         {pl:'\u0141a\u0144cuch ewolucji',en:'Evolution Chain'},
  'sec.moves':       {pl:'Pe\u0142na lista atak\u00f3w',en:'Full Move List'},
  'sec.comp':        {pl:'Competitive Build',en:'Competitive Build'},
  'sec.cobblemon':   {pl:'Polecane dla Cobblemon',en:'Cobblemon Recommendations'},
  'sec.biomes':      {pl:'Habitat / Biomy',en:'Habitat / Biomes'},
  'sec.calc':        {pl:'Oce\u0144 mojego Pok\u00e9mona',en:'Rate My Pok\u00e9mon'},
  'sec.items':       {pl:'Kluczowe Przedmioty Cobblemon',en:'Key Cobblemon Items'},
  'sec.apricorns':   {pl:'Apricorny i Pok\u00e9balle',en:'Apricorns & Pok\u00e9balls'},
  'sec.team':        {pl:'Analizator Zespo\u0142u PvP',en:'PvP Team Analyzer'},
  'sec.favorites':   {pl:'Twoje Ulubione Buildy',en:'Your Favorite Builds'},
  'sec.basicData':   {pl:'Dane podstawowe',en:'Basic Data'},
  'team.search':     {pl:'Wyszukaj Pok\u00e9mona...',en:'Search Pok\u00e9mon...'},
  'team.clear':      {pl:'Wyczy\u015b\u0107 Zesp\u00f3\u0142',en:'Clear Team'},
  'team.empty':      {pl:'Kliknij aby doda\u0107',en:'Click to add'},
  'team.weak':       {pl:'S\u0142abo\u015bci zespo\u0142u',en:'Team Weaknesses'},
  'team.resist':     {pl:'Odporno\u015bci zespo\u0142u',en:'Team Resistances'},
  'team.neutral':    {pl:'Neutralne',en:'Neutral'},
  'team.immune':     {pl:'Immunitety',en:'Immunities'},
  'team.desc':       {pl:'Dodaj do 6 Pok\u00e9mon\u00f3w i sprawd\u017a pokrycie typ\u00f3w.', en:'Add up to 6 Pok\u00e9mon and check your type coverage.'},
  'det.height':      {pl:'Wzrost',en:'Height'},
  'det.weight':      {pl:'Waga',en:'Weight'},
  'det.types':       {pl:'Typy',en:'Types'},
  'det.abilities':   {pl:'Zdolno\u015bci',en:'Abilities'},
  'det.habitat':     {pl:'Habitat',en:'Habitat'},
  'det.catch':       {pl:'Wsp. \u0142apania',en:'Catch Rate'},
  'det.baseExp':     {pl:'Bazowe Do\u015bw.',en:'Base Exp.'},
  'biome.spawn':     {pl:'Pora spawnu',en:'Spawn Time'},
  'biome.day':       {pl:'Dzie\u0144',en:'Day'},
  'biome.night':     {pl:'Noc',en:'Night'},
  'biome.any':       {pl:'Dowolna',en:'Any'},
  'biome.biomes':    {pl:'Biomy Minecraft',en:'Minecraft Biomes'},
  'mv.level':        {pl:'Przez poziom',en:'Level Up'},
  'mv.tm':           {pl:'TM/TR',en:'TM/TR'},
  'mv.egg':          {pl:'Egg Moves',en:'Egg Moves'},
  'mv.power':        {pl:'MOC',en:'PWR'},
  'mv.lvl':          {pl:'Poz.',en:'Lv.'},
  'mv.attack':       {pl:'Atak',en:'Attack'},
  'mv.type':         {pl:'Typ',en:'Type'},
  'build.phys':      {pl:'Fizyczny Atakuj\u0105cy',en:'Physical Attacker'},
  'build.spec':      {pl:'Specjalny Atakuj\u0105cy',en:'Special Attacker'},
  'build.def':       {pl:'Defensywny',en:'Defensive'},
  'build.ev':        {pl:'Rozk\u0142ad EV',en:'EV Spread'},
  'build.nature':    {pl:'Natura',en:'Nature'},
  'build.item':      {pl:'Przedmiot',en:'Item'},
  'build.best4':     {pl:'Najlepsze 4 Ataki',en:'Best 4 Moves'},
  'build.copyLink':  {pl:'Kopiuj Link do Buildu',en:'Copy Build Link'},
  'gen.loading':     {pl:'\u0141adowanie...',en:'Loading...'},
  'gen.noResults':   {pl:'Brak wynik\u00f3w',en:'No results'},
  'gen.all':         {pl:'Wszystkie',en:'All'},
  'gen.evaluate':    {pl:'Oce\u0144!',en:'Rate!'},
  'gen.sum':         {pl:'Suma',en:'Total'},
  'gen.donate':      {pl:'Wesprzyj rozw\u00f3j projektu',en:'Support the Project'},
  'gen.coffee':      {pl:'Postaw kawk\u0119',en:'Buy a Coffee'},
  'gen.donateDesc':  {pl:'Cobblemon Mastery Guide to darmowy projekt. Je\u015bli pomaga Ci w grze, rozwa\u017c wsparcie!',en:'Cobblemon Mastery Guide is a free project. If it helps you, consider supporting us!'},
  'gen.ad':          {pl:'Miejsce na Twoj\u0105 reklam\u0119 \u2014 skontaktuj si\u0119 z nami!',en:'Your ad here \u2014 contact us!'},
  'gen.adLabel':     {pl:'REKLAMA',en:'AD'},
  'gen.pokemon':     {pl:'Pok\u00e9mon\u00f3w',en:'Pok\u00e9mon'},
  'apricorn.how':    {pl:'JAK ZBIERA\u0106 APRICORNY?',en:'HOW TO COLLECT APRICORNS?'},
  'apricorn.howDesc':{pl:'Drzewa Apricorn\u00f3w rosn\u0105 naturalnie w r\u00f3\u017cnych biomach. Zbieraj owoce i craftuj Pok\u00e9balle w Cobblemon Crafting Bench.',en:'Apricorn trees grow naturally in various biomes. Collect fruits and craft Pok\u00e9balls at the Cobblemon Crafting Bench.'},
  'welcome.what':    {pl:'Czym jest Cobblemon?',en:'What is Cobblemon?'},
  'welcome.whatDesc':{pl:'Cobblemon to mod do Minecrafta integruj\u0105cy creatury inspirowane Pok\u00e9monami. \u0141ap, trenuj i ewoluuj swoje stworzenia w \u015bwiecie Minecrafta!',en:'Cobblemon is a Minecraft mod featuring Pok\u00e9mon-inspired creatures. Catch, train and evolve your creatures in the Minecraft world!'},
  'welcome.howUse':  {pl:'Jak u\u017cywa\u0107 bazy?',en:'How to use the database?'},
  'welcome.friend':  {pl:'Przyja\u017a\u0144 (/checkfriendship)',en:'Friendship (/checkfriendship)'},
  'welcome.link':    {pl:'Link Cable (Wymiana)',en:'Link Cable (Trade)'},
  'nav.typechart':   {pl:'Tabela Typ\u00f3w',en:'Type Chart'},
  'sec.typechart':   {pl:'Interaktywna Tabela Typ\u00f3w',en:'Interactive Type Chart'},
  'tc.atkLabel':     {pl:'ATAKUJ\u0104CY \u2193',en:'ATTACKER \u2193'},
  'tc.defLabel':     {pl:'BRONI\u0104CY \u2192',en:'DEFENDER \u2192'},
  'tc.info':         {pl:'<strong>Jak czyta\u0107 tabel\u0119:</strong> Wiersze to typ <em>atakuj\u0105cy</em>, kolumny to typ <em>broni\u0105cy</em>.<br><span class="tc-x2">\u00d72</span> = super skuteczne \u2022 <span class="tc-half">\u00d70.5</span> = ma\u0142o skuteczne \u2022 <span class="tc-zero">\u00d70</span> = brak efektu \u2022 1 = neutralne.',en:'<strong>How to read:</strong> Rows = <em>attacking</em> type, columns = <em>defending</em> type.<br><span class="tc-x2">\u00d72</span> = super effective \u2022 <span class="tc-half">\u00d70.5</span> = not very effective \u2022 <span class="tc-zero">\u00d70</span> = no effect \u2022 1 = neutral.'},
  'tc.dual':         {pl:'<strong>\ud83d\udca1 Podw\u00f3jne typy:</strong> Je\u015bli Pok\u00e9mon ma dwa typy, mno\u017cniki si\u0119 \u0142\u0105cz\u0105. Np. atak <span class="tc-x2">Wodny</span> na Pok\u00e9mona Ogniowy/Skalny zada <span class="tc-x4">\u00d74</span> obra\u017ce\u0144!',en:'<strong>\ud83d\udca1 Dual types:</strong> If a Pok\u00e9mon has two types, multipliers stack. E.g. a <span class="tc-x2">Water</span> attack on a Fire/Rock Pok\u00e9mon deals <span class="tc-x4">\u00d74</span> damage!'},
};
function t(key){var e=TR[key];if(!e)return key;return e[currentLang]||e['pl']||key;}

const TYPE_NAMES_EN = {
  normal:'Normal',fire:'Fire',water:'Water',electric:'Electric',grass:'Grass',
  ice:'Ice',fighting:'Fighting',poison:'Poison',ground:'Ground',flying:'Flying',
  psychic:'Psychic',bug:'Bug',rock:'Rock',ghost:'Ghost',dragon:'Dragon',
  dark:'Dark',steel:'Steel',fairy:'Fairy'
};
function typeName(n){return currentLang==='en'?(TYPE_NAMES_EN[n]||n):(TYPE_NAMES_PL[n]||n);}

/* ================================================================
   TYPE EFFECTIVENESS (DEFENSIVE)
   ================================================================ */
const TYPE_EFF = {
  normal:  {weak:['fighting'],resist:[],immune:['ghost']},
  fire:    {weak:['water','ground','rock'],resist:['fire','grass','ice','bug','steel','fairy'],immune:[]},
  water:   {weak:['electric','grass'],resist:['fire','water','ice','steel'],immune:[]},
  electric:{weak:['ground'],resist:['electric','flying','steel'],immune:[]},
  grass:   {weak:['fire','ice','poison','flying','bug'],resist:['water','electric','grass','ground'],immune:[]},
  ice:     {weak:['fire','fighting','rock','steel'],resist:['ice'],immune:[]},
  fighting:{weak:['flying','psychic','fairy'],resist:['bug','rock','dark'],immune:[]},
  poison:  {weak:['ground','psychic'],resist:['fighting','poison','bug','grass','fairy'],immune:[]},
  ground:  {weak:['water','grass','ice'],resist:['poison','rock'],immune:['electric']},
  flying:  {weak:['electric','ice','rock'],resist:['fighting','bug','grass'],immune:['ground']},
  psychic: {weak:['bug','ghost','dark'],resist:['fighting','psychic'],immune:[]},
  bug:     {weak:['fire','flying','rock'],resist:['fighting','ground','grass'],immune:[]},
  rock:    {weak:['water','grass','fighting','ground','steel'],resist:['normal','fire','poison','flying'],immune:[]},
  ghost:   {weak:['ghost','dark'],resist:['poison','bug'],immune:['normal','fighting']},
  dragon:  {weak:['ice','dragon','fairy'],resist:['fire','water','electric','grass'],immune:[]},
  dark:    {weak:['fighting','bug','fairy'],resist:['ghost','dark'],immune:['psychic']},
  steel:   {weak:['fire','fighting','ground'],resist:['normal','grass','ice','flying','psychic','bug','rock','dragon','steel','fairy'],immune:['poison']},
  fairy:   {weak:['poison','steel'],resist:['fighting','bug','dark'],immune:['dragon']}
};
const ALL_TYPES = Object.keys(TYPE_EFF);

/* ================================================================
   BIOME MAPPING
   ================================================================ */
const HABITAT_BIOMES = {
  cave:            {biomes:['Lush Caves','Dripstone Caves','Deep Dark'],icon:'\u26f0'},
  forest:          {biomes:['Forest','Birch Forest','Dark Forest','Flower Forest'],icon:'\ud83c\udf32'},
  grassland:       {biomes:['Plains','Sunflower Plains','Meadow'],icon:'\ud83c\udf3f'},
  mountain:        {biomes:['Stony Peaks','Jagged Peaks','Windswept Hills'],icon:'\ud83c\udfd4'},
  rare:            {biomes:['Deep Dark','End Highlands','Mushroom Fields'],icon:'\u2728'},
  'rough-terrain': {biomes:['Badlands','Savanna','Windswept Forest','Stony Shore'],icon:'\ud83c\udfdc'},
  sea:             {biomes:['Ocean','Deep Ocean','Warm Ocean','Lukewarm Ocean'],icon:'\ud83c\udf0a'},
  urban:           {biomes:['Plains (Villages)','Savanna (Villages)'],icon:'\ud83c\udfe0'},
  'waters-edge':   {biomes:['River','Beach','Swamp','Mangrove Swamp'],icon:'\ud83c\udfd6'}
};
function getSpawnTime(types){
  var tn=types.map(function(t){return t.type.name;});
  if(tn.includes('ghost')||tn.includes('dark'))return 'night';
  if(tn.includes('fairy')||tn.includes('psychic'))return 'day';
  if(tn.includes('bug'))return 'day';
  return 'any';
}
function buildBiomeSection(habitat,types){
  var hab=habitat?habitat.name:null;
  var biomeData=hab&&HABITAT_BIOMES[hab]?HABITAT_BIOMES[hab]:{biomes:['Plains','Forest','Meadow'],icon:'\ud83c\udf0d'};
  var spawnTime=getSpawnTime(types);
  var timeLabels={day:'\u2600 '+t('biome.day'),night:'\ud83c\udf19 '+t('biome.night'),any:'\u2600\ud83c\udf19 '+t('biome.any')};
  var biomeTags=biomeData.biomes.map(function(b){return '<span class="biome-tag">'+biomeData.icon+' '+b+'</span>';}).join('');
  var timeTag='<span class="time-tag">'+(timeLabels[spawnTime]||timeLabels['any'])+'</span>';
  return '<div class="biome-section"><h2>\ud83c\udf0d '+t('sec.biomes')+'</h2>'
    +'<div style="margin-bottom:8px;font-size:16px;color:#888">'+t('biome.biomes')+':</div>'
    +'<div class="biome-tags">'+biomeTags+'</div>'
    +'<div style="margin-top:10px;font-size:16px;color:#888">'+t('biome.spawn')+':</div>'
    +'<div class="biome-tags" style="margin-top:4px">'+timeTag+'</div></div>';
}

/* ================================================================
   TEAM ANALYZER
   ================================================================ */
const TEAM_KEY='cob_team';
let teamSlots=[];
function loadTeam(){try{var s=localStorage.getItem(TEAM_KEY);teamSlots=s?JSON.parse(s):[];}catch(e){teamSlots=[];}}
function saveTeam(){localStorage.setItem(TEAM_KEY,JSON.stringify(teamSlots));}
function clearTeam(){teamSlots=[];localStorage.removeItem(TEAM_KEY);renderTeamPage();}
function removeFromTeam(id){teamSlots=teamSlots.filter(function(s){return s.id!==id;});saveTeam();renderTeamPage();}
function computeTeamDefense(){
  var result={};
  ALL_TYPES.forEach(function(at){result[at]={weak:0,resist:0,immune:0,neutral:0};});
  teamSlots.forEach(function(slot){
    ALL_TYPES.forEach(function(at){
      var mult=1;
      slot.types.forEach(function(dt){
        if(!TYPE_EFF[dt])return;
        if(TYPE_EFF[dt].weak.includes(at))mult*=2;
        else if(TYPE_EFF[dt].resist.includes(at))mult*=0.5;
        else if(TYPE_EFF[dt].immune.includes(at))mult*=0;
      });
      if(mult===0)result[at].immune++;else if(mult>1)result[at].weak++;else if(mult<1)result[at].resist++;else result[at].neutral++;
    });
  });
  return result;
}
let teamSearchTimeout=null;
function onTeamSearch(input){
  clearTimeout(teamSearchTimeout);
  var q=input.value.trim().toLowerCase();
  var results=document.getElementById('team-search-results');
  if(q.length<2){results.classList.remove('open');return;}
  teamSearchTimeout=setTimeout(function(){
    var matches=allPokemon.filter(function(p){return p.name.includes(q)||String(p.id).includes(q);}).slice(0,8);
    if(!matches.length){results.innerHTML='<div class="team-search-item" style="color:#666">'+t('gen.noResults')+'</div>';results.classList.add('open');return;}
    results.innerHTML=matches.map(function(p){
      return '<div class="team-search-item" onclick="addTeamPokemon('+p.id+',\''+p.name+'\')">'
        +'<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+p.id+'.png"/>'
        +'<span>'+p.name+'</span><span style="color:#666;margin-left:auto">#'+String(p.id).padStart(3,'0')+'</span></div>';
    }).join('');
    results.classList.add('open');
  },200);
}
async function addTeamPokemon(id,name){
  if(teamSlots.length>=6||teamSlots.some(function(s){return s.id===id;}))return;
  var results=document.getElementById('team-search-results');
  results.classList.remove('open');
  document.getElementById('team-search-input').value='';
  try{
    var data=detailCache[id];
    if(!data){var res=await fetch('https://pokeapi.co/api/v2/pokemon/'+id);var p=await res.json();data={p:p};detailCache[id]=data;}
    var types=data.p.types.map(function(t){return t.type.name;});
    teamSlots.push({id:id,name:name,types:types});
    saveTeam();renderTeamPage();
  }catch(e){teamSlots.push({id:id,name:name,types:['normal']});saveTeam();renderTeamPage();}
}
function renderTeamPage(){
  var container=document.getElementById('team-analyzer-content');
  if(!container)return;
  var slotsHTML='';
  for(var i=0;i<6;i++){
    if(i<teamSlots.length){
      var slot=teamSlots[i];
      var typeBadges=slot.types.map(function(tp){return '<span class="type-badge type-'+tp+'" style="font-size:11px;padding:1px 6px">'+typeName(tp)+'</span>';}).join('');
      slotsHTML+='<div class="team-slot filled"><span class="slot-num">'+(i+1)+'</span>'
        +'<button class="slot-remove" onclick="removeFromTeam('+slot.id+')" title="Usu\u0144">\u2715</button>'
        +'<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+slot.id+'.png"/>'
        +'<div class="slot-name">'+slot.name+'</div>'
        +'<div class="slot-types">'+typeBadges+'</div></div>';
    }else{
      slotsHTML+='<div class="team-slot"><span class="slot-num">'+(i+1)+'</span>'
        +'<div style="color:#555;font-size:32px">+</div>'
        +'<div style="color:#555;font-size:14px">'+t('team.empty')+'</div></div>';
    }
  }
  var defenseHTML='';
  if(teamSlots.length>0){
    var analysis=computeTeamDefense();
    var weakTypes=ALL_TYPES.filter(function(tp){return analysis[tp].weak>analysis[tp].resist+analysis[tp].immune;});
    var resistTypes=ALL_TYPES.filter(function(tp){return analysis[tp].resist+analysis[tp].immune>analysis[tp].weak;});
    var immuneTypes=ALL_TYPES.filter(function(tp){return analysis[tp].immune>0;});
    var neutralTypes=ALL_TYPES.filter(function(tp){return !weakTypes.includes(tp)&&!resistTypes.includes(tp);});
    defenseHTML='<div class="defense-summary"><h3>\ud83d\udd34 '+t('team.weak')+' ('+weakTypes.length+')</h3>'
      +'<div class="defense-grid">'+weakTypes.map(function(tp){return '<div class="defense-entry defense-weak">'+typeIconHTML(tp,18)+' '+typeName(tp)+' <span style="margin-left:auto;font-size:13px">'+analysis[tp].weak+'\u00d7</span></div>';}).join('')+'</div></div>'
      +'<div class="defense-summary" style="margin-top:8px"><h3>\ud83d\udfe2 '+t('team.resist')+' ('+resistTypes.length+')</h3>'
      +'<div class="defense-grid">'+resistTypes.map(function(tp){return '<div class="defense-entry defense-resist">'+typeIconHTML(tp,18)+' '+typeName(tp)+' <span style="margin-left:auto;font-size:13px">'+analysis[tp].resist+'\u00d7</span></div>';}).join('')+'</div></div>';
    if(immuneTypes.length)defenseHTML+='<div class="defense-summary" style="margin-top:8px"><h3>\ud83d\udfe3 '+t('team.immune')+' ('+immuneTypes.length+')</h3>'
      +'<div class="defense-grid">'+immuneTypes.map(function(tp){return '<div class="defense-entry defense-immune">'+typeIconHTML(tp,18)+' '+typeName(tp)+'</div>';}).join('')+'</div></div>';
    defenseHTML+='<div class="defense-summary" style="margin-top:8px"><h3>\u26aa '+t('team.neutral')+' ('+neutralTypes.length+')</h3>'
      +'<div class="defense-grid">'+neutralTypes.map(function(tp){return '<div class="defense-entry defense-neutral">'+typeIconHTML(tp,18)+' '+typeName(tp)+'</div>';}).join('')+'</div></div>';
  }
  container.innerHTML='<div style="font-size:16px;color:#888;margin-bottom:12px">'+t('team.desc')+'</div>'
    +'<div class="team-search-wrap">'
    +'<input class="mc-input" id="team-search-input" type="text" placeholder="'+t('team.search')+'" oninput="onTeamSearch(this)" autocomplete="off"/>'
    +'<div class="team-search-results" id="team-search-results"></div></div>'
    +'<div class="team-slots">'+slotsHTML+'</div>'
    +'<div style="display:flex;gap:8px;margin-bottom:16px">'
    +'<button class="mc-btn" onclick="clearTeam()" style="background:#5a2020;border-top-color:#8a4040;border-left-color:#8a4040">\ud83d\uddd1 '+t('team.clear')+'</button></div>'
    +defenseHTML;
}

/* ================================================================
   LANGUAGE SWITCH
   ================================================================ */
function setLang(lang){
  currentLang=lang;
  localStorage.setItem('cob_lang',lang);
  document.querySelectorAll('.lang-btn').forEach(function(b){b.classList.toggle('active',b.dataset.lang===lang);});
  // Update header text
  var sub=document.querySelector('.header-subtitle');if(sub)sub.textContent=t('nav.subtitle');
  var lbl=document.querySelector('.sidebar-search label');if(lbl)lbl.textContent='\ud83d\udd0d '+t('nav.search');
  var inp=document.getElementById('search-input');if(inp)inp.placeholder=currentLang==='en'?'e.g. Pikachu...':'np. Pikachu...';
  var gb=document.getElementById('badge-gen');if(gb)gb.innerHTML='\ud83c\udf3f '+t('nav.genBadge');
  var ab=document.querySelector('.gen-filter-btn[data-gen="0"]');if(ab)ab.textContent=t('gen.all');
  var bi=document.getElementById('btn-items');if(bi)bi.innerHTML='\ud83d\udce6 '+t('nav.items');
  var ba=document.getElementById('btn-apricorns');if(ba)ba.innerHTML='\ud83c\udf4e '+t('nav.apricorns');
  var bs=document.getElementById('btn-start');if(bs)bs.innerHTML='\ud83c\udfe0 '+t('nav.start');
  var bt=document.getElementById('btn-team');if(bt)bt.innerHTML='\u2694 '+t('nav.team');
  var bc=document.getElementById('btn-typechart');if(bc)bc.innerHTML='\u2696 '+t('nav.typechart');
  // Update donate bar
  var dt=document.getElementById('donate-title');if(dt)dt.textContent=t('gen.donate');
  var dd=document.getElementById('donate-desc');if(dd)dd.textContent=t('gen.donateDesc');
  var db=document.getElementById('donate-btn-text');if(db)db.textContent=t('gen.coffee');
  // Re-render current page
  if(currentPage==='welcome')showPage('welcome');
  else if(currentPage==='items')showPage('items');
  else if(currentPage==='apricorns')showPage('apricorns');
  else if(currentPage==='team-analyzer')showPage('team-analyzer');
  else if(currentPage==='type-chart')showPage('type-chart');
  else if(selectedId){var f=allPokemon.find(function(p){return p.id===selectedId;});if(f)loadDetail(f.id,f.name);}
}

const MOVE_DATA = {
  'hyper-voice':[90,'normal','S'],'boomburst':[140,'normal','S'],'body-slam':[85,'normal','P'],
  'double-edge':[120,'normal','P'],'facade':[70,'normal','P'],'return':[102,'normal','P'],
  'quick-attack':[40,'normal','P'],'extreme-speed':[80,'normal','P'],'last-resort':[140,'normal','P'],
  'swift':[60,'normal','S'],'swords-dance':[0,'normal','Z'],'rest':[0,'normal','Z'],
  'protect':[0,'normal','Z'],'substitute':[0,'normal','Z'],'recover':[0,'normal','Z'],
  'wish':[0,'normal','Z'],'belly-drum':[0,'normal','Z'],'work-up':[0,'normal','Z'],
  'slack-off':[0,'normal','Z'],'soft-boiled':[0,'normal','Z'],'milk-drink':[0,'normal','Z'],
  'shell-smash':[0,'normal','Z'],'egg-bomb':[100,'normal','P'],
  'thunderbolt':[90,'electric','S'],'thunder':[110,'electric','S'],'wild-charge':[90,'electric','P'],
  'volt-switch':[70,'electric','S'],'discharge':[80,'electric','S'],'thunder-punch':[75,'electric','P'],
  'spark':[65,'electric','P'],'rising-voltage':[70,'electric','S'],'nuzzle':[20,'electric','P'],
  'flamethrower':[90,'fire','S'],'fire-blast':[110,'fire','S'],'flare-blitz':[120,'fire','P'],
  'fire-punch':[75,'fire','P'],'mystical-fire':[75,'fire','S'],'overheat':[130,'fire','S'],
  'heat-wave':[95,'fire','S'],'will-o-wisp':[0,'fire','Z'],'burning-jealousy':[70,'fire','S'],
  'surf':[90,'water','S'],'hydro-pump':[110,'water','S'],'waterfall':[80,'water','P'],
  'scald':[80,'water','S'],'aqua-jet':[40,'water','P'],'aqua-tail':[90,'water','P'],
  'liquidation':[85,'water','P'],'flip-turn':[60,'water','P'],'rain-dance':[0,'water','Z'],
  'sparkling-aria':[90,'water','S'],'surging-strikes':[25,'water','P'],
  'moonblast':[95,'fairy','S'],'dazzling-gleam':[80,'fairy','S'],'play-rough':[90,'fairy','P'],
  'draining-kiss':[50,'fairy','S'],'disarming-voice':[40,'fairy','S'],'geomancy':[0,'fairy','Z'],
  'fleur-cannon':[130,'fairy','S'],'spirit-break':[75,'fairy','P'],'strange-steam':[90,'fairy','S'],
  'psychic':[90,'psychic','S'],'psyshock':[80,'psychic','S'],'future-sight':[120,'psychic','S'],
  'extrasensory':[80,'psychic','S'],'zen-headbutt':[80,'psychic','P'],'psybeam':[65,'psychic','S'],
  'calm-mind':[0,'psychic','Z'],'trick-room':[0,'psychic','Z'],'agility':[0,'psychic','Z'],
  'reflect':[0,'psychic','Z'],'stored-power':[20,'psychic','S'],'expanding-force':[80,'psychic','S'],
  'prismatic-laser':[160,'psychic','S'],'amnesia':[0,'psychic','Z'],'cosmic-power':[0,'psychic','Z'],
  'close-combat':[120,'fighting','P'],'aura-sphere':[80,'fighting','S'],'drain-punch':[75,'fighting','P'],
  'high-jump-kick':[130,'fighting','P'],'mach-punch':[40,'fighting','P'],'superpower':[120,'fighting','P'],
  'focus-blast':[120,'fighting','S'],'sacred-sword':[90,'fighting','P'],'bulk-up':[0,'fighting','Z'],
  'hammer-arm':[100,'fighting','P'],'thunderous-kick':[90,'fighting','P'],'vacuum-wave':[40,'fighting','S'],
  'earthquake':[100,'ground','P'],'earth-power':[90,'ground','S'],'stomping-tantrum':[75,'ground','P'],
  'dig':[80,'ground','P'],'stealth-rock':[0,'ground','Z'],'spikes':[0,'ground','Z'],
  'scorching-sands':[70,'ground','S'],'shore-up':[0,'ground','Z'],
  'energy-ball':[90,'grass','S'],'leaf-blade':[90,'grass','P'],'giga-drain':[75,'grass','S'],
  'power-whip':[120,'grass','P'],'wood-hammer':[120,'grass','P'],'leaf-storm':[130,'grass','S'],
  'solar-beam':[120,'grass','S'],'seed-bomb':[80,'grass','P'],'leech-seed':[0,'grass','Z'],
  'synthesis':[0,'grass','Z'],'grassy-glide':[70,'grass','P'],'spore':[0,'grass','Z'],
  'petal-dance':[120,'grass','S'],
  'ice-beam':[90,'ice','S'],'blizzard':[110,'ice','S'],'ice-punch':[75,'ice','P'],
  'ice-shard':[40,'ice','P'],'icicle-crash':[85,'ice','P'],'freeze-dry':[70,'ice','S'],
  'glacial-lance':[120,'ice','P'],'aurora-veil':[0,'ice','Z'],'triple-axel':[20,'ice','P'],
  'shadow-ball':[80,'ghost','S'],'phantom-force':[90,'ghost','P'],'poltergeist':[110,'ghost','P'],
  'shadow-claw':[70,'ghost','P'],'shadow-sneak':[40,'ghost','P'],'moongeist-beam':[100,'ghost','S'],
  'hex':[65,'ghost','S'],'astral-barrage':[120,'ghost','S'],'destiny-bond':[0,'ghost','Z'],
  'dark-pulse':[80,'dark','S'],'crunch':[80,'dark','P'],'knock-off':[65,'dark','P'],
  'night-slash':[70,'dark','P'],'sucker-punch':[70,'dark','P'],'throat-chop':[80,'dark','P'],
  'wicked-blow':[80,'dark','P'],'nasty-plot':[0,'dark','Z'],'taunt':[0,'dark','Z'],
  'parting-shot':[0,'dark','Z'],'night-daze':[85,'dark','S'],'darkest-lariat':[85,'dark','P'],
  'fiery-wrath':[90,'dark','S'],'lash-out':[75,'dark','P'],
  'dragon-pulse':[85,'dragon','S'],'outrage':[120,'dragon','P'],'dragon-claw':[80,'dragon','P'],
  'draco-meteor':[130,'dragon','S'],'dragon-dance':[0,'dragon','Z'],'dual-chop':[40,'dragon','P'],
  'dragon-rush':[100,'dragon','P'],'clanging-scales':[110,'dragon','S'],'eternabeam':[160,'dragon','S'],
  'iron-head':[80,'steel','P'],'flash-cannon':[80,'steel','S'],'heavy-slam':[100,'steel','P'],
  'gyro-ball':[100,'steel','P'],'meteor-mash':[90,'steel','P'],'iron-defense':[0,'steel','Z'],
  'bullet-punch':[40,'steel','P'],'sunsteel-strike':[100,'steel','P'],'steel-beam':[140,'steel','S'],
  'stone-edge':[100,'rock','P'],'rock-slide':[75,'rock','P'],'power-gem':[80,'rock','S'],
  'meteor-beam':[120,'rock','S'],'head-smash':[150,'rock','P'],
  'sludge-bomb':[90,'poison','S'],'gunk-shot':[120,'poison','P'],'poison-jab':[80,'poison','P'],
  'sludge-wave':[95,'poison','S'],'toxic':[0,'poison','Z'],'shell-side-arm':[90,'poison','S'],
  'bug-buzz':[90,'bug','S'],'leech-life':[80,'bug','P'],'x-scissor':[80,'bug','P'],
  'u-turn':[70,'bug','P'],'lunge':[80,'bug','P'],'first-impression':[90,'bug','P'],'quiver-dance':[0,'bug','Z'],
  'brave-bird':[120,'flying','P'],'hurricane':[110,'flying','S'],'air-slash':[75,'flying','S'],
  'acrobatics':[55,'flying','P'],'fly':[90,'flying','P'],'aerial-ace':[60,'flying','P'],
  'roost':[0,'flying','Z'],'tailwind':[0,'flying','Z'],'defog':[0,'flying','Z'],'dual-wingbeat':[40,'flying','P'],
};

/* ================================================================
   STATE
   ================================================================ */
let allPokemon = [];
let filteredList = [];
let selectedGen = 0;
let searchQuery = '';
let currentPage = 'welcome';
let selectedId = null;
let detailCache = {};
let listOffset = 0;
const PAGE_SIZE = 80;
const FAVORITES_KEY = 'cob_favorites';
let currentBuildIndex = 0;
let lastBuildData = null;

/* ================================================================
   FAVORITES
   ================================================================ */
function getFavorites() {
  try { return JSON.parse(localStorage.getItem(FAVORITES_KEY)) || []; }
  catch(e) { return []; }
}
function isFavorite(id) { return getFavorites().some(f => f.id === id); }
function toggleFavorite(id, name) {
  let favs = getFavorites();
  const idx = favs.findIndex(f => f.id === id);
  if (idx >= 0) favs.splice(idx, 1);
  else favs.push({ id, name });
  localStorage.setItem(FAVORITES_KEY, JSON.stringify(favs));
  const star = document.getElementById('fav-star-btn');
  if (star) star.classList.toggle('active', isFavorite(id));
}
function renderFavoritesSection() {
  const favs = getFavorites();
  if (!favs.length) {
    return '<div class="welcome-card"><h3>\u2b50 Twoje Ulubione Buildy</h3><p>Kliknij gwiazdk\u0119 \u2b50 obok nazwy Pok\u00e9mona, aby doda\u0107 go do ulubionych.</p></div>';
  }
  const cards = favs.map(f =>
    '<div class="fav-card" onclick="loadDetail('+f.id+',\''+f.name+'\')"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+f.id+'.png" alt="'+f.name+'"/><span>'+f.name+'</span></div>'
  ).join('');
  return '<div class="welcome-card" style="grid-column:1/-1"><h3>\u2b50 Twoje Ulubione Buildy</h3><div class="fav-grid">'+cards+'</div></div>';
}

/* ================================================================
   HAMBURGER
   ================================================================ */
function toggleHamburger() {
  document.getElementById('sidebar').classList.toggle('mobile-open');
  document.getElementById('sidebar-overlay').classList.toggle('active');
}

/* ================================================================
   COPY BUILD LINK
   ================================================================ */
function copyBuildLink() {
  const url = window.location.origin + window.location.pathname + (selectedId ? '#pokemon-'+selectedId : '');
  navigator.clipboard.writeText(url).then(function(){
    var btn = document.getElementById('copy-link-btn');
    if(btn){btn.textContent='\u2705 Skopiowano!';setTimeout(function(){btn.textContent='\ud83d\udd17 Kopiuj Link do Buildu';},2000);}
  }).catch(function(){
    var ta = document.createElement('textarea');ta.value=url;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);
  });
}

/* ================================================================
   INIT
   ================================================================ */
async function init() {
  // Load saved language
  currentLang = localStorage.getItem('cob_lang') || 'pl';
  document.querySelectorAll('.lang-btn').forEach(function(b){b.classList.toggle('active',b.dataset.lang===currentLang);});
  // Load saved team
  loadTeam();

  setStatus((currentLang==='en'?'Fetching Pok\u00e9mon list from PokeAPI...':'Pobieranie listy Pok\u00e9mon\u00f3w z PokeAPI...'), true);
  var cached = localStorage.getItem('cob_pokemon_list');
  if (cached) {
    allPokemon = JSON.parse(cached);
    setStatus((currentLang==='en'?'Loaded ':'Za\u0142adowano ')+allPokemon.length+(currentLang==='en'?' Pok\u00e9mon from cache.':' Pok\u00e9mon\u00f3w z cache.'), false);
  } else {
    try {
      var res = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
      var data = await res.json();
      allPokemon = data.results.map(function(p){
        var parts = p.url.split('/').filter(Boolean);
        var id = parseInt(parts[parts.length - 1]);
        return { id: id, name: p.name };
      }).filter(function(p){ return p.id <= 1025; });
      localStorage.setItem('cob_pokemon_list', JSON.stringify(allPokemon));
      setStatus((currentLang==='en'?'Loaded ':'Za\u0142adowano ')+allPokemon.length+(currentLang==='en'?' Pok\u00e9mon.':' Pok\u00e9mon\u00f3w.'), false);
    } catch (e) {
      setStatus((currentLang==='en'?'Connection error with PokeAPI!':'B\u0142\u0105d po\u0142\u0105czenia z PokeAPI!'), false);
    }
  }
  // Apply saved language to header elements
  if(currentLang==='en')setLang('en');
  applyFilters();
  showPage('welcome');
  // Check hash for deep link
  if (window.location.hash.startsWith('#pokemon-')) {
    var hid = parseInt(window.location.hash.replace('#pokemon-',''));
    if (hid) { var found = allPokemon.find(function(p){return p.id===hid;}); if(found) loadDetail(found.id, found.name); }
  }
}

/* ================================================================
   FILTERS
   ================================================================ */
function applyFilters() {
  var q = searchQuery.trim().toLowerCase();
  filteredList = allPokemon.filter(function(p) {
    if (selectedGen > 0) {
      var range = GEN_RANGES[selectedGen];
      if (p.id < range[0] || p.id > range[1]) return false;
    }
    if (q) return p.name.includes(q) || String(p.id).includes(q);
    return true;
  });
  listOffset = 0;
  renderList();
}

function renderList() {
  var container = document.getElementById('pokemon-list');
  document.getElementById('pokemon-count').textContent = filteredList.length + ' ' + t('gen.pokemon');
  if (!filteredList.length) {
    container.innerHTML = '<div class="empty-state"><span class="big-icon">\ud83d\udd0d</span>'+t('gen.noResults')+'</div>';
    return;
  }
  var chunk = filteredList.slice(0, listOffset + PAGE_SIZE);
  container.innerHTML = '';
  chunk.forEach(function(p) {
    var div = document.createElement('div');
    div.className = 'pokemon-entry' + (p.id === selectedId ? ' selected' : '');
    div.dataset.id = p.id;
    var hasFriendship = FRIENDSHIP_EVOS.has(p.name);
    var hasTrade = p.name in LINK_CABLE_EVOS;
    div.innerHTML = '<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+p.id+'.png" onerror="this.src=\'data:image/svg+xml,<svg xmlns=\\\'http://www.w3.org/2000/svg\\\'/>\'" />'
      + '<span class="entry-name">'+p.name+'</span>'
      + '<span class="entry-id">#'+String(p.id).padStart(3,'0')+'</span>'
      + '<div class="entry-badges">'
      + (hasFriendship ? '<span class="badge-friendship" title="Ewolucja przez przyja\u017a\u0144">\u2665</span>' : '')
      + (hasTrade ? '<span class="badge-trade" title="Ewolucja przez wymian\u0119 (Link Cable)">\u21c4</span>' : '')
      + '</div>';
    div.addEventListener('click', function(){ loadDetail(p.id, p.name); });
    container.appendChild(div);
  });
  if (chunk.length < filteredList.length) {
    var sentinel = document.createElement('div');
    sentinel.style.cssText = 'height:4px';
    sentinel.id = 'list-sentinel';
    container.appendChild(sentinel);
    var obs = new IntersectionObserver(function(entries){
      if (entries[0].isIntersecting) { obs.disconnect(); listOffset += PAGE_SIZE; renderList(); }
    });
    obs.observe(sentinel);
  }
}

/* ================================================================
   DETAIL
   ================================================================ */
async function loadDetail(id, name) {
  selectedId = id;
  document.querySelectorAll('.pokemon-entry').forEach(function(el){
    el.classList.toggle('selected', parseInt(el.dataset.id) === id);
  });
  // close mobile menu
  document.getElementById('sidebar').classList.remove('mobile-open');
  document.getElementById('sidebar-overlay').classList.remove('active');
  showPage('detail-loading');
  setStatus('Pobieranie danych: '+name+'...', true);
  try {
    var data = detailCache[id];
    if (!data) {
      var results = await Promise.all([
        fetch('https://pokeapi.co/api/v2/pokemon/'+id),
        fetch('https://pokeapi.co/api/v2/pokemon-species/'+id)
      ]);
      var p = await results[0].json();
      var s = await results[1].json();
      data = { p:p, s:s };
      detailCache[id] = data;
    }
    var evoChainUrl = data.s.evolution_chain ? data.s.evolution_chain.url : null;
    var evoChain = null;
    if (evoChainUrl) { var evoRes = await fetch(evoChainUrl); evoChain = await evoRes.json(); }
    renderDetail(data.p, data.s, evoChain, name);
    setStatus('#'+String(id).padStart(3,'0')+' '+name, false);
    window.location.hash = 'pokemon-'+id;
  } catch(e) {
    setStatus('B\u0142\u0105d podczas pobierania danych.', false);
    document.getElementById('main-area').innerHTML = '<div class="empty-state"><span class="big-icon">\u26a0</span>B\u0142\u0105d po\u0142\u0105czenia z PokeAPI.</div>';
  }
}

/* ================================================================
   TYPE ICON HELPER
   ================================================================ */
function typeIconHTML(tpName, size) {
  size = size || 20;
  // Use colored circle badges as type icons
  var colors = {
    normal:'#a8a878',fire:'#f08030',water:'#6890f0',electric:'#f8d030',grass:'#78c850',
    ice:'#98d8d8',fighting:'#c03028',poison:'#a040a0',ground:'#e0c068',flying:'#a890f0',
    psychic:'#f85888',bug:'#a8b820',rock:'#b8a038',ghost:'#705898',dragon:'#7038f8',
    dark:'#705848',steel:'#b8b8d0',fairy:'#ee99ac'
  };
  var c = colors[tpName] || '#888';
  var label = typeName(tpName).substring(0,3).toUpperCase();
  return '<span style="display:inline-block;width:'+size+'px;height:'+size+'px;border-radius:50%;background:'+c+';text-align:center;line-height:'+size+'px;font-size:'+(size*0.5)+'px;color:#fff;font-family:VT323,monospace;vertical-align:middle;margin-right:2px;border:1px solid rgba(0,0,0,0.3)" title="'+typeName(tpName)+'">'+label+'</span>';
}

/* ================================================================
   RENDER DETAIL
   ================================================================ */
function renderDetail(p, s, evoChain, name) {
  var isFriendship = FRIENDSHIP_EVOS.has(p.name);
  var isTradeEvo = p.name in LINK_CABLE_EVOS;
  var flavor = '';
  if (s.flavor_text_entries) {
    var fe = s.flavor_text_entries.find(function(f){return f.language.name==='en';});
    if (fe) flavor = fe.flavor_text.replace(/\f/g,' ');
  }

  // ── IV helpers ──
  function getIVColor(iv) { return iv>=28?'#55ff55':iv>=20?'#f8d030':iv>=10?'#f08030':'#ff5555'; }
  function getIVLabel(iv) {
    if(iv>=28) return '<span style="color:#55ff55">Doskona\u0142e</span>';
    if(iv>=20) return '<span style="color:#f8d030">Dobre</span>';
    if(iv>=10) return '<span style="color:#f08030">S\u0142abe</span>';
    return '<span style="color:#ff5555">Z\u0142e</span>';
  }

  function buildIVSection(stats) {
    var statMap = {}; stats.forEach(function(s){statMap[s.stat.name]=s.base_stat;});
    var atk=statMap['attack']||0, spatk=statMap['special-attack']||0, def=statMap['defense']||0, spdef=statMap['special-defense']||0, spe=statMap['speed']||0, hp=statMap['hp']||0;
    var isPhysical=atk>=spatk+15,isSpecial=spatk>=atk+15,isMixed=!isPhysical&&!isSpecial,isTank=(def+spdef)/2>=90&&spe<80,isSpeedy=spe>=80,isTrickRoom=spe<=50;
    var role='\u2696 Zbalansowany';
    if(isPhysical&&isSpeedy)role='\u2694 Fizyczny Atakuj\u0105cy';else if(isPhysical&&isTank)role='\ud83d\udee1 Fizyczny Tank';else if(isPhysical)role='\u2694 Fizyczny';else if(isSpecial&&isSpeedy)role='\u2728 Specjalny Atakuj\u0105cy';else if(isSpecial&&isTank)role='\ud83d\udd2e Specjalny Tank';else if(isSpecial)role='\u2728 Specjalny';else if(isTank)role='\ud83d\udee1 Tank';else if(isSpeedy)role='\ud83d\udca8 Szybko\u015bciowy';else if(isMixed)role='\u2694\u2728 Mieszany';
    var targets={};
    targets['hp']={val:'31',color:'#55ff55',prio:true,note:'Zawsze przydatne'};
    if(isTrickRoom)targets['speed']={val:'0',color:'#aaa',prio:false,note:'Trick Room'};else if(isSpeedy)targets['speed']={val:'31',color:'#55ff55',prio:true,note:'Kluczowe'};else targets['speed']={val:'\u226520',color:'#f8d030',prio:false,note:'Pomocne'};
    if(isPhysical||isMixed)targets['attack']={val:'31',color:'#55ff55',prio:true,note:'G\u0142\u00f3wne \u017ar\u00f3d\u0142o obra\u017ce\u0144'};else targets['attack']={val:'0',color:'#888',prio:false,note:'Nie u\u017cywasz'};
    if(isSpecial||isMixed)targets['special-attack']={val:'31',color:'#55ff55',prio:true,note:'G\u0142\u00f3wne \u017ar\u00f3d\u0142o obra\u017ce\u0144'};else targets['special-attack']={val:'0',color:'#888',prio:false,note:'Nie u\u017cywasz'};
    if(isTank||def>=100)targets['defense']={val:'31',color:'#55ff55',prio:true,note:'Warto maksowa\u0107'};else targets['defense']={val:'\u226520',color:'#f8d030',prio:false,note:'Przydatne'};
    if(isTank||spdef>=100)targets['special-defense']={val:'31',color:'#55ff55',prio:true,note:'Warto maksowa\u0107'};else targets['special-defense']={val:'\u226520',color:'#f8d030',prio:false,note:'Przydatne'};
    var mustBe31=['hp','attack','defense','special-attack','special-defense','speed'].filter(function(sn){return targets[sn].val==='31';}).map(function(sn){return '<span style="color:'+(STAT_COLORS[sn]||'#fff')+'">'+STAT_NAMES[sn]+'</span>';});
    var mustBe0=['attack','special-attack','speed'].filter(function(sn){return targets[sn].val==='0';}).map(function(sn){return '<span style="color:#888">'+STAT_NAMES[sn]+'</span>';});
    var summaryLine='Celuj w <b style="color:#55ff55">31</b>: '+mustBe31.join(', ');
    if(mustBe0.length)summaryLine+='<br>Zostaw na <b style="color:#888">0</b>: '+mustBe0.join(', ');
    var ORDER=['hp','attack','defense','special-attack','special-defense','speed'];
    var rows=ORDER.map(function(sn){
      var label=STAT_NAMES[sn]||sn;var color=STAT_COLORS[sn]||'#888';var t=targets[sn];
      var rowClass=t.prio?'iv-row iv-row-priority':'iv-row';var prioIcon=t.prio?'\u2b50':'\u25aa';
      var defaultVal=t.val==='0'?0:31;
      return '<div class="'+rowClass+'" id="iv-row-'+sn+'">'
        +'<span class="iv-priority" title="'+t.note+'">'+prioIcon+'</span>'
        +'<span class="iv-name" style="color:'+color+'">'+label+'</span>'
        +'<input class="iv-input" type="number" min="0" max="31" value="'+defaultVal+'" data-stat="'+sn+'" oninput="updateIVBar(this)" />'
        +'<div class="iv-bar-wrap"><div class="iv-bar" id="ivbar-'+sn+'" style="width:'+Math.round(defaultVal/31*100)+'%;background:'+getIVColor(defaultVal)+'"></div></div>'
        +'<div class="iv-target" style="color:'+t.color+'" title="'+t.note+'">CEL: '+t.val+'</div>'
        +'<div class="iv-label" id="ivlabel-'+sn+'">'+getIVLabel(defaultVal)+'</div></div>';
    }).join('');
    return '<div class="iv-section"><h2>\ud83c\udfb2 Individual Values (IV) <span style="font-size:11px;color:#aaa;font-family:VT323,monospace">skala 0\u201331</span></h2>'
      +'<div class="iv-role-badge">Rola: '+role+'</div>'
      +'<div class="iv-summary">'+summaryLine+'</div>'
      +'<div style="font-size:14px;color:#666;margin-bottom:6px">\u2b50 priorytet | \u25aa mniej wa\u017cne | Zmie\u0144 liczby \u017ceby sprawdzi\u0107</div>'
      +rows
      +'<div class="iv-legend">'
      +'<div class="iv-legend-item"><div class="iv-legend-dot" style="background:#55ff55"></div>28\u201331 Doskona\u0142e</div>'
      +'<div class="iv-legend-item"><div class="iv-legend-dot" style="background:#f8d030"></div>20\u201327 Dobre</div>'
      +'<div class="iv-legend-item"><div class="iv-legend-dot" style="background:#f08030"></div>10\u201319 S\u0142abe</div>'
      +'<div class="iv-legend-item"><div class="iv-legend-dot" style="background:#ff5555"></div>0\u20139 Z\u0142e</div>'
      +'</div></div>';
  }

  // ── ROLE DETECTION ──
  function detectRole(statMap) {
    var atk=statMap['attack']||0,spatk=statMap['special-attack']||0,def=statMap['defense']||0,spdef=statMap['special-defense']||0,spe=statMap['speed']||0,hp=statMap['hp']||0;
    var isPhys=atk>=spatk+15,isSpec=spatk>=atk+15,isMixed=!isPhys&&!isSpec,isTank=(def+spdef)/2>=90&&spe<80,isFast=spe>=80,isTR=spe<=50;
    var label='\u2696 Zbalansowany';
    if(isPhys&&isFast)label='\u2694 Fizyczny Atakuj\u0105cy';else if(isPhys&&isTank)label='\ud83d\udee1 Fizyczny Tank';else if(isPhys)label='\u2694 Fizyczny (wolny)';else if(isSpec&&isFast)label='\u2728 Specjalny Atakuj\u0105cy';else if(isSpec&&isTank)label='\ud83d\udd2e Specjalny Tank';else if(isSpec)label='\u2728 Specjalny (wolny)';else if(isTank)label='\ud83d\udee1 Tank';else if(isFast)label='\ud83d\udca8 Szybki Mieszany';else label='\u2694\u2728 Mieszany';
    return {atk:atk,spatk:spatk,def:def,spdef:spdef,spe:spe,hp:hp,isPhys:isPhys,isSpec:isSpec,isMixed:isMixed,isTank:isTank,isFast:isFast,isTR:isTR,label:label};
  }

  // ── BUILD GENERATOR ──
  function generateBuild(statMap, pokemonTypes, moves, buildType) {
    var r = detectRole(statMap);
    var spread,note,nName,nUp,nDown,nWhy,item,itemDesc;
    // Three build types: 'physical','special','defensive'
    if (buildType === 'physical') {
      if(r.isFast) spread=[['attack',252],['speed',252],['hp',4]]; else spread=[['attack',252],['hp',252],['defense',4]];
      note=currentLang==='en'?'Max physical damage.':'Maksuj fizyczne obra\u017cenia.';
      if(r.isFast){nName='Jolly';nUp='+Szybk.';nDown='-Sp.Atak';nWhy=currentLang==='en'?'Faster without losing Atk':'Szybszy bez straty Ataku';}
      else{nName='Adamant';nUp='+Atak';nDown='-Sp.Atak';nWhy=currentLang==='en'?'Max Atk':'Maks Atak';}
      if(r.spe>=100){item='Choice Band';itemDesc=currentLang==='en'?'Atk \u00d71.5 \u2014 one move only':'Atak \u00d71.5 \u2014 tylko jeden atak';}
      else{item='Life Orb';itemDesc=currentLang==='en'?'+30% damage, -10% HP per attack':'+30% obra\u017ce\u0144, -10% P\u017b za atak';}
    } else if (buildType === 'special') {
      if(r.isFast) spread=[['special-attack',252],['speed',252],['hp',4]]; else spread=[['special-attack',252],['hp',252],['special-defense',4]];
      note=currentLang==='en'?'Max special damage.':'Maksuj specjalne obra\u017cenia.';
      if(r.isFast){nName='Timid';nUp='+Szybk.';nDown='-Atak';nWhy=currentLang==='en'?'Faster without losing SpAtk':'Szybszy bez straty Sp.Atak';}
      else{nName='Modest';nUp='+Sp.Atak';nDown='-Atak';nWhy=currentLang==='en'?'Max SpAtk':'Maks Sp.Atak';}
      if(r.spe>=100){item='Choice Specs';itemDesc=currentLang==='en'?'SpAtk \u00d71.5 \u2014 one move only':'Sp.Atak \u00d71.5 \u2014 tylko jeden atak';}
      else{item='Life Orb';itemDesc=currentLang==='en'?'+30% damage, -10% HP per attack':'+30% obra\u017ce\u0144, -10% P\u017b za atak';}
    } else {
      // defensive
      var defMore = r.def >= r.spdef;
      if(defMore) spread=[['hp',252],['defense',252],['special-defense',4]]; else spread=[['hp',252],['special-defense',252],['defense',4]];
      note=currentLang==='en'?'Maximum endurance.':'Maksymalna wytrzyma\u0142o\u015b\u0107.';
      if(defMore){nName='Impish';nUp='+'+(currentLang==='en'?'Def':'Obrona');nDown='-Sp.Atak';nWhy=currentLang==='en'?'Physical endurance':'Fizyczna wytrzyma\u0142o\u015b\u0107';}
      else{nName='Calm';nUp='+'+(currentLang==='en'?'SpDef':'Sp.Obr');nDown='-Atak';nWhy=currentLang==='en'?'Special endurance':'Specjalna wytrzyma\u0142o\u015b\u0107';}
      item='Leftovers';itemDesc=currentLang==='en'?'Restores 1/16 HP per turn':'Regeneruje 1/16 P\u017b co tur\u0119';
    }
    var total = spread.reduce(function(s,e){return s+e[1];},0);
    var evRows = spread.map(function(e){
      var sn=e[0],val=e[1],color=STAT_COLORS[sn]||'#888',pct=Math.round(val/252*100);
      return '<div class="ev-row"><span class="ev-amount">'+val+'</span><span class="ev-stat-name" style="color:'+color+'">'+(STAT_NAMES[sn]||sn)+'</span><div class="ev-bar-bg"><div class="ev-bar" style="width:'+pct+'%;background:'+color+'"></div></div></div>';
    }).join('');

    var evHTML='<div class="comp-box"><div class="comp-box-title">\ud83d\udcca '+t('build.ev')+' <span style="font-size:10px;color:#888;font-family:VT323,monospace">(max 510)</span></div>'+evRows+'<div class="ev-total">'+t('gen.sum')+': '+total+'/510</div><div style="font-size:14px;color:#666;margin-top:5px">'+note+'</div></div>';
    var natureHTML='<div class="comp-box"><div class="comp-box-title">\ud83d\udc8e '+t('build.nature')+'</div><div class="nature-badge">'+nName+'</div><div class="nature-detail"><span class="nature-up">\u25b2 '+nUp+'</span> | <span class="nature-down">\u25bc '+nDown+'</span></div><div style="font-size:14px;color:#666;margin-top:6px">'+nWhy+'</div></div>';

    // Item with PokeAPI icon only (no emoji)
    var itemSlug = item.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/-$/,'');
    var itemImgTag = '<img class="item-icon-img" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/'+itemSlug+'.png" onerror="this.parentNode.innerHTML=\'<span style=color:#555;font-size:28px>\u25a1</span>\'" style="width:32px;height:32px" />';
    var itemHTML='<div class="comp-box"><div class="comp-box-title">\ud83d\udce6 '+t('build.item')+'</div><div style="text-align:center;margin:4px 0">'+itemImgTag+'</div><div class="item-big-name">'+item+'</div><div class="item-big-desc">'+itemDesc+'</div></div>';

    // Best 4 Moveset for this build type
    var movesHTML = buildBest4ForType(moves, pokemonTypes, statMap, buildType);

    return '<div class="comp-grid">'+evHTML+natureHTML+itemHTML+'</div>'
      +'<div class="comp-box-title" style="margin-bottom:8px">\u2694 '+t('build.best4')+'</div>'
      +'<div style="font-size:14px;color:#666;margin-bottom:8px">'+(currentLang==='en'?'Automatically selected based on types and stats.':'Automatycznie dobrane na podstawie typ\u00f3w i statystyk.')+'</div>'
      +'<div class="best4-grid">'+movesHTML+'</div>';
  }

  // ── BEST 4 FOR BUILD TYPE ──
  function buildBest4ForType(moves, pokemonTypes, statMap, buildType) {
    var r = detectRole(statMap);
    var typeSet = new Set(pokemonTypes);
    var pool = [];
    moves.forEach(function(m){
      var vgd = m.version_group_details.slice().sort(function(a,b){return b.version_group.url.localeCompare(a.version_group.url,undefined,{numeric:true});})[0];
      if(!vgd) return;
      var method = vgd.move_learn_method.name;
      if(!['level-up','machine','egg'].includes(method)) return;
      var nm = m.move.name, md = MOVE_DATA[nm], lv = vgd.level_learned_at;
      var power = md?md[0]:0, mtype = md?md[1]:'normal', cat = md?md[2]:(power>0?(r.isPhys?'P':'S'):'Z');
      var score = 0;
      if(cat==='Z'){
        var offSetup=['swords-dance','dragon-dance','nasty-plot','quiver-dance','tail-glow','shell-smash','belly-drum','work-up','geomancy','calm-mind','bulk-up','coil'];
        var defSetup=['recover','roost','soft-boiled','slack-off','milk-drink','synthesis','moonlight','morning-sun','wish','rest','shore-up'];
        if(buildType==='defensive'){
          if(defSetup.includes(nm))score=90;else if(['stealth-rock','toxic','will-o-wisp','thunder-wave','spikes'].includes(nm))score=70;else if(offSetup.includes(nm))score=30;else score=20;
        } else {
          if(offSetup.includes(nm))score=80;else if(defSetup.includes(nm))score=15;else score=10;
        }
      } else {
        score = power;
        if(buildType==='physical'&&cat==='P')score*=1.5;else if(buildType==='special'&&cat==='S')score*=1.5;else if(buildType==='defensive')score*=0.8;
        if(buildType==='physical'&&cat==='S')score*=0.3;
        if(buildType==='special'&&cat==='P')score*=0.3;
        if(typeSet.has(mtype))score*=1.5;
        var prioMoves=['extreme-speed','quick-attack','aqua-jet','ice-shard','mach-punch','bullet-punch','sucker-punch','shadow-sneak','vacuum-wave','first-impression'];
        if(prioMoves.includes(nm))score+=25;
      }
      pool.push({nm:nm,power:power,mtype:mtype,cat:cat,score:score,lv:lv,method:method});
    });
    var seen = new Set();
    var unique = pool.filter(function(m){if(seen.has(m.nm))return false;seen.add(m.nm);return true;});
    unique.sort(function(a,b){return b.score-a.score;});
    var chosen=[],typeCounts={};
    for(var i=0;i<unique.length&&chosen.length<4;i++){
      var m=unique[i],tc=typeCounts[m.mtype]||0;
      if(tc>=2)continue;
      typeCounts[m.mtype]=(tc||0)+1;chosen.push(m);
    }
    for(var i=0;i<unique.length&&chosen.length<4;i++){if(!chosen.includes(unique[i]))chosen.push(unique[i]);}
    if(!chosen.length)return '<div style="color:#666">Brak danych o atakach.</div>';
    var stars=function(sc){return sc>=180?'\u2b50\u2b50\u2b50\u2b50':sc>=120?'\u2b50\u2b50\u2b50':sc>=60?'\u2b50\u2b50':'\u2b50';};
    var catLabel=function(cat){return cat==='P'?'<span class="move-cat-p">Fiz.</span>':cat==='S'?'<span class="move-cat-s">Spec.</span>':'<span class="move-cat-z">Status</span>';};
    return chosen.map(function(m,i){
      var isStab=typeSet.has(m.mtype);
      var stabL=isStab?'<span class="move-stab">STAB</span>':'<span class="move-coverage">'+typeName(m.mtype)+'</span>';
      var pwrStr=m.power>0?'<span class="move-power">MOC: '+m.power+'</span>':'<span class="move-power" style="color:#666">Status</span>';
      return '<div class="move-card"><span class="move-card-num">'+(i+1)+'</span><div class="move-card-name">'+typeIconHTML(m.mtype,18)+' '+m.nm.replace(/-/g,' ')+'</div><div class="move-card-meta">'+catLabel(m.cat)+stabL+pwrStr+'</div><div class="move-stars">'+stars(m.score)+'</div></div>';
    }).join('');
  }

  // ── COMPETITIVE SECTION WITH 3 BUILDS ──
  function buildCompetitiveSection(stats, pokemonTypes, moves) {
    var statMap = {}; stats.forEach(function(s){statMap[s.stat.name]=s.base_stat;});
    var r = detectRole(statMap);
    // Store for calculator
    lastBuildData = {statMap:statMap, pokemonTypes:pokemonTypes, r:r};
    var builds = [
      {key:'physical', label:t('build.phys'), icon:'\u2694'},
      {key:'special', label:t('build.spec'), icon:'\u2728'},
      {key:'defensive', label:t('build.def'), icon:'\ud83d\udee1'}
    ];
    var tabsHTML = builds.map(function(b,i){
      return '<button class="build-tab'+(i===0?' active':'')+'" onclick="switchBuildTab(this,\'build-panel-'+i+'\')">'+(i+1)+'. '+b.icon+' '+b.label+'</button>';
    }).join('');
    var panelsHTML = builds.map(function(b,i){
      return '<div class="build-panel'+(i===0?' active':'')+'" id="build-panel-'+i+'">'+generateBuild(statMap,pokemonTypes,moves,b.key)+'</div>';
    }).join('');
    return '<div class="comp-section"><h2>\ud83c\udfc6 '+t('sec.comp')+' \u2014 '+r.label+'  <button class="copy-link-btn" id="copy-link-btn" onclick="copyBuildLink()" style="float:right;margin-top:-4px">\ud83d\udd17 '+t('build.copyLink')+'</button></h2>'
      +'<div class="build-tabs">'+tabsHTML+'</div>'
      +panelsHTML
      +'</div>';
  }

  // ── FULL MOVELIST with type icons ──
  function buildMovesSection(moves) {
    var lvlMoves=[],tmMoves=[],eggMoves=[];
    moves.forEach(function(m){
      var vgd=m.version_group_details.slice().sort(function(a,b){return b.version_group.url.localeCompare(a.version_group.url,undefined,{numeric:true});})[0];
      if(!vgd)return;
      var method=vgd.move_learn_method.name,lv=vgd.level_learned_at,nm=m.move.name;
      if(method==='level-up')lvlMoves.push({name:nm,lv:lv});
      else if(method==='machine')tmMoves.push({name:nm});
      else if(method==='egg')eggMoves.push({name:nm});
    });
    lvlMoves.sort(function(a,b){return a.lv-b.lv;});tmMoves.sort(function(a,b){return a.name.localeCompare(b.name);});eggMoves.sort(function(a,b){return a.name.localeCompare(b.name);});
    var lvlHTML=lvlMoves.length?'<table class="move-table"><tr><th>'+t('mv.lvl')+'</th><th>'+t('mv.attack')+'</th><th>'+t('mv.type')+'</th><th>'+t('mv.power')+'</th></tr>'+lvlMoves.map(function(m){var md=MOVE_DATA[m.name];var mt=md?md[1]:'normal';return '<tr><td><span class="move-lv">'+(m.lv||'\u2014')+'</span></td><td class="move-name">'+typeIconHTML(mt,16)+' '+m.name.replace(/-/g,' ')+'</td><td><span class="type-badge type-'+mt+'" style="font-size:12px;padding:1px 6px">'+typeName(mt)+'</span></td><td style="color:#f8d030;font-size:17px">'+(md?md[0]||'\u2014':'\u2014')+'</td></tr>';}).join('')+'</table>':'<div style="color:#666">'+(currentLang==='en'?'None.':'Brak.')+'</div>';
    var tmHTML=tmMoves.length?'<div style="display:flex;flex-wrap:wrap;gap:6px;padding-top:4px">'+tmMoves.map(function(m){var md=MOVE_DATA[m.name];var mt=md?md[1]:'normal';return '<span class="move-tm">'+typeIconHTML(mt,14)+' '+m.name.replace(/-/g,' ')+'</span>';}).join('')+'</div>':'<div style="color:#666">'+(currentLang==='en'?'None.':'Brak.')+'</div>';
    var eggHTML=eggMoves.length?'<div style="display:flex;flex-wrap:wrap;gap:6px;padding-top:4px">'+eggMoves.map(function(m){var md=MOVE_DATA[m.name];var mt=md?md[1]:'normal';return '<span style="background:#1a0a1a;color:#c084fc;border:1px solid #7c3aed;padding:1px 8px;font-size:15px">'+typeIconHTML(mt,14)+' '+m.name.replace(/-/g,' ')+'</span>';}).join('')+'</div>':'<div style="color:#666">'+(currentLang==='en'?'None.':'Brak.')+'</div>';
    return '<div class="moves-section"><h2>\ud83d\udcdc '+t('sec.moves')+'</h2><div class="moves-tabs"><button class="moves-tab active" onclick="switchMovesTab(this,\'mv-lvl\')">\ud83d\udcc8 '+t('mv.level')+' ('+lvlMoves.length+')</button><button class="moves-tab" onclick="switchMovesTab(this,\'mv-tm\')">\ud83d\udcbf '+t('mv.tm')+' ('+tmMoves.length+')</button>'+(eggMoves.length?'<button class="moves-tab" onclick="switchMovesTab(this,\'mv-egg\')">\ud83e\udd5a '+t('mv.egg')+' ('+eggMoves.length+')</button>':'')+'</div><div class="moves-panel active" id="mv-lvl">'+lvlHTML+'</div><div class="moves-panel" id="mv-tm">'+tmHTML+'</div>'+(eggMoves.length?'<div class="moves-panel" id="mv-egg">'+eggHTML+'</div>':'')+'</div>';
  }

  // ── CALCULATOR SECTION ──
  function buildCalculatorSection(stats) {
    var statMap={}; stats.forEach(function(s){statMap[s.stat.name]=s.base_stat;});
    var ORDER=['hp','attack','defense','special-attack','special-defense','speed'];
    var ivRows = ORDER.map(function(sn){
      return '<div class="calc-box"><label>'+(STAT_NAMES[sn]||sn)+' IV (0-31)</label><input class="calc-field" type="number" min="0" max="31" value="31" id="calc-iv-'+sn+'" /></div>';
    }).join('');
    var natures = ['Hardy','Lonely','Brave','Adamant','Naughty','Bold','Docile','Relaxed','Impish','Lax','Timid','Hasty','Serious','Jolly','Naive','Modest','Mild','Quiet','Bashful','Rash','Calm','Gentle','Sassy','Careful','Quirky'];
    var natureOpts = natures.map(function(n){return '<option value="'+n+'">'+n+'</option>';}).join('');
    var abilities = p.abilities.map(function(a){return a.ability.name;});
    var abilityOpts = abilities.map(function(a){return '<option value="'+a+'">'+a+(p.abilities.find(function(ab){return ab.ability.name===a;}).is_hidden?' ['+(currentLang==='en'?'hidden':'ukryta')+']':'')+'</option>';}).join('');
    return '<div class="calc-section"><h2>\ud83e\uddee '+t('sec.calc')+'</h2>'
      +'<div style="font-size:16px;color:#888;margin-bottom:10px">'+(currentLang==='en'?'Enter your IVs, choose Nature and Ability to compare with the optimal build.':'Wpisz swoje IV, wybierz Natur\u0119 i Zdolno\u015b\u0107, aby por\u00f3wna\u0107 z optymalnym buildem.')+'</div>'
      +'<div class="calc-grid">'+ivRows+'</div>'
      +'<div class="calc-grid"><div class="calc-box"><label>'+t('build.nature')+'</label><select class="calc-select" id="calc-nature">'+natureOpts+'</select></div>'
      +'<div class="calc-box"><label>'+t('det.abilities')+' (Ability)</label><select class="calc-select" id="calc-ability">'+abilityOpts+'</select></div></div>'
      +'<div class="calc-grid"><div class="calc-box"><label>'+(currentLang==='en'?'Compare with build:':'Por\u00f3wnaj z buildem:')+'</label><select class="calc-select" id="calc-build-type"><option value="physical">'+t('build.phys')+'</option><option value="special">'+t('build.spec')+'</option><option value="defensive">'+t('build.def')+'</option></select></div>'
      +'<div class="calc-box" style="display:flex;align-items:flex-end"><button class="mc-btn" onclick="evaluatePokemon()" style="width:100%">\ud83d\udcca '+t('gen.evaluate')+'</button></div></div>'
      +'<div class="calc-verdict" id="calc-verdict"><span class="verdict-emoji">\u2753</span>'+(currentLang==='en'?'Enter data and click "Rate!"':'Wpisz dane i kliknij "Oce\u0144!"')+'</div></div>';
  }

  // Build stats HTML
  var statsHTML = p.stats.map(function(st){
    var sname=STAT_NAMES[st.stat.name]||st.stat.name,val=st.base_stat,pct=Math.min(100,Math.round(val/255*100)),color=STAT_COLORS[st.stat.name]||'#888';
    return '<div class="stat-row"><span class="stat-name">'+sname+'</span><span class="stat-val">'+val+'</span><div class="stat-bar-bg"><div class="stat-bar" style="width:'+pct+'%;background:'+color+'"></div></div></div>';
  }).join('');

  var typesHTML = p.types.map(function(tp){return '<span class="type-badge type-'+tp.type.name+'">'+typeName(tp.type.name)+'</span>';}).join('');
  var evoHTML = evoChain ? renderEvoChain(evoChain.chain) : '<span style="color:#666">'+(currentLang==='en'?'No evolution data':'Brak danych ewolucji')+'</span>';

  // Cobblemon section
  var cobHTML = '';
  if (isFriendship) {
    var detail = FRIENDSHIP_DETAIL[p.name] || (currentLang==='en'?'Requires high friendship.':'Wymaga wysokiej przyja\u017ani.');
    cobHTML += '<div class="info-row"><span class="info-icon">\ud83d\udc9b</span><div class="info-text"><em>'+(currentLang==='en'?'Friendship Evolution':'Ewolucja przez Przyja\u017a\u0144')+'</em><br>'+detail+'<br>'+(currentLang==='en'?'Check friendship level:':'Sprawd\u017a poziom przyja\u017ani komend\u0105:')+'<div class="cmd-block">/checkfriendship @s</div></div></div>';
  }
  if (isTradeEvo) {
    var te = LINK_CABLE_EVOS[p.name];
    cobHTML += '<div class="info-row"><span class="info-icon">\ud83d\udd17</span><div class="info-text"><em>'+(currentLang==='en'?'Link Cable Evolution':'Ewolucja przez Link Cable')+'</em> \u2192 <em>'+te.result+'</em><br>'+(te.item?(currentLang==='en'?'Held item: ':'Trzymany przedmiot: ')+'<code>'+te.item+'</code><br>':'')+(currentLang==='en'?'Use Link Cable and activate in hand.':'U\u017cyj Link Cable i aktywuj go w r\u0119ce.')+'</div></div>';
  }

  var abilitiesHTML = p.abilities.map(function(a){
    return '<span style="color:'+(a.is_hidden?'#a855f7':'#55ffff')+'">'+a.ability.name+(a.is_hidden?' <span style="font-size:13px;color:#a855f7">['+(currentLang==='en'?'hidden':'ukryta')+']</span>':'')+'</span>';
  }).join(', ');
  var height=(p.height/10).toFixed(1),weight=(p.weight/10).toFixed(1);
  function getGen(id){for(var g=1;g<=9;g++){var r=GEN_RANGES[g];if(id>=r[0]&&id<=r[1])return (currentLang==='en'?'Generation ':'Generacja ')+['I','II','III','IV','V','VI','VII','VIII','IX'][g-1];}return '?';}
  if(!cobHTML)cobHTML='<div class="info-row"><span class="info-icon">\u2705</span><div class="info-text">'+(currentLang==='en'?'This Pok\u00e9mon has no special Cobblemon requirements.':'Ten Pok\u00e9mon nie wymaga specjalnych warunk\u00f3w Cobblemon.')+'</div></div>';
  var artworkUrl = (p.sprites&&p.sprites.other&&p.sprites.other['official-artwork']?p.sprites.other['official-artwork'].front_default:null) || 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+p.id+'.png';
  var isFav = isFavorite(p.id);

  // Build biome section
  var biomeHTML = buildBiomeSection(s.habitat, p.types);

  document.getElementById('main-area').innerHTML =
    '<div class="page-title"><span>#'+String(p.id).padStart(3,'0')+' '+p.name.toUpperCase()+' <button class="fav-star'+(isFav?' active':'')+'" id="fav-star-btn" onclick="toggleFavorite('+p.id+',\''+p.name+'\')" title="'+(currentLang==='en'?'Add to favorites':'Dodaj do ulubionych')+'">\u2b50</button></span></div>'
    +'<div class="detail-grid"><div>'
    +'<div class="mc-panel pokemon-portrait"><img src="'+artworkUrl+'" onerror="this.src=\'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+p.id+'.png\'" alt="'+p.name+'" style="width:160px;height:160px"/><div class="pokemon-name-big">'+p.name+'</div><div class="pokemon-number">#'+String(p.id).padStart(3,'0')+' \u00b7 '+getGen(p.id)+'</div><div class="types" style="margin-top:10px">'+typesHTML+'</div><hr class="section-sep" style="margin:10px 0"><div style="font-size:16px;color:#888;font-style:italic;max-width:200px;margin:0 auto;text-align:center">'+flavor+'</div></div>'
    +'<div class="mc-panel" style="margin-top:12px"><h2>\ud83d\udccb '+t('sec.basicData')+'</h2><div class="info-entry"><span class="info-label">'+t('det.height')+':</span><span class="info-value">'+height+' m</span></div><div class="info-entry"><span class="info-label">'+t('det.weight')+':</span><span class="info-value">'+weight+' kg</span></div><div class="info-entry"><span class="info-label">'+t('det.types')+':</span><span class="info-value">'+p.types.map(function(tp){return typeName(tp.type.name);}).join(', ')+'</span></div><div class="info-entry"><span class="info-label">'+t('det.abilities')+':</span><span class="info-value" style="font-size:16px">'+abilitiesHTML+'</span></div><div class="info-entry"><span class="info-label">'+t('det.habitat')+':</span><span class="info-value">'+(s.habitat?s.habitat.name:'\u2014')+'</span></div><div class="info-entry"><span class="info-label">'+t('det.catch')+':</span><span class="info-value">'+s.capture_rate+'/255</span></div><div class="info-entry"><span class="info-label">'+t('det.baseExp')+':</span><span class="info-value">'+(p.base_experience||'?')+'</span></div></div>'
    +biomeHTML
    +'</div>'
    +'<div>'
    +'<div class="mc-panel"><h2>\ud83d\udcca '+t('sec.baseStats')+'</h2>'+statsHTML+'<div style="font-size:15px;color:#666;margin-top:6px;">'+t('gen.sum')+': <span style="color:#fff">'+p.stats.reduce(function(a,st){return a+st.base_stat;},0)+'</span></div></div>'
    +buildIVSection(p.stats)
    +'<div class="mc-panel" style="margin-top:12px"><h2>\ud83e\uddec '+t('sec.evo')+'</h2><div class="evo-chain" id="evo-chain-container">'+evoHTML+'</div></div></div></div>'
    +'<div class="cobblemon-section" style="margin-top:16px"><h2><span class="cob-icon">\u2694</span> '+t('sec.cobblemon')+'</h2>'+cobHTML+'</div>'
    +buildCompetitiveSection(p.stats, p.types.map(function(tp){return tp.type.name;}), p.moves)
    +buildMovesSection(p.moves)
    +buildCalculatorSection(p.stats)
    +'<div style="height:40px"></div>';

  document.querySelectorAll('.iv-input').forEach(function(inp){updateIVBar(inp);});
  document.querySelectorAll('.evo-item[data-evo-name]').forEach(function(el){
    el.addEventListener('click', function(){
      var n=el.dataset.evoName;var found=allPokemon.find(function(p){return p.name===n;});
      if(found)loadDetail(found.id,found.name);
    });
  });
}

/* ================================================================
   EVALUATE POKEMON (Calculator)
   ================================================================ */
function evaluatePokemon() {
  if (!lastBuildData) return;
  var buildType = document.getElementById('calc-build-type').value;
  var ORDER = ['hp','attack','defense','special-attack','special-defense','speed'];
  var ivs = {};
  ORDER.forEach(function(sn) {
    var el = document.getElementById('calc-iv-'+sn);
    ivs[sn] = el ? parseInt(el.value)||0 : 31;
  });
  var nature = document.getElementById('calc-nature').value;

  // Define ideal IVs per build type
  var idealIVs = {};
  if (buildType === 'physical') {
    idealIVs = {hp:31, attack:31, defense:20, 'special-attack':0, 'special-defense':20, speed:31};
  } else if (buildType === 'special') {
    idealIVs = {hp:31, attack:0, defense:20, 'special-attack':31, 'special-defense':20, speed:31};
  } else {
    idealIVs = {hp:31, attack:0, defense:31, 'special-attack':0, 'special-defense':31, speed:20};
  }

  // Define ideal natures
  var idealNatures = {
    physical: ['Adamant','Jolly'],
    special: ['Modest','Timid'],
    defensive: ['Bold','Calm','Impish','Careful']
  };

  // Define key stats per build
  var keyStats = {
    physical: ['attack','speed'],
    special: ['special-attack','speed'],
    defensive: ['hp','defense','special-defense']
  };

  // Score calculation
  var totalScore = 0, maxScore = 0;
  var keys = keyStats[buildType] || [];
  ORDER.forEach(function(sn) {
    var weight = keys.includes(sn) ? 3 : 1;
    var ideal = idealIVs[sn];
    var actual = Math.min(31, Math.max(0, ivs[sn]));
    var diff;
    if (ideal === 0) {
      diff = 31 - actual; // lower is better
    } else {
      diff = actual; // higher is better, just use the value relative to ideal
      if (ideal < 31) diff = Math.min(actual, ideal); // cap at ideal
    }
    var statScore;
    if (ideal === 0) {
      statScore = actual <= 5 ? 1 : actual <= 15 ? 0.6 : 0.2;
    } else {
      statScore = actual >= ideal ? 1 : actual / ideal;
    }
    totalScore += statScore * weight;
    maxScore += weight;
  });

  // Nature bonus
  var isIdealNature = idealNatures[buildType] && idealNatures[buildType].includes(nature);
  if (isIdealNature) totalScore += 2;
  maxScore += 2;

  var pct = totalScore / maxScore;
  var verdict, emoji, color;
  if (pct >= 0.9) { verdict = 'Idealny!'; emoji = '\ud83d\udfe2'; color = '#55ff55'; }
  else if (pct >= 0.7) { verdict = 'Dobry'; emoji = '\ud83d\udfe1'; color = '#f8d030'; }
  else if (pct >= 0.5) { verdict = '\u015aredni'; emoji = '\ud83d\udfe0'; color = '#f08030'; }
  else { verdict = 'Szukaj dalej'; emoji = '\ud83d\udd34'; color = '#ff5555'; }

  var natureStatus = isIdealNature ? '<span style="color:#55ff55">\u2705 Idealna natura!</span>' : '<span style="color:#f08030">\u26a0 Nieoptymalna natura (zalecane: '+idealNatures[buildType].join(' / ')+')</span>';
  var pctStr = Math.round(pct * 100);

  document.getElementById('calc-verdict').innerHTML =
    '<span class="verdict-emoji">'+emoji+'</span>'
    +'<div style="font-size:28px;color:'+color+';font-family:\'Press Start 2P\',monospace">'+verdict+'</div>'
    +'<div style="font-size:18px;color:#aaa;margin-top:8px">Zgodno\u015b\u0107 z buildem: <span style="color:'+color+'">'+pctStr+'%</span></div>'
    +'<div style="font-size:16px;margin-top:6px">'+natureStatus+'</div>';
}

/* ================================================================
   EVO CHAIN
   ================================================================ */
function renderEvoChain(chain) {
  var html = '';
  function walk(node) {
    var name = node.species.name;
    var id = node.species.url.split('/').filter(Boolean).pop();
    html += '<div class="evo-item" data-evo-name="'+name+'"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/'+id+'.png" alt="'+name+'"/><span>'+name+'</span></div>';
    if (node.evolves_to && node.evolves_to.length > 0) {
      node.evolves_to.forEach(function(next) {
        var det = next.evolution_details && next.evolution_details[0];
        var trigger = '';
        if (det) {
          if (det.min_level) trigger = 'Poz.'+det.min_level;
          else if (det.item) trigger = det.item.name;
          else if (det.trigger && det.trigger.name === 'trade') trigger = 'wymiana';
          else if (det.trigger && det.trigger.name === 'use-item') trigger = (det.item?det.item.name:'przedmiot');
          else if (det.min_happiness) trigger = '\u2665 przyja\u017a\u0144';
        }
        html += '<div style="display:flex;flex-direction:column;align-items:center"><span class="evo-arrow">\u2192</span><span class="evo-trigger">'+trigger+'</span></div>';
        walk(next);
      });
    }
  }
  walk(chain);
  return html;
}

/* ================================================================
   TYPE CHART RENDERER
   ================================================================ */
var TYPE_OFFENSE = {};
(function buildOffenseChart(){
  ALL_TYPES.forEach(function(atk){
    TYPE_OFFENSE[atk]={};
    ALL_TYPES.forEach(function(def){
      var d=TYPE_EFF[def];
      if(d.immune.indexOf(atk)!==-1) TYPE_OFFENSE[atk][def]=0;
      else if(d.weak.indexOf(atk)!==-1) TYPE_OFFENSE[atk][def]=2;
      else if(d.resist.indexOf(atk)!==-1) TYPE_OFFENSE[atk][def]=0.5;
      else TYPE_OFFENSE[atk][def]=1;
    });
  });
})();

function renderTypeChart(){
  var html='<table class="type-chart" id="type-chart-table">';
  // header row
  html+='<tr><th class="tc-corner">'+t('tc.atkLabel')+'<br><small>'+t('tc.defLabel')+'</small></th>';
  ALL_TYPES.forEach(function(def){
    html+='<th class="tc-col-header"><span class="type-badge type-'+def+'" style="font-size:10px;padding:1px 4px">'+typeName(def).substring(0,3).toUpperCase()+'</span></th>';
  });
  html+='</tr>';
  // data rows
  ALL_TYPES.forEach(function(atk){
    html+='<tr><th class="tc-row-header"><span class="type-badge type-'+atk+'" style="font-size:11px;padding:1px 6px">'+typeName(atk)+'</span></th>';
    ALL_TYPES.forEach(function(def){
      var m=TYPE_OFFENSE[atk][def];
      var cls='tc-norm',txt='1';
      if(m===2){cls='tc-x2';txt='2';}
      else if(m===0.5){cls='tc-half';txt='\u00bd';}
      else if(m===0){cls='tc-zero';txt='0';}
      html+='<td class="'+cls+'" data-atk="'+atk+'" data-def="'+def+'">'+txt+'</td>';
    });
    html+='</tr>';
  });
  html+='</table>';
  return html;
}

function initTypeChartHover(){
  var table=document.getElementById('type-chart-table');
  if(!table)return;
  table.addEventListener('mouseover',function(e){
    var td=e.target.closest('td[data-def]');
    if(!td)return;
    var col=td.dataset.def;
    table.querySelectorAll('td[data-def="'+col+'"]').forEach(function(c){c.classList.add('tc-highlight');});
  });
  table.addEventListener('mouseout',function(e){
    var td=e.target.closest('td[data-def]');
    if(!td)return;
    table.querySelectorAll('.tc-highlight').forEach(function(c){c.classList.remove('tc-highlight');});
  });
}

/* ================================================================
   PAGES
   ================================================================ */
function showPage(page) {
  currentPage = page;
  var main = document.getElementById('main-area');

  if (page === 'welcome') {
    main.innerHTML =
      '<div class="page-title"><span>\ud83c\udfe0 Cobblemon Mastery Guide</span></div>'
      + renderFavoritesSection()
      + '<div class="welcome-grid">'
      + '<div class="welcome-card"><h3>\u2694 '+t('welcome.what')+'</h3><p>'+t('welcome.whatDesc')+'</p></div>'
      + '<div class="welcome-card"><h3>\ud83d\udd0d '+t('welcome.howUse')+'</h3><ul><li>'+(currentLang==='en'?'Search for a Pok\u00e9mon in the sidebar':'Wyszukaj Pok\u00e9mona w pasku po lewej')+'</li><li>'+(currentLang==='en'?'Filter by generation (I\u2013IX)':'Filtruj wed\u0142ug generacji (I\u2013IX)')+'</li><li>\u2665 = '+(currentLang==='en'?'friendship evolution':'ewolucja przez przyja\u017a\u0144')+'</li><li>\u21c4 = '+(currentLang==='en'?'trade evolution':'ewolucja przez wymian\u0119')+'</li><li>\u2b50 = '+(currentLang==='en'?'add to favorites':'dodaj do ulubionych')+'</li></ul></div>'
      + '<div class="welcome-card"><h3>\ud83d\udc9b '+t('welcome.friend')+'</h3><p>'+(currentLang==='en'?'In Cobblemon, check friendship evolution with:':'W Cobblemonie ewolucje przez przyja\u017a\u0144 sprawdzasz komend\u0105:')+'</p><div class="cmd-block">/checkfriendship @s</div><p style="margin-top:8px;font-size:16px;color:#888">'+(currentLang==='en'?'You need min. 160/255.':'Potrzebujesz min. 160/255.')+'</p></div>'
      + '<div class="welcome-card"><h3>\ud83d\udd17 '+t('welcome.link')+'</h3><p>'+(currentLang==='en'?'Replaces the Pok\u00e9mon trade from the original games. Activate in hand near another player.':'Zast\u0119puje wymian\u0119 Pok\u00e9mon\u00f3w z oryginalnych gier. Aktywuj w r\u0119ce, b\u0119d\u0105c blisko innego gracza.')+'</p></div>'
      + '<div class="welcome-card"><h3>\ud83c\udf4e '+t('nav.apricorns')+'</h3><p>'+(currentLang==='en'?'Collect Apricorns from trees and craft unique Pok\u00e9balls!':'Zbieraj Apricorny z drzew i craftuj unikalne Pokeballsy!')+'</p><p style="margin-top:6px"><button class="mc-btn" onclick="showPage(\'apricorns\')">\u2192 '+t('nav.apricorns')+'</button></p></div>'
      + '<div class="welcome-card"><h3>\ud83d\udce6 '+t('nav.items')+'</h3><p>'+(currentLang==='en'?'All key items in one place.':'Wszystkie wa\u017cne przedmioty w jednym miejscu.')+'</p><p style="margin-top:6px"><button class="mc-btn" onclick="showPage(\'items\')">\u2192 '+t('nav.items')+'</button></p></div>'
      + '<div class="welcome-card"><h3>\u2694 '+t('nav.team')+'</h3><p>'+(currentLang==='en'?'Analyze your PvP team composition and type coverage.':'Analizuj sk\u0142ad dru\u017cyny PvP i pokrycie typ\u00f3w.')+'</p><p style="margin-top:6px"><button class="mc-btn" onclick="showPage(\'team-analyzer\')">\u2192 '+t('nav.team')+'</button></p></div>'
      + '<div class="welcome-card"><h3>\u2696 '+t('nav.typechart')+'</h3><p>'+(currentLang==='en'?'Interactive 18-type effectiveness chart with hover highlights.':'Interaktywna tabela skuteczno\u015bci 18 typ\u00f3w z pod\u015bwietlaniem.')+'</p><p style="margin-top:6px"><button class="mc-btn" onclick="showPage(\'type-chart\')">\u2192 '+t('nav.typechart')+'</button></p></div>'
      + '</div>';
  }

  if (page === 'detail-loading') {
    main.innerHTML = '<div class="empty-state"><span class="big-icon">\u2699</span>'+(currentLang==='en'?'Loading Pok\u00e9mon data...':'\u0141adowanie danych Pok\u00e9mona...')+'</div>';
  }

  if (page === 'items') {
    main.innerHTML =
      '<div class="page-title"><span>\ud83d\udce6 '+t('sec.items')+'</span></div>'
      + '<div class="items-grid">' + renderItems() + '</div>';
  }

  if (page === 'apricorns') {
    main.innerHTML =
      '<div class="page-title"><span>\ud83c\udf4e '+t('sec.apricorns')+'</span></div>'
      + '<div class="mc-panel" style="margin-bottom:16px"><h2>\u2139\ufe0f '+t('apricorn.how')+'</h2><p style="font-size:18px;color:#aaa;line-height:1.6">'+t('apricorn.howDesc')+'</p></div>'
      + '<div class="apricorn-grid">' + renderApricorns() + '</div>';
  }

  if (page === 'team-analyzer') {
    loadTeam();
    main.innerHTML =
      '<div class="page-title"><span>\u2694 '+t('sec.team')+'</span></div>'
      + '<div class="team-section"><h2>\ud83d\udee1 '+t('sec.team')+'</h2>'
      + '<div id="team-analyzer-content"></div></div>';
    renderTeamPage();
  }

  if (page === 'type-chart') {
    main.innerHTML =
      '<div class="page-title"><span>\u2696 '+t('sec.typechart')+'</span></div>'
      + '<div class="type-chart-info">'+t('tc.info')+'</div>'
      + '<div class="type-chart-info">'+t('tc.dual')+'</div>'
      + '<div class="type-chart-wrap">'+renderTypeChart()+'</div>';
    initTypeChartHover();
  }
}

/* ================================================================
   ITEMS DATA & RENDER
   ================================================================ */
var ITEMS_DATA = [
  { name:'Link Cable',        slug:'linking-cord',   desc:{pl:'Zast\u0119puje wymian\u0119 Pok\u00e9mon\u00f3w. Aktywuj w r\u0119ce blisko gracza.',en:'Replaces Pok\u00e9mon trade. Activate in hand near a player.'}, tag:{pl:'Ewolucja',en:'Evolution'} },
  { name:'Thunder Stone',     slug:'thunder-stone',  desc:{pl:'Ewoluuje: Pikachu\u2192Raichu, Eevee\u2192Jolteon',en:'Evolves: Pikachu\u2192Raichu, Eevee\u2192Jolteon'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Fire Stone',        slug:'fire-stone',     desc:{pl:'Ewoluuje: Vulpix\u2192Ninetales, Growlithe\u2192Arcanine, Eevee\u2192Flareon',en:'Evolves: Vulpix\u2192Ninetales, Growlithe\u2192Arcanine, Eevee\u2192Flareon'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Water Stone',       slug:'water-stone',    desc:{pl:'Ewoluuje: Poliwhirl\u2192Poliwrath, Shellder\u2192Cloyster, Eevee\u2192Vaporeon',en:'Evolves: Poliwhirl\u2192Poliwrath, Shellder\u2192Cloyster, Eevee\u2192Vaporeon'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Leaf Stone',        slug:'leaf-stone',     desc:{pl:'Ewoluuje: Exeggcute\u2192Exeggutor, Weepinbell\u2192Victreebel',en:'Evolves: Exeggcute\u2192Exeggutor, Weepinbell\u2192Victreebel'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Moon Stone',        slug:'moon-stone',     desc:{pl:'Ewoluuje: Nidorina\u2192Nidoqueen, Clefairy\u2192Clefable',en:'Evolves: Nidorina\u2192Nidoqueen, Clefairy\u2192Clefable'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Sun Stone',         slug:'sun-stone',      desc:{pl:'Ewoluuje: Gloom\u2192Bellossom, Sunkern\u2192Sunflora',en:'Evolves: Gloom\u2192Bellossom, Sunkern\u2192Sunflora'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Dusk Stone',        slug:'dusk-stone',     desc:{pl:'Ewoluuje: Murkrow\u2192Honchkrow, Misdreavus\u2192Mismagius',en:'Evolves: Murkrow\u2192Honchkrow, Misdreavus\u2192Mismagius'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Shiny Stone',       slug:'shiny-stone',    desc:{pl:'Ewoluuje: Togetic\u2192Togekiss, Roselia\u2192Roserade',en:'Evolves: Togetic\u2192Togekiss, Roselia\u2192Roserade'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Ice Stone',         slug:'ice-stone',      desc:{pl:'Ewoluuje: Alolan Sandshrew\u2192Sandslash, Alolan Vulpix\u2192Ninetales',en:'Evolves: Alolan Sandshrew\u2192Sandslash, Alolan Vulpix\u2192Ninetales'}, tag:{pl:'Kamie\u0144',en:'Stone'} },
  { name:'Metal Coat',        slug:'metal-coat',     desc:{pl:'Trzymany przez Onix\u2192Steelix lub Scyther\u2192Scizor (Link Cable)',en:'Held by Onix\u2192Steelix or Scyther\u2192Scizor (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Dragon Scale',      slug:'dragon-scale',   desc:{pl:'Trzymany przez Seadra\u2192Kingdra (Link Cable)',en:'Held by Seadra\u2192Kingdra (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:"King's Rock",       slug:'kings-rock',     desc:{pl:'Slowpoke\u2192Slowking lub Poliwhirl\u2192Politoed (Link Cable)',en:'Slowpoke\u2192Slowking or Poliwhirl\u2192Politoed (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Up-Grade',          slug:'up-grade',       desc:{pl:'Porygon\u2192Porygon2 (Link Cable)',en:'Porygon\u2192Porygon2 (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Dubious Disc',      slug:'dubious-disc',   desc:{pl:'Porygon2\u2192Porygon-Z (Link Cable)',en:'Porygon2\u2192Porygon-Z (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Deep Sea Tooth',    slug:'deep-sea-tooth', desc:{pl:'Clamperl\u2192Huntail (Link Cable)',en:'Clamperl\u2192Huntail (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Deep Sea Scale',    slug:'deep-sea-scale', desc:{pl:'Clamperl\u2192Gorebyss (Link Cable)',en:'Clamperl\u2192Gorebyss (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Sachet',            slug:'sachet',         desc:{pl:'Spritzee\u2192Aromatisse (Link Cable)',en:'Spritzee\u2192Aromatisse (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Whipped Dream',     slug:'whipped-dream',  desc:{pl:'Swirlix\u2192Slurpuff (Link Cable)',en:'Swirlix\u2192Slurpuff (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Prism Scale',       slug:'prism-scale',    desc:{pl:'Feebas\u2192Milotic (Link Cable)',en:'Feebas\u2192Milotic (Link Cable)'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Potion / Max Potion',slug:'potion',        desc:{pl:'Leczy P\u017b pok\u00e9mona.',en:'Heals Pok\u00e9mon HP.'}, tag:{pl:'Leczenie',en:'Healing'} },
  { name:'Revive',            slug:'revive',         desc:{pl:'Przywraca omdla\u0142ego pok\u00e9mona do 50% P\u017b',en:'Revives fainted Pok\u00e9mon to 50% HP'}, tag:{pl:'Leczenie',en:'Healing'} },
  { name:'Soothe Bell',       slug:'soothe-bell',    desc:{pl:'Przyspiesza zdobywanie Friendship.',en:'Speeds up Friendship gain.'}, tag:{pl:'Przyja\u017a\u0144',en:'Friendship'} },
  { name:'Leftovers',         slug:'leftovers',      desc:{pl:'Regeneruje 1/16 P\u017b co tur\u0119.',en:'Restores 1/16 HP per turn.'}, tag:{pl:'Held Item',en:'Held Item'} },
  { name:'Ability Shield',    slug:'ability-shield',  desc:{pl:'Chroni umiej\u0119tno\u015b\u0107 posiadacza przed zmian\u0105 lub zablokowaniem.',en:'Protects the holder\u2019s Ability from being changed or suppressed.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Assault Vest',      slug:'assault-vest',    desc:{pl:'Zwi\u0119ksza Sp. Def o 50%, ale blokuje ruchy statusowe.',en:'Boosts Sp. Def by 50% but prevents status moves.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Choice Band',       slug:'choice-band',     desc:{pl:'Zwi\u0119ksza Atak o 50%, ale pozwala u\u017cywa\u0107 tylko jednego ruchu.',en:'Boosts Attack by 50% but locks into one move.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Choice Scarf',      slug:'choice-scarf',    desc:{pl:'Zwi\u0119ksza Szybko\u015b\u0107 o 50%, ale pozwala u\u017cywa\u0107 tylko jednego ruchu.',en:'Boosts Speed by 50% but locks into one move.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Choice Specs',      slug:'choice-specs',    desc:{pl:'Zwi\u0119ksza Sp. Atak o 50%, ale pozwala u\u017cywa\u0107 tylko jednego ruchu.',en:'Boosts Sp. Atk by 50% but locks into one move.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Eviolite',          slug:'eviolite',        desc:{pl:'Zwi\u0119ksza Def i Sp.Def o 50% dla Pok\u00e9mon\u00f3w, kt\u00f3re mog\u0105 jeszcze ewoluowa\u0107.',en:'Boosts Def and Sp.Def by 50% for Pok\u00e9mon that can still evolve.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Focus Sash',        slug:'focus-sash',      desc:{pl:'Pozwala prze\u017cy\u0107 atak z 1 HP przy pe\u0142nym zdrowiu (zu\u017cywa si\u0119).',en:'Survives a KO hit with 1 HP at full health (consumed).'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Life Orb',          slug:'life-orb',        desc:{pl:'Zwi\u0119ksza moc atak\u00f3w o 30%, ale zabiera 10% HP przy ka\u017cdym trafieniu.',en:'Boosts move power by 30% but costs 10% HP per hit.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Rocky Helmet',      slug:'rocky-helmet',    desc:{pl:'Zadaje obra\u017cenia przeciwnikowi przy ataku fizycznym na posiadacza.',en:'Damages the attacker when they make contact.'}, tag:{pl:'PvP',en:'PvP'} },
  { name:'Sitrus Berry',      slug:'sitrus-berry',    desc:{pl:'Leczy 25% HP, gdy zdrowie spadnie poni\u017cej 50%.',en:'Restores 25% HP when health drops below 50%.'}, tag:{pl:'Jagoda',en:'Berry'} },
  { name:'Lum Berry',         slug:'lum-berry',       desc:{pl:'Leczy dowolny status (zatrucie, para\u017c, sen itp.).',en:'Cures any status condition (poison, paralysis, sleep, etc.).'}, tag:{pl:'Jagoda',en:'Berry'} },
];

function renderItems() {
  return ITEMS_DATA.map(function(item) {
    var imgTag = '<img class="item-icon-img" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/'+item.slug+'.png" onerror="this.parentNode.innerHTML=\'<span style=color:#555;font-size:28px>\u25A1</span>\'" />';
    var desc = typeof item.desc==='object'?item.desc[currentLang]||item.desc.pl:item.desc;
    var tag = typeof item.tag==='object'?item.tag[currentLang]||item.tag.pl:item.tag;
    return '<div class="item-card"><div class="item-icon-only">'+imgTag+'</div><div><div class="item-name">'+item.name+'</div><div class="item-desc">'+desc+'</div><span class="item-tag">'+tag+'</span></div></div>';
  }).join('');
}

/* ================================================================
   APRICORNS DATA & RENDER
   ================================================================ */
var APRICORNS_DATA = [
  { hex:'#222', color:{pl:'Czarny',en:'Black'}, ball:'Heavy Ball', ballSlug:'heavy-ball', effect:{pl:'\u0141atwiej \u0142apa\u0107 ci\u0119\u017ckie Pok\u00e9mony (\u2265 451.5 kg)',en:'Easier to catch heavy Pok\u00e9mon (\u2265451.5 kg)'} },
  { hex:'#3366cc', color:{pl:'Niebieski',en:'Blue'}, ball:'Lure Ball', ballSlug:'lure-ball', effect:{pl:'3\u00d7 skuteczno\u015b\u0107 przy \u0142apaniu w wodzie',en:'3\u00d7 catch rate when fishing'} },
  { hex:'#33aa33', color:{pl:'Zielony',en:'Green'}, ball:'Friend Ball', ballSlug:'friend-ball', effect:{pl:'Z\u0142owiony Pok\u00e9mon startuje z 200 Friendship',en:'Caught Pok\u00e9mon starts with 200 Friendship'} },
  { hex:'#dd66aa', color:{pl:'R\u00f3\u017cowy',en:'Pink'}, ball:'Love Ball', ballSlug:'love-ball', effect:{pl:'8\u00d7 skuteczno\u015b\u0107 na t\u0119 sam\u0105 sp., odmient\u0105 p\u0142e\u0107',en:'8\u00d7 rate on same species, different gender'} },
  { hex:'#cc3333', color:{pl:'Czerwony',en:'Red'}, ball:'Level Ball', ballSlug:'level-ball', effect:{pl:'Wy\u017cszy mno\u017cnik gdy Tw\u00f3j Pok\u00e9mon ma wy\u017cszy level',en:'Higher multiplier when your Pok\u00e9mon has higher level'} },
  { hex:'#ddd', color:{pl:'Bia\u0142y',en:'White'}, ball:'Fast Ball', ballSlug:'fast-ball', effect:{pl:'4\u00d7 skuteczno\u015b\u0107 na Pok\u00e9mony, kt\u00f3re uciekaj\u0105',en:'4\u00d7 rate on Pok\u00e9mon that flee'} },
  { hex:'#ddcc33', color:{pl:'\u017b\u00f3\u0142ty',en:'Yellow'}, ball:'Moon Ball', ballSlug:'moon-ball', effect:{pl:'4\u00d7 skuteczno\u015b\u0107 na ewoluuj\u0105ce Moon Stonem',en:'4\u00d7 rate on Moon Stone evolutions'} },
];

function renderApricorns() {
  return APRICORNS_DATA.map(function(a) {
    var ballImg = '<img class="item-icon-img" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/'+a.ballSlug+'.png" onerror="this.parentNode.innerHTML=\'\u25cf\'" style="vertical-align:middle" />';
    var colorName = typeof a.color==='object'?a.color[currentLang]||a.color.pl:a.color;
    var effect = typeof a.effect==='object'?a.effect[currentLang]||a.effect.pl:a.effect;
    return '<div class="apricorn-card"><div class="apricorn-fruit" style="background:'+a.hex+'"></div><div class="apricorn-name">'+colorName+' Apricorn</div><div class="apricorn-arrow">\u25bc</div><div class="apricorn-ball">'+ballImg+' '+a.ball+'</div><div class="apricorn-effect">'+effect+'</div></div>';
  }).join('');
}

/* ================================================================
   UTILITIES
   ================================================================ */
function setStatus(text, loading) {
  document.getElementById('status-text').textContent = text;
  document.getElementById('spinner').classList.toggle('active', loading);
}

function switchMovesTab(btn, panelId) {
  var section = btn.closest('.moves-section');
  section.querySelectorAll('.moves-tab').forEach(function(b){b.classList.remove('active');});
  section.querySelectorAll('.moves-panel').forEach(function(p){p.classList.remove('active');});
  btn.classList.add('active');
  var panel = document.getElementById(panelId);
  if (panel) panel.classList.add('active');
}

function switchBuildTab(btn, panelId) {
  var section = btn.closest('.comp-section');
  section.querySelectorAll('.build-tab').forEach(function(b){b.classList.remove('active');});
  section.querySelectorAll('.build-panel').forEach(function(p){p.classList.remove('active');});
  btn.classList.add('active');
  var panel = document.getElementById(panelId);
  if (panel) panel.classList.add('active');
}

function updateIVBar(input) {
  var val = parseInt(input.value);
  if (isNaN(val)) val = 0;
  if (val < 0) val = 0; if (val > 31) val = 31;
  input.value = val;
  var sn = input.dataset.stat;
  var pct = Math.round(val / 31 * 100);
  var bar = document.getElementById('ivbar-' + sn);
  var lbl = document.getElementById('ivlabel-' + sn);
  if (!bar || !lbl) return;
  var color = val>=28?'#55ff55':val>=20?'#f8d030':val>=10?'#f08030':'#ff5555';
  bar.style.width = pct + '%'; bar.style.background = color;
  if(val>=28) lbl.innerHTML='<span style="color:#55ff55">Doskona\u0142e</span>';
  else if(val>=20) lbl.innerHTML='<span style="color:#f8d030">Dobre</span>';
  else if(val>=10) lbl.innerHTML='<span style="color:#f08030">S\u0142abe</span>';
  else lbl.innerHTML='<span style="color:#ff5555">Z\u0142e</span>';
}

/* ================================================================
   EVENT LISTENERS
   ================================================================ */
document.getElementById('search-input').addEventListener('input', function(e) {
  searchQuery = e.target.value; applyFilters();
});
document.getElementById('gen-filters').addEventListener('click', function(e) {
  var btn = e.target.closest('.gen-filter-btn');
  if (!btn) return;
  document.querySelectorAll('.gen-filter-btn').forEach(function(b){b.classList.remove('active');});
  btn.classList.add('active');
  selectedGen = parseInt(btn.dataset.gen);
  applyFilters();
});

/* ================================================================
   START
   ================================================================ */
init();
</script>
</body>
</html>